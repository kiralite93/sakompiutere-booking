<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sakompiutere Gaming ‚Äî Booking</title>
  <meta name="theme-color" content="#0b1020" />
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    :root{
      --bg:#070a12;
      --card:#0b1020;
      --muted:#9aa4bf;
      --text:#eaf0ff;
      --line:rgba(255,255,255,.08);
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(900px 700px at 80% 10%, rgba(167,139,250,.14), transparent 60%),
        radial-gradient(800px 700px at 40% 120%, rgba(52,211,153,.10), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1180px; margin:0 auto; padding:18px;}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: radial-gradient(circle at 30% 20%, rgba(110,231,255,.9), rgba(167,139,250,.8) 40%, rgba(0,0,0,0) 72%),
                  linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow: 0 12px 30px rgba(0,0,0,.4);
    }
    .brand h1{margin:0; font-size:16px; letter-spacing:.4px}
    .brand .sub{margin:0; color:var(--muted); font-size:12px}
    .rightbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted); font-size:12px;
    }
    .pill strong{color:var(--text); font-weight:900}
    .lang{
      display:flex; gap:6px;
      padding:6px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }
    .lang button{
      padding:7px 10px; border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .lang button.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.10);
      color: var(--text);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      header{position:static;}
    }
    .card{
      border:1px solid var(--line);
      border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .hd h2{margin:0; font-size:14px}
    .hint{color:var(--muted); font-size:12px}
    .bd{padding:14px 16px}

    .stepper{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .step{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .step .n{
      width:22px; height:22px; border-radius:999px;
      display:grid; place-items:center;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:1000;
    }
    .step.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.08);
      color: var(--text);
    }
    .step.active .n{border-color: rgba(110,231,255,.55); color: var(--text)}

    .notice{
      border:1px dashed rgba(110,231,255,.35);
      background: rgba(110,231,255,.06);
      padding:12px 12px;
      border-radius:16px;
      font-size:12px;
      line-height:1.35;
    }

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.2px;
    }
    button:hover{border-color: rgba(110,231,255,.5)}
    .primary{
      border-color: rgba(110,231,255,.55);
      background: linear-gradient(180deg, rgba(110,231,255,.18), rgba(167,139,250,.10));
    }
    .ghost{background:transparent}
    .danger{border-color: rgba(251,113,133,.6); background: rgba(251,113,133,.10)}
    .mini{padding:6px 10px; border-radius:12px; font-size:12px; font-weight:1000}

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(110,231,255,.6); box-shadow:0 0 0 3px rgba(110,231,255,.12)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;}
    @media (max-width:520px){ .row{grid-template-columns:1fr;} }

    .pcgrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .pcgrid{grid-template-columns: repeat(2, 1fr);} }

    .pc{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
      position:relative;
      min-height:78px;
    }
    .pc:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.4)}
    .pc .name{font-weight:1100; letter-spacing:.3px}
    .pc .meta{margin-top:6px; color:var(--muted); font-size:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .tag{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(0,0,0,.25);
      font-size:12px; color:var(--muted);
    }
    .dot{width:8px; height:8px; border-radius:999px; background: var(--muted)}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .dot.warn{background:var(--warn)}

    .pc.selected{
      border-color: rgba(110,231,255,.75);
      box-shadow: 0 0 0 3px rgba(110,231,255,.10);
    }
    .check{
      position:absolute; top:10px; right:10px;
      width:22px; height:22px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      display:grid; place-items:center;
      color: transparent;
      font-weight:1100;
      font-size:12px;
    }
    .pc.selected .check{
      border-color: rgba(110,231,255,.75);
      background: rgba(110,231,255,.14);
      color: var(--text);
    }

    .chipsSelected{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;
      padding:10px; border-radius:16px; border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }
    .pcchip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(110,231,255,.30);
      background: rgba(110,231,255,.08);
      font-size:12px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
    }
    .pcchip .x{
      width:18px; height:18px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      display:grid; place-items:center;
      color: var(--muted);
      background: rgba(0,0,0,.20);
      font-weight:1100;
    }

    /* Slot UI */
    .slotToolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px}
    .slotGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .slotGrid{grid-template-columns: repeat(2, 1fr);} }
    .slot{
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.22);
      padding:12px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, border-color .12s ease;
      position:relative;
      min-height:72px;
    }
    .slot:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.4)}
    .slot .t1{font-weight:1100}
    .slot .t2{margin-top:6px; font-size:12px; color:var(--muted); display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .slot.free{border-color: rgba(52,211,153,.45)}
    .slot.busy{border-color: rgba(251,113,133,.55)}
    .slot.selected{box-shadow: 0 0 0 3px rgba(110,231,255,.10); border-color: rgba(110,231,255,.75)}
    .slot .badge{
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      font-size:12px;
      font-weight:1100;
    }
    .badge.ok{border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95)}
    .badge.bad{border-color: rgba(251,113,133,.35); color: rgba(251,113,133,.95)}

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:16px;
      margin-top:10px;
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:12px;
    }
    .table th{color:var(--muted); font-weight:1100; text-align:left; background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}

    .footerbar{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-top:12px;
      color: var(--muted);
      font-size:12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding:2px 6px;
      border:1px solid var(--line);
      border-radius:8px;
      background:rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
    }
    .hide{display:none !important;}

    /* Modal */
    .modalBack{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:18px;
    }
    .modalBack.show{display:flex;}
    .modal{
      width:min(520px, 100%);
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal .mh{padding:14px 16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center; gap:10px}
    .modal .mb{padding:14px 16px}
    .mut{color:var(--muted); font-size:12px}

    @media print{
      header, #rightSide, #openAdminBtn, #exitAdminBtn, #introBox, #step1Box, #step2Box, #step3Box, #myBox, #adminBox, #authBack { display:none !important; }
      body{ background:#fff !important; color:#000 !important; }
      .card{ box-shadow:none !important; background:#fff !important; border:1px solid #ddd !important; }
      .wrap{ max-width:100% !important; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="t_title">Sakompiutere Gaming ‚Äî Booking</h1>
        <p class="sub" id="t_sub">–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ —Å–ª–æ—Ç ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</p>
      </div>
    </div>

    <div class="rightbar">
      <div class="lang" aria-label="Language selector">
        <button id="lang_ru">RU</button>
        <button id="lang_en">EN</button>
        <button id="lang_ka">KA</button>
      </div>

      <div class="pill"><span id="t_user">–ê–∫–∫–∞—É–Ω—Ç</span>: <strong id="userPill">‚Äî</strong></div>
      <div class="pill"><span id="t_today">–°–µ–≥–æ–¥–Ω—è</span>: <strong id="todayPill">‚Äî</strong></div>
      <div class="pill"><span id="t_bookings">–ë—Ä–æ–Ω–µ–π</span>: <strong id="countPill">0</strong></div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="hd">
        <div class="stepper">
          <div class="step" id="step1"><span class="n">1</span><span id="t_step1">–ö–æ–º–ø—å—é—Ç–µ—Ä—ã</span></div>
          <div class="step" id="step2"><span class="n">2</span><span id="t_step2">–°–ª–æ—Ç</span></div>
          <div class="step" id="step3"><span class="n">3</span><span id="t_step3">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span></div>
        </div>
        <div class="hint" id="t_hint">–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ</div>
      </div>

      <div class="bd">

        <!-- INTRO -->
        <div class="notice" id="introBox">
          <b id="t_fast">üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ã—Å—Ç—Ä–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ</b><br/>
          <span id="t_intro1">1) –í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç (1 —Ä–∞–∑)</span><br/>
          <span id="t_intro2">2) –í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</span><br/>
          <span id="t_intro3">3) –í—ã–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—ã–π —Å–ª–æ—Ç –∏ –Ω–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù</span>

          <div class="btns">
            <button class="primary" id="loginBtn">üîë <span id="t_login">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span></button>
            <button class="primary" id="startBtn">‚ñ∂ <span id="t_start">–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</span></button>
            <button class="ghost" id="viewMyBtn">üë§ <span id="t_my">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
          </div>

          <div class="notice" style="margin-top:10px;">
            <b id="t_tip1">–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b>
            <span id="t_tip2">–°–ª–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç ‚Äú—Å–≤–æ–±–æ–¥–Ω–æ/–∑–∞–Ω—è—Ç–æ‚Äù —Å—Ä–∞–∑—É ‚Äî –Ω–µ –Ω–∞–¥–æ –≤—Ä—É—á–Ω—É—é –∫—Ä—É—Ç–∏—Ç—å –≤—Ä–µ–º—è.</span>
          </div>
        </div>

        <!-- STEP 1 -->
        <div id="step1Box" class="hide">
          <div class="row">
            <div>
              <label id="t_dateLabel">–î–∞—Ç–∞</label>
              <input id="date" type="date" />
            </div>
            <div>
              <label id="t_noteLabel">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="note" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: CS2 / –¢—É—Ä–Ω–∏—Ä" />
            </div>
          </div>

          <div class="hint" id="t_pickpc">–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö:</div>

          <div class="chipsSelected">
            <div style="width:100%; color:var(--muted); font-size:12px; margin-bottom:6px;">
              <span id="t_selected">–í—ã–±—Ä–∞–Ω–æ –ü–ö</span>: <b id="selectedCount">0</b>
            </div>
            <div id="selectedChips" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
          </div>

          <div class="btns">
            <button class="primary" id="toStep2Btn">‚û° <span id="t_next">–î–∞–ª–µ–µ</span></button>
            <button class="ghost" id="clearPcBtn">‚úñ <span id="t_clear">–û—á–∏—Å—Ç–∏—Ç—å</span></button>
          </div>

          <div id="pcGrid" class="pcgrid" aria-label="–°–ø–∏—Å–æ–∫ –ü–ö"></div>
        </div>

        <!-- STEP 2 -->
        <div id="step2Box" class="hide">
          <div class="row">
            <div>
              <label id="t_priceLabel">–¶–µ–Ω–∞ (GEL/—á–∞—Å)</label>
              <input id="price" type="number" min="0" step="0.5" value="5" />
            </div>
            <div>
              <label id="t_slotLen">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞</label>
              <select id="slotLen">
                <option value="60">60 –º–∏–Ω—É—Ç</option>
                <option value="90">90 –º–∏–Ω—É—Ç</option>
                <option value="120">120 –º–∏–Ω—É—Ç</option>
                <option value="180">180 –º–∏–Ω—É—Ç</option>
              </select>
            </div>
          </div>

          <div class="slotToolbar">
            <button class="ghost mini" id="prevSlotsBtn">‚¨Ö <span id="t_prev">–†–∞–Ω—å—à–µ</span></button>
            <span class="pill"><span id="t_window">–û–∫–Ω–æ</span>: <strong id="slotWindowPill">‚Äî</strong></span>
            <button class="ghost mini" id="nextSlotsBtn"><span id="t_nextWin">–ü–æ–∑–∂–µ</span> ‚û°</button>
            <button class="ghost mini" id="toggleOnlyFreeBtn">‚úÖ <span id="t_onlyFree">–¢–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ</span></button>
          </div>

          <div class="notice" id="slotHintBox" style="margin-top:10px;"></div>

          <div id="slotGrid" class="slotGrid" aria-label="–°–ª–æ—Ç—ã"></div>

          <div class="btns">
            <button class="ghost" id="backTo1Btn">‚¨Ö <span id="t_back">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="toStep3Btn">‚û° <span id="t_next2">–î–∞–ª–µ–µ</span></button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div id="step3Box" class="hide">
          <div class="notice" id="summaryBox"></div>

          <div class="btns">
            <button class="ghost" id="backTo2Btn">‚¨Ö <span id="t_back2">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="createBtn">‚úÖ <span id="t_bookNow">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</span></button>
          </div>

          <div class="notice" id="msg" style="margin-top:10px;" aria-live="polite">OK</div>

          <div class="btns" style="margin-top:10px;">
            <button class="ghost" id="showMyInlineBtn">üë§ <span id="t_my2">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
            <button class="ghost" id="copyShareBtn">üîó <span id="t_copyShare">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span></button>
          </div>

          <div class="notice" style="margin-top:10px;">
            <b id="t_qrTitle">QR –±—Ä–æ–Ω–∏</b><br/>
            <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:10px;">
              <canvas id="qrCanvas" width="160" height="160" style="background:#fff;border-radius:12px;border:1px solid rgba(255,255,255,.08)"></canvas>
              <div class="hint" id="qrHint">QR –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏.</div>
            </div>
          </div>
        </div>

        <!-- MY BOOKINGS -->
        <div id="myBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;" id="t_myTitle">–ú–æ–∏ –±—Ä–æ–Ω–∏</h2>
            <div class="hint" id="t_myHint">–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="btns">
              <button class="ghost" id="myCloseBtn">‚úñ <span id="t_close">–ó–∞–∫—Ä—ã—Ç—å</span></button>
              <button class="ghost" id="myRefreshBtn">üîÑ <span id="t_refresh">–û–±–Ω–æ–≤–∏—Ç—å</span></button>
            </div>

            <table class="table" role="table" aria-label="–ú–æ–∏ –±—Ä–æ–Ω–∏">
              <thead>
                <tr>
                  <th style="width:160px" id="t_colDate">–î–∞—Ç–∞</th>
                  <th style="width:160px" id="t_colTime">–í—Ä–µ–º—è</th>
                  <th style="width:140px" id="t_colPc">–ü–ö</th>
                  <th id="t_colNote">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                  <th style="width:110px" id="t_colCost">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                  <th style="width:160px" id="t_colCancel">–û—Ç–º–µ–Ω–∞</th>
                </tr>
              </thead>
              <tbody id="myTable"></tbody>
            </table>

            <div class="hint" style="margin-top:10px;" id="t_myCancelHint">
              –û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏. –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ.
            </div>
          </div>
        </div>

        <!-- ADMIN -->
        <div id="adminBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;">Admin</h2>
            <div class="hint" id="t_adminHint">—Ç–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="row">
              <div>
                <label id="t_search">–ü–æ–∏—Å–∫ (email/–ü–ö)</label>
                <input id="search" type="text" placeholder="–ø–æ–∏—Å–∫" />
              </div>
              <div style="display:flex; align-items:end; gap:10px; flex-wrap:wrap;">
                <button class="ghost" id="clearFilterBtn">–°–±—Ä–æ—Å</button>
                <button class="danger" id="wipeBtn">–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë (DEV)</button>
              </div>
            </div>

            <table class="table" role="table" aria-label="–í—Å–µ –±—Ä–æ–Ω–∏ (admin)">
              <thead>
                <tr>
                  <th style="width:160px" id="t_colDate2">–î–∞—Ç–∞</th>
                  <th style="width:160px" id="t_colTime2">–í—Ä–µ–º—è</th>
                  <th style="width:140px" id="t_colPc2">–ü–ö</th>
                  <th id="t_colNick2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                  <th style="width:110px" id="t_colCost2">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                  <th style="width:170px" id="t_colAct2">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="bookTable"></tbody>
            </table>
          </div>
        </div>

        <div class="footerbar">
          <div><span class="kbd">Esc</span> ‚Äî <span id="t_esc">–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç</span></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="mini ghost" id="openAdminBtn">üîê Admin</button>
            <button class="mini ghost" id="exitAdminBtn">üö™ Exit</button>
            <button class="mini ghost" id="logoutBtn">üö´ <span id="t_logout">Logout</span></button>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT -->
    <div class="card" id="rightSide">
      <div class="hd">
        <h2 id="t_sideTitle">–ü–æ–¥—Å–∫–∞–∑–∫–∞</h2>
        <div class="hint" id="t_sideHint">—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É</div>
      </div>
      <div class="bd">
        <div class="notice" id="helpBox"></div>

        <div style="height:12px"></div>
        <div class="notice" id="rulesBox"></div>

        <div style="height:12px"></div>
        <div class="notice">
          <b id="t_settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b><br/>
          <span class="hint" id="t_settingsDesc">
            –í—Å—ë –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ JS (–ü–ö, —á–∞—Å—ã, —Ü–µ–Ω—ã, –∞–¥–º–∏–Ω—ã).
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modalBack" id="authBack">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="mh">
      <div>
        <b id="t_authTitle">–ê–∫–∫–∞—É–Ω—Ç</b><div class="mut" id="t_authSub">–û–¥–∏–Ω —Ä–∞–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è ‚Äî –∏ –±—Ä–æ–Ω–∏ –±—É–¥—É—Ç –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö</div>
      </div>
      <button class="mini ghost" id="authCloseBtn">‚úñ</button>
    </div>
    <div class="mb">
      <div class="row">
        <div>
          <label id="t_email">Email</label>
          <input id="authEmail" type="email" placeholder="email@example.com" />
        </div>
        <div>
          <label id="t_pass">Password</label>
          <input id="authPass" type="password" placeholder="******" />
        </div>
      </div>
      <div class="row">
        <div>
          <label id="t_displayName">–ù–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="authNick" type="text" placeholder="KiraLite" />
        </div>
        <div>
          <label id="t_authMsgLbl">–°—Ç–∞—Ç—É—Å</label>
          <div class="notice" id="authMsg">‚Äî</div>
        </div>
      </div>
      <div class="btns">
        <button class="primary" id="doLoginBtn">üîë <span id="t_doLogin">–í–æ–π—Ç–∏</span></button>
        <button class="ghost" id="doRegisterBtn">‚ú® <span id="t_doRegister">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span></button>
        <button class="ghost" id="doResetBtn">üìß <span id="t_doReset">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</span></button>
      </div>
      <div class="mut" style="margin-top:10px;">
        DEV: –µ—Å–ª–∏ Auth –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ Firebase, –≤—Ö–æ–¥ –Ω–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç.
      </div>
    </div>
  </div>
</div>

<!-- Firebase (CDN modules) -->
<script type="module">
(() => {
  // =========================
  // FIREBASE CONFIG ‚Äî –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô firebaseConfig
  // =========================
  const firebaseConfig = {
    // –í–°–¢–ê–í–¨ –°–Æ–î–ê –¢–í–û–ô –û–ë–™–ï–ö–¢:
    // apiKey: "...",
    // authDomain: "...",
    // projectId: "...",
    // storageBucket: "...",
    // messagingSenderId: "...",
    // appId: "...",
  };

  // Firebase modules (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç "CDN + type=module") :contentReference[oaicite:1]{index=1}
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getAuth, onAuthStateChanged,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    sendPasswordResetEmail,
    updateProfile,
    signOut
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

  import {
    getFirestore, collection, addDoc, deleteDoc, doc,
    query, where, orderBy, limit, getDocs, onSnapshot,
    serverTimestamp, writeBatch
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  // =========================
  // APP CONFIG
  // =========================
  const PCs = ["Bishop","Godzilla","Elf","Kadita","Orc","Lancelot","Fantomas","Soultaker","Pudge","Kratos"];

  const LANG_KEY = "sg_lang";
  const ONLY_FREE_KEY = "sg_only_free";
  const SLOT_LEN_KEY = "sg_slot_len";
  const SLOT_WIN_KEY = "sg_slot_win";

  // –†–∞–±–æ—á–∏–µ —á–∞—Å—ã (–µ—Å–ª–∏ –∫–ª—É–± –Ω–µ 24/7)
  const WORKING_HOURS_ENABLED = true; // false –µ—Å–ª–∏ 24/7
  const WORK_START = "10:00";
  const WORK_END = "03:00"; // –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å

  const MIN_BOOK_MINUTES = 30;
  const MAX_BOOK_HOURS = 8;
  const MAX_DAYS_AHEAD = 14;

  // –°–ª–æ—Ç—ã: –æ–∫–Ω–æ —Å–ª–æ—Ç–æ–≤ (—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞ —Ä–∞–∑)
  const DEFAULT_SLOT_WINDOW_HOURS = 4;   // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 4 —á–∞—Å–∞ —Å–ª–æ—Ç–æ–≤
  const SLOT_STEP_MINUTES = 15;          // —à–∞–≥ —Å–µ—Ç–∫–∏ (—Å–ª–æ—Ç—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω)

  // –ê–¥–º–∏–Ω—ã –ø–æ email (–ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å —Å–≤–æ–∏)
  const ADMIN_EMAILS = [
    "admin@sakompiutere.ge"
  ];

  // =========================
  // i18n
  // =========================
  const i18n = {
    ru: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ —Å–ª–æ—Ç ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
      user:"–ê–∫–∫–∞—É–Ω—Ç", today:"–°–µ–≥–æ–¥–Ω—è", bookings:"–ë—Ä–æ–Ω–µ–π",
      step1:"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã", step2:"–°–ª–æ—Ç", step3:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
      hint:"–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ",
      fast:"üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ã—Å—Ç—Ä–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ",
      intro1:"1) –í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç (1 —Ä–∞–∑)",
      intro2:"2) –í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
      intro3:"3) –í—ã–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—ã–π —Å–ª–æ—Ç –∏ –Ω–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù",
      start:"–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
      my:"–ú–æ–∏ –±—Ä–æ–Ω–∏",
      login:"–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
      tip1:"–ü–æ–¥—Å–∫–∞–∑–∫–∞:", tip2:"–°–ª–æ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç ‚Äú—Å–≤–æ–±–æ–¥–Ω–æ/–∑–∞–Ω—è—Ç–æ‚Äù —Å—Ä–∞–∑—É ‚Äî –Ω–µ –Ω–∞–¥–æ –≤—Ä—É—á–Ω—É—é –∫—Ä—É—Ç–∏—Ç—å –≤—Ä–µ–º—è.",
      dateLabel:"–î–∞—Ç–∞",
      noteLabel:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      pickpc:"–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö:",
      next:"–î–∞–ª–µ–µ", clear:"–û—á–∏—Å—Ç–∏—Ç—å",
      selected:"–í—ã–±—Ä–∞–Ω–æ –ü–ö",
      priceLabel:"–¶–µ–Ω–∞ (GEL/—á–∞—Å)",
      slotLen:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ—Ç–∞",
      prev:"–†–∞–Ω—å—à–µ", nextWin:"–ü–æ–∑–∂–µ", window:"–û–∫–Ω–æ",
      onlyFree:"–¢–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ",
      slotHint:"–í—ã–±–µ—Ä–∏ —É–¥–æ–±–Ω—ã–π —Å–ª–æ—Ç. –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ü–ö –∑–∞–Ω—è—Ç ‚Äî —Å–ª–æ—Ç –±—É–¥–µ—Ç –∫—Ä–∞—Å–Ω—ã–π.",
      back:"–ù–∞–∑–∞–¥",
      bookNow:"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
      copied:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä.",
      copyFail:"–ù–µ —Å–º–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ‚Äî –≤—ã–¥–µ–ª–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é.",
      myTitle:"–ú–æ–∏ –±—Ä–æ–Ω–∏", myHint:"–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É",
      close:"–ó–∞–∫—Ä—ã—Ç—å", refresh:"–û–±–Ω–æ–≤–∏—Ç—å",
      colDate:"–î–∞—Ç–∞", colTime:"–í—Ä–µ–º—è", colPc:"–ü–ö", colNote:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π", colCost:"–°—Ç–æ–∏–º–æ—Å—Ç—å", colCancel:"–û—Ç–º–µ–Ω–∞",
      myCancelHint:"–û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏. –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ.",
      sideTitle:"–ü–æ–¥—Å–∫–∞–∑–∫–∞", sideHint:"—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É",
      help:
`‚úÖ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:
1) –ù–∞–∂–º–∏ ‚Äú–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è‚Äù (–æ–¥–∏–Ω —Ä–∞–∑)
2) –ù–∞–∂–º–∏ ‚Äú–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Äù
3) –í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
4) –í—ã–±–µ—Ä–∏ —Å–ª–æ—Ç (–∑–µ–ª—ë–Ω—ã–π ‚Äî –æ–∫)
5) –ù–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù

üë§ ‚Äú–ú–æ–∏ –±—Ä–æ–Ω–∏‚Äù ‚Äî –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ Firebase.`,
      rules:"–ü—Ä–∞–≤–∏–ª–∞",
      rule1:"–ù–µ–ª—å–∑—è –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –±—Ä–æ–Ω–∏ –Ω–∞ –æ–¥–Ω–æ–º –ü–ö",
      rule2:`–ú–∏–Ω–∏–º—É–º ${MIN_BOOK_MINUTES} –º–∏–Ω—É—Ç, –º–∞–∫—Å–∏–º—É–º ${MAX_BOOK_HOURS} —á–∞—Å–æ–≤`,
      rule3:`–ú–æ–∂–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –Ω–∞ ${MAX_DAYS_AHEAD} –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥`,
      rule4on:`–†–∞–±–æ—á–∏–µ —á–∞—Å—ã: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"–†–∞–±–æ—á–∏–µ —á–∞—Å—ã: 24/7",
      esc:"–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç",
      adminHint:"—Ç–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
      search:"–ü–æ–∏—Å–∫ (email/–ü–ö)",
      colUser:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
      colAct:"–î–µ–π—Å—Ç–≤–∏—è",
      msgLoginNeed:"–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.",
      msgPickPc:"–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã 1 –ü–ö.",
      msgPickSlot:"–í—ã–±–µ—Ä–∏ —Å–ª–æ—Ç.",
      msgTooFar:"–°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ. –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –±–ª–∏–∂–µ.",
      msgPast:"–ù–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º.",
      msgHours:"–í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∫–ª—É–±–∞.",
      msgOverlap:"–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –Ω–∞ –ü–ö",
      msgCreated:"–ì–æ—Ç–æ–≤–æ! –°–æ–∑–¥–∞–Ω–æ –±—Ä–æ–Ω–µ–π",
      msgNoMy:"–ù–µ—Ç –±—Ä–æ–Ω–µ–π",
      promptAdmin:"Admin –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–∞.",
      qrTitle:"QR –±—Ä–æ–Ω–∏",
      qrHint:"QR –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏.",
      logout:"Logout",
      authTitle:"–ê–∫–∫–∞—É–Ω—Ç",
      authSub:"–û–¥–∏–Ω —Ä–∞–∑ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è ‚Äî –∏ –±—Ä–æ–Ω–∏ –±—É–¥—É—Ç –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö",
      email:"Email", pass:"Password", displayName:"–ù–∏–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      doLogin:"–í–æ–π—Ç–∏", doRegister:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", doReset:"–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è",
    },
    en: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"Pick PC ‚Üí pick slot ‚Üí confirm",
      user:"Account", today:"Today", bookings:"Bookings",
      step1:"PCs", step2:"Slot", step3:"Confirm",
      hint:"super clear",
      fast:"üéÆ Fast & clear booking",
      intro1:"1) Login (one time)",
      intro2:"2) Pick PCs (multi-select)",
      intro3:"3) Pick a ready slot and tap ‚ÄúBook‚Äù",
      start:"Start booking",
      my:"My bookings",
      login:"Login / Register",
      tip1:"Tip:", tip2:"Slots show free/busy instantly ‚Äî no manual time juggling.",
      dateLabel:"Date",
      noteLabel:"Note (optional)",
      pickpc:"Pick 1 or multiple PCs:",
      next:"Next", clear:"Clear",
      selected:"Selected PCs",
      priceLabel:"Price (GEL/hour)",
      slotLen:"Slot length",
      prev:"Earlier", nextWin:"Later", window:"Window",
      onlyFree:"Only free",
      slotHint:"Pick a slot. If any selected PC is busy, slot becomes red.",
      back:"Back",
      bookNow:"Book now",
      copied:"Copied to clipboard.",
      copyFail:"Copy failed ‚Äî select and copy manually.",
      myTitle:"My bookings", myHint:"shown by account",
      close:"Close", refresh:"Refresh",
      colDate:"Date", colTime:"Time", colPc:"PC", colNote:"Note", colCost:"Cost", colCancel:"Cancel",
      myCancelHint:"You can cancel only your bookings. Admin can cancel any.",
      sideTitle:"Hint", sideHint:"so users understand fast",
      help:
`‚úÖ How to use:
1) Tap ‚ÄúLogin / Register‚Äù (one time)
2) Tap ‚ÄúStart booking‚Äù
3) Pick PCs (multi-select)
4) Pick a slot (green is OK)
5) Tap ‚ÄúBook‚Äù

üë§ ‚ÄúMy bookings‚Äù ‚Äî everything is stored in Firebase cloud.`,
      rules:"Rules",
      rule1:"No overlaps on the same PC",
      rule2:`Min ${MIN_BOOK_MINUTES} min, max ${MAX_BOOK_HOURS} hours`,
      rule3:`Max booking ahead: ${MAX_DAYS_AHEAD} days`,
      rule4on:`Working hours: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"Working hours: 24/7",
      esc:"back to start",
      adminHint:"management only",
      search:"Search (email/PC)",
      colUser:"User",
      colAct:"Actions",
      msgLoginNeed:"Please login first.",
      msgPickPc:"Select at least 1 PC.",
      msgPickSlot:"Select a slot.",
      msgTooFar:"Too far ahead. Choose a closer date.",
      msgPast:"You can‚Äôt book in the past.",
      msgHours:"Outside working hours.",
      msgOverlap:"Overlap on PC",
      msgCreated:"Done! Bookings created",
      msgNoMy:"No bookings",
      promptAdmin:"Admin access is only for admin accounts.",
      qrTitle:"Booking QR",
      qrHint:"QR updates after booking.",
      logout:"Logout",
      authTitle:"Account",
      authSub:"Register once ‚Äî bookings are shared for everyone",
      email:"Email", pass:"Password", displayName:"Nickname (optional)",
      doLogin:"Login", doRegister:"Register", doReset:"Reset password",
    },
    ka: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"·Éê·Éò·É†·É©·Éò·Éî PC ‚Üí ·Éê·Éò·É†·É©·Éò·Éî ·É°·Éö·Éù·É¢·Éò ‚Üí ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî",
      user:"·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò", today:"·Éì·É¶·Éî·É°", bookings:"·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      step1:"·Éô·Éù·Éõ·Éû·Éò·É£·É¢·Éî·É†·Éî·Éë·Éò", step2:"·É°·Éö·Éù·É¢·Éò", step3:"·Éì·Éê·Éì·Éê·É°·É¢·É£·É†·Éî·Éë·Éê",
      hint:"·Éõ·Éê·É†·É¢·Éò·Éï·Éê·Éì ·Éì·Éê ·Éú·Éê·Éó·Éö·Éê·Éì",
      fast:"üéÆ ·É°·É¨·É†·Éê·É§·Éò ·Éì·Éê ·Éí·Éê·É°·Éê·Éí·Éî·Éë·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò",
      intro1:"1) ·É®·Éî·É°·Éï·Éö·Éê (·Éî·É†·Éó·ÉÆ·Éî·Éö)",
      intro2:"2) ·Éê·Éò·É†·É©·Éò·Éî PC-·Éî·Éë·Éò (·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî)",
      intro3:"3) ·Éê·Éò·É†·É©·Éò·Éî ·Éõ·Éñ·Éê ·É°·Éö·Éù·É¢·Éò ·Éì·Éê ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê‚Äù",
      start:"·Éì·Éê·É¨·Éß·Éî·Éë·Éê",
      my:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      login:"·É®·Éî·É°·Éï·Éö·Éê / ·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê",
      tip1:"·Éõ·Éò·Éú·Éò·É®·Éú·Éî·Éë·Éê:", tip2:"·É°·Éö·Éù·É¢·Éî·Éë·Éò ·Éì·Éê·É£·Éß·Éù·Éï·Éú·Éî·Éë·Éö·Éò·Éï ·Éê·É©·Éï·Éî·Éú·Éî·Éë·É° ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò·Éê/·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê.",
      dateLabel:"·Éó·Éê·É†·Éò·É¶·Éò",
      noteLabel:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù)",
      pickpc:"·Éê·Éò·É†·É©·Éò·Éî 1 ·Éê·Éú ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC:",
      next:"·É®·Éî·Éõ·Éì·Éî·Éí·Éò", clear:"·Éí·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê",
      selected:"·Éê·É†·É©·Éî·É£·Éö·Éò PC",
      priceLabel:"·É§·Éê·É°·Éò (GEL/·É°·Éê·Éê·Éó·Éò)",
      slotLen:"·É°·Éö·Éù·É¢·Éò·É° ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê",
      prev:"·Éê·Éì·É†·Éî", nextWin:"·Éõ·Éù·Éí·Éï·Éò·Éê·Éú·Éî·Éë·Éò·Éó", window:"·É§·Éê·Éú·ÉØ·Éê·É†·Éê",
      onlyFree:"·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò",
      slotHint:"·Éê·Éò·É†·É©·Éò·Éî ·É°·Éö·Éù·É¢·Éò. ·Éó·É£ ·É†·Éù·Éõ·Éî·Éö·Éò·Éõ·Éî PC ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê ‚Äî ·É°·Éö·Éù·É¢·Éò ·É¨·Éò·Éó·Éî·Éö·Éò·Éê.",
      back:"·É£·Éô·Éê·Éú",
      bookNow:"·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê",
      copied:"·Éô·Éù·Éû·Éò·É†·Éî·Éë·É£·Éö·Éò·Éê.",
      copyFail:"·Éô·Éù·Éû·Éò·É†·Éî·Éë·Éê ·Éï·Éî·É† ·Éõ·Éù·ÉÆ·Éî·É†·ÉÆ·Éì·Éê ‚Äî ·ÉÆ·Éî·Éö·Éò·Éó ·Éì·Éê·Éê·Éô·Éù·Éû·Éò·É†·Éî.",
      myTitle:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò", myHint:"·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò·Éó ·É©·Éê·Éú·É°",
      close:"·Éì·Éê·ÉÆ·É£·É†·Éï·Éê", refresh:"·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·Éê",
      colDate:"·Éó·Éê·É†·Éò·É¶·Éò", colTime:"·Éì·É†·Éù", colPc:"PC", colNote:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê", colCost:"·É§·Éê·É°·Éò", colCancel:"·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê",
      myCancelHint:"·É®·Éî·Éú ·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê ·Éí·Éê·Éê·É£·É•·Éõ·Éù ·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·É®·Éî·Éú·Éò. ·Éê·Éì·Éõ·Éò·Éú·É° ·É®·Éî·É£·É´·Éö·Éò·Éê ·Éß·Éï·Éî·Éö·Éê.",
      sideTitle:"·Éõ·Éò·Éú·Éò·É®·Éú·Éî·Éë·Éê", sideHint:"·É°·É¨·É†·Éê·É§·Éê·Éì ·Éí·Éê·É°·Éê·Éí·Éî·Éë·Éê·Éì",
      help:
`‚úÖ ·Éí·Éê·Éõ·Éù·Éß·Éî·Éú·Éî·Éë·Éê:
1) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·É®·Éî·É°·Éï·Éö·Éê / ·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê‚Äù (·Éî·É†·Éó·ÉÆ·Éî·Éö)
2) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·É¨·Éß·Éî·Éë·Éê‚Äù
3) ·Éê·Éò·É†·É©·Éò·Éî PC-·Éî·Éë·Éò
4) ·Éê·Éò·É†·É©·Éò·Éî ·É°·Éö·Éù·É¢·Éò (·Éõ·É¨·Éï·Éê·Éú·Éî ‚Äî OK)
5) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê‚Äù

üë§ ‚Äú·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò‚Äù ‚Äî ·Éß·Éï·Éî·Éö·Éê·É§·Éî·É†·Éò ·Éò·Éú·Éê·ÉÆ·Éî·Éë·Éê Firebase-·É®·Éò.`,
      rules:"·É¨·Éî·É°·Éî·Éë·Éò",
      rule1:"·Éî·É†·Éó PC-·Éñ·Éî ·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê",
      rule2:`·Éõ·Éò·Éú ${MIN_BOOK_MINUTES} ·É¨·Éó, ·Éõ·Éê·É•·É° ${MAX_BOOK_HOURS} ·É°·Éó`,
      rule3:`·Éõ·Éê·É•·É° ·É¨·Éò·Éú·Éê·É°·É¨·Éê·É†: ${MAX_DAYS_AHEAD} ·Éì·É¶·Éî`,
      rule4on:`·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·Éò: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·Éò: 24/7",
      esc:"·Éì·Éê·Éë·É†·É£·Éú·Éî·Éë·Éê ·Éì·Éê·É°·Éê·É¨·Éß·Éò·É°·Éñ·Éî",
      adminHint:"·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éõ·Éê·É†·Éó·Éï·Éê",
      search:"·É´·Éî·Éë·Éú·Éê (email/PC)",
      colUser:"·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò",
      colAct:"·É•·Éõ·Éî·Éì·Éî·Éë·Éê",
      msgLoginNeed:"·ÉØ·Éî·É† ·É®·Éî·Éì·Éò ·Éê·Éú·Éí·Éê·É†·Éò·É®·É®·Éò.",
      msgPickPc:"·Éê·Éò·É†·É©·Éò·Éî ·Éõ·Éò·Éú·Éò·Éõ·É£·Éõ 1 PC.",
      msgPickSlot:"·Éê·Éò·É†·É©·Éò·Éî ·É°·Éö·Éù·É¢·Éò.",
      msgTooFar:"·É´·Éê·Éö·Éò·Éê·Éú ·É®·Éù·É†·É°·Éê·Éê. ·Éê·Éò·É†·É©·Éò·Éî ·Éê·ÉÆ·Éö·Éù ·Éó·Éê·É†·Éò·É¶·Éò.",
      msgPast:"·É¨·Éê·É†·É°·É£·Éö·É®·Éò ·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê.",
      msgHours:"·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·É° ·Éí·Éê·É†·Éî·Éó·Éê·Éê.",
      msgOverlap:"·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê PC-·Éñ·Éî",
      msgCreated:"·Éõ·Éñ·Éê·Éì·Éê·Éê! ·É®·Éî·É•·Éõ·Éú·Éò·Éö·Éò·Éê ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      msgNoMy:"·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·É† ·Éê·É†·Éò·É°",
      promptAdmin:"Admin ·Éõ·ÉÆ·Éù·Éö·Éù·Éì admin-·Éê·Éú·Éí·Éê·É†·Éò·É®·Éî·Éë·Éò·É°·Éó·Éï·Éò·É°·Éê·Éê.",
      qrTitle:"QR ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò",
      qrHint:"QR ·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éì·Éî·Éë·Éê ·ÉØ·Éê·Éï·É®·Éú·Éò·É° ·É®·Éî·Éõ·Éì·Éî·Éí.",
      logout:"Logout",
      authTitle:"·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò",
      authSub:"·Éî·É†·Éó·ÉÆ·Éî·Éö ·Éì·Éê·É†·Éî·Éí·Éò·É°·É¢·É†·Éò·É†·Éì·Éò ‚Äî ·Éì·Éê ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò ·É°·Éê·Éî·É†·Éó·Éù ·Éò·É•·Éú·Éî·Éë·Éê",
      email:"Email", pass:"Password", displayName:"·Éú·Éò·Éô·Éò (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù)",
      doLogin:"·É®·Éî·É°·Éï·Éö·Éê", doRegister:"·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê", doReset:"·Éû·Éê·É†·Éù·Éö·Éò·É° ·É®·Éî·É™·Éï·Éö·Éê",
    }
  };

  // =========================
  // Helpers
  // =========================
  const $ = (id) => document.getElementById(id);
  const pad2 = (n)=>String(n).padStart(2,"0");
  const toISODate = (d)=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const parseISODate = (iso)=>{ const [y,m,d]=iso.split("-").map(Number); return new Date(y, m-1, d, 0,0,0,0); };
  const minutesFrom = (t)=>{ const [h,m]=t.split(":").map(Number); return h*60+m; };
  const timeFromMin = (min)=>{ min=Math.max(0,Math.min(1440,min)); const h=Math.floor(min/60), m=min%60; return `${pad2(h)}:${pad2(m)}`; };
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  const money = (n)=>`${Number(n||0).toFixed(2)} GEL`;
  const addDays = (d, days)=>{ const x=new Date(d); x.setDate(x.getDate()+days); return x; };
  const escapeHtml = (s)=>String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");

  function intersects(a1,a2,b1,b2){
    return Math.max(a1.getTime(), b1.getTime()) < Math.min(a2.getTime(), b2.getTime());
  }
  function minutesBetween(a,b){ return Math.round((b - a)/60000); }
  function calcPriceGel(pricePerHour, mins){
    return Math.round((Number(pricePerHour)*(mins/60))*2)/2; // —à–∞–≥ 0.5
  }

  // working hours window
  function withinWorkingHours(startMin, endMin){
    if(!WORKING_HOURS_ENABLED) return true;
    const ws = minutesFrom(WORK_START);
    const we = minutesFrom(WORK_END);
    const within = (m) => {
      if(we > ws) return m >= ws && m <= we;
      return (m >= ws && m <= 1440) || (m >= 0 && m <= we);
    };
    return within(startMin) && within(endMin);
  }

  // =========================
  // Init Firebase
  // =========================
  let app, auth, db;
  let firebaseOk = true;
  try{
    app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    db = getFirestore(app);
  }catch(e){
    firebaseOk = false;
    console.warn("Firebase init failed:", e);
  }

  // =========================
  // State
  // =========================
  let lang = localStorage.getItem(LANG_KEY) || "ru";
  if(!i18n[lang]) lang = "ru";

  let onlyFree = localStorage.getItem(ONLY_FREE_KEY) === "1";
  let selectedPCs = new Set();

  let slotLen = Number(localStorage.getItem(SLOT_LEN_KEY) || "60");
  let slotWinHours = Number(localStorage.getItem(SLOT_WIN_KEY) || String(DEFAULT_SLOT_WINDOW_HOURS));

  let slotWindowStartMin = null;  // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
  let selectedSlot = null; // {startStr,endStr,startAbs,endAbs,spansMidnight}

  let currentUser = null;
  let isAdmin = false;

  // cached bookings list from Firestore
  let bookings = []; // {id, uid, email, pcs[], dateStart, start, end, spansMidnight, note, totalGel, perPcGel, createdAt}

  // Realtime listener unsubscribe
  let unsubBookings = null;

  // =========================
  // i18n apply
  // =========================
  function t(k){ return i18n[lang][k] ?? i18n["ru"][k] ?? k; }

  function applyLang(){
    $("t_title").textContent = t("title");
    $("t_sub").textContent = t("sub");
    $("t_user").textContent = t("user");
    $("t_today").textContent = t("today");
    $("t_bookings").textContent = t("bookings");

    $("t_step1").textContent = t("step1");
    $("t_step2").textContent = t("step2");
    $("t_step3").textContent = t("step3");
    $("t_hint").textContent = t("hint");

    $("t_fast").textContent = t("fast");
    $("t_intro1").textContent = t("intro1");
    $("t_intro2").textContent = t("intro2");
    $("t_intro3").textContent = t("intro3");

    $("t_start").textContent = t("start");
    $("t_my").textContent = t("my");
    $("t_my2").textContent = t("my");
    $("t_login").textContent = t("login");

    $("t_tip1").textContent = t("tip1");
    $("t_tip2").textContent = t("tip2");

    $("t_dateLabel").textContent = t("dateLabel");
    $("t_noteLabel").textContent = t("noteLabel");
    $("t_pickpc").textContent = t("pickpc");
    $("t_next").textContent = t("next");
    $("t_next2").textContent = t("next");
    $("t_clear").textContent = t("clear");
    $("t_selected").textContent = t("selected");

    $("t_priceLabel").textContent = t("priceLabel");
    $("t_slotLen").textContent = t("slotLen");
    $("t_prev").textContent = t("prev");
    $("t_nextWin").textContent = t("nextWin");
    $("t_window").textContent = t("window");
    $("t_onlyFree").textContent = t("onlyFree");
    $("slotHintBox").textContent = t("slotHint");

    $("t_back").textContent = t("back");
    $("t_back2").textContent = t("back");
    $("t_bookNow").textContent = t("bookNow");

    $("t_myTitle").textContent = t("myTitle");
    $("t_myHint").textContent = t("myHint");
    $("t_close").textContent = t("close");
    $("t_refresh").textContent = t("refresh");

    $("t_colDate").textContent = t("colDate");
    $("t_colTime").textContent = t("colTime");
    $("t_colPc").textContent = t("colPc");
    $("t_colNote").textContent = t("colNote");
    $("t_colCost").textContent = t("colCost");
    $("t_colCancel").textContent = t("colCancel");
    $("t_myCancelHint").textContent = t("myCancelHint");

    $("t_sideTitle").textContent = t("sideTitle");
    $("t_sideHint").textContent = t("sideHint");
    $("helpBox").textContent = t("help");

    $("rulesBox").innerHTML = `
      <b>${t("rules")}</b><br/>
      ‚Ä¢ ${t("rule1")}<br/>
      ‚Ä¢ ${t("rule2")}<br/>
      ‚Ä¢ ${t("rule3")}<br/>
      ‚Ä¢ ${WORKING_HOURS_ENABLED ? t("rule4on") : t("rule4off")}
    `;

    $("t_esc").textContent = t("esc");
    $("t_adminHint").textContent = t("adminHint");
    $("t_search").textContent = t("search");

    $("t_colDate2").textContent = t("colDate");
    $("t_colTime2").textContent = t("colTime");
    $("t_colPc2").textContent = t("colPc");
    $("t_colNick2").textContent = t("colUser");
    $("t_colCost2").textContent = t("colCost");
    $("t_colAct2").textContent = t("colAct");

    $("t_qrTitle").textContent = t("qrTitle");
    $("qrHint").textContent = t("qrHint");

    $("t_logout").textContent = t("logout");

    $("t_authTitle").textContent = t("authTitle");
    $("t_authSub").textContent = t("authSub");
    $("t_email").textContent = t("email");
    $("t_pass").textContent = t("pass");
    $("t_displayName").textContent = t("displayName");
    $("t_doLogin").textContent = t("doLogin");
    $("t_doRegister").textContent = t("doRegister");
    $("t_doReset").textContent = t("doReset");

    $("lang_ru").classList.toggle("active", lang==="ru");
    $("lang_en").classList.toggle("active", lang==="en");
    $("lang_ka").classList.toggle("active", lang==="ka");

    $("toggleOnlyFreeBtn").classList.toggle("primary", onlyFree);
  }

  // =========================
  // UI flow
  // =========================
  function setStep(n){
    $("step1").classList.toggle("active", n===1);
    $("step2").classList.toggle("active", n===2);
    $("step3").classList.toggle("active", n===3);
    $("step1Box").classList.toggle("hide", n!==1);
    $("step2Box").classList.toggle("hide", n!==2);
    $("step3Box").classList.toggle("hide", n!==3);
    $("introBox").classList.add("hide");
  }
  function showIntro(){
    $("introBox").classList.remove("hide");
    $("step1Box").classList.add("hide");
    $("step2Box").classList.add("hide");
    $("step3Box").classList.add("hide");
    $("step1").classList.remove("active");
    $("step2").classList.remove("active");
    $("step3").classList.remove("active");
  }
  function setMsg(text, kind="info"){
    const el = $("msg");
    el.textContent = text;
    el.style.borderColor =
      kind==="good" ? "rgba(52,211,153,.45)" :
      kind==="bad" ? "rgba(251,113,133,.55)" :
      "rgba(110,231,255,.35)";
    el.style.background =
      kind==="good" ? "rgba(52,211,153,.08)" :
      kind==="bad" ? "rgba(251,113,133,.08)" :
      "rgba(110,231,255,.06)";
  }

  function renderPills(){
    $("countPill").textContent = String(bookings.length);
    $("todayPill").textContent = new Date().toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
    $("userPill").textContent = currentUser
      ? (currentUser.displayName ? currentUser.displayName : (currentUser.email || "user"))
      : "‚Äî";
  }

  // =========================
  // Selection PCs
  // =========================
  function renderSelected(){
    $("selectedCount").textContent = String(selectedPCs.size);
    const chips = $("selectedChips");
    chips.innerHTML = "";
    if(selectedPCs.size===0){
      chips.innerHTML = `<span class="hint">‚Äî</span>`;
      return;
    }
    for(const pc of Array.from(selectedPCs)){
      const ch = document.createElement("div");
      ch.className = "pcchip";
      ch.innerHTML = `${pc} <span class="x">√ó</span>`;
      ch.addEventListener("click", () => {
        selectedPCs.delete(pc);
        renderSelected();
        renderPCGrid();
        rebuildSlots();
        renderSummary();
      });
      chips.appendChild(ch);
    }
  }

  function renderPCGrid(){
    const grid = $("pcGrid");
    grid.innerHTML = "";
    for(const pc of PCs){
      const div = document.createElement("div");
      div.className = "pc";
      if(selectedPCs.has(pc)) div.classList.add("selected");
      div.innerHTML = `
        <div class="check">‚úì</div>
        <div class="name">${pc}</div>
        <div class="meta">
          <span class="tag"><span class="dot good"></span>${selectedPCs.has(pc) ? "Selected" : "Tap"}</span>
          <span class="mut">‚Äî</span>
        </div>
      `;
      div.addEventListener("click", () => {
        if(selectedPCs.has(pc)) selectedPCs.delete(pc); else selectedPCs.add(pc);
        renderSelected();
        renderPCGrid();
        rebuildSlots();
        renderSummary();
      });
      grid.appendChild(div);
    }
  }

  // =========================
  // Booking range helpers
  // =========================
  function makeAbsRange(dateISO, startStr, endStr){
    const d0 = parseISODate(dateISO);
    const sMin = minutesFrom(startStr);
    const eMin = minutesFrom(endStr);
    const startAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(sMin/60), sMin%60, 0, 0);
    let spansMidnight = false;
    let endAbs;
    if(eMin > sMin){
      endAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(eMin/60), eMin%60, 0, 0);
    }else{
      spansMidnight = true;
      const d1 = addDays(d0, 1);
      endAbs = new Date(d1.getFullYear(), d1.getMonth(), d1.getDate(), Math.floor(eMin/60), eMin%60, 0, 0);
    }
    return {dateStartISO: dateISO, startStr, endStr, startAbs, endAbs, spansMidnight};
  }

  function bookingToAbs(b){
    const dateISO = b.dateStart;
    return makeAbsRange(dateISO, b.start, b.end);
  }

  function conflictForPcInRange(pc, range){
    // conflict if any booking contains this pc
    for(const b of bookings){
      if(!b.pcs || !Array.isArray(b.pcs)) continue;
      if(!b.pcs.includes(pc)) continue;
      const br = bookingToAbs(b);
      if(intersects(range.startAbs, range.endAbs, br.startAbs, br.endAbs)) return b;
    }
    return null;
  }

  function anyConflictForSelection(range){
    for(const pc of selectedPCs){
      const c = conflictForPcInRange(pc, range);
      if(c) return {pc, booking:c};
    }
    return null;
  }

  // =========================
  // Slots building (new logic)
  // =========================
  function computeSlotWindowBase(){
    // start from "now rounded" if date is today; else default to WORK_START
    const dateISO = $("date").value;
    const d0 = parseISODate(dateISO);
    const todayISO = toISODate(new Date());

    let baseMin;
    if(dateISO === todayISO){
      const now = new Date();
      baseMin = now.getHours()*60 + now.getMinutes();
      baseMin = Math.ceil(baseMin / SLOT_STEP_MINUTES) * SLOT_STEP_MINUTES;
    }else{
      baseMin = minutesFrom(WORK_START);
    }

    // clamp base inside working window roughly (if enabled)
    baseMin = clamp(baseMin, 0, 1440 - SLOT_STEP_MINUTES);
    return baseMin;
  }

  function rebuildSlots(forceKeepSelected=false){
    const dateISO = $("date").value;
    if(!dateISO) return;

    if(slotWindowStartMin === null) slotWindowStartMin = computeSlotWindowBase();

    // if selected slot went out of window and not forced, clear
    if(!forceKeepSelected) selectedSlot = null;

    const startMin = slotWindowStartMin;
    const endMin = startMin + slotWinHours*60;

    $("slotWindowPill").textContent = `${timeFromMin(startMin)} ‚Üí ${timeFromMin(Math.min(endMin, 1440))}`;

    const grid = $("slotGrid");
    grid.innerHTML = "";

    const len = Number($("slotLen").value || slotLen);
    const pricePerHour = Number($("price").value || 5);

    // build slots from startMin to endMin-len, step SLOT_STEP_MINUTES
    for(let m = startMin; m + len <= Math.min(endMin, 1440); m += SLOT_STEP_MINUTES){
      const sStr = timeFromMin(m);
      const eStr = timeFromMin(m + len);

      // working hours check (end time is local endStr)
      if(!withinWorkingHours(m, m+len)){
        // mark disabled by skipping
        continue;
      }

      const range = makeAbsRange(dateISO, sStr, eStr);

      // past check
      const now = new Date();
      const inPast = range.startAbs.getTime() < now.getTime();

      // conflict check for selection
      let conflict = null;
      if(selectedPCs.size > 0){
        conflict = anyConflictForSelection(range);
      }

      // determine status
      let isFree = !conflict && !inPast;
      if(onlyFree && !isFree) continue;

      const mins = minutesBetween(range.startAbs, range.endAbs);
      const perPc = calcPriceGel(pricePerHour, mins);
      const total = perPc * selectedPCs.size;

      const div = document.createElement("div");
      div.className = "slot " + (isFree ? "free" : "busy");
      if(selectedSlot && selectedSlot.startStr === sStr && selectedSlot.endStr === eStr) div.classList.add("selected");

      div.innerHTML = `
        <div class="t1">${escapeHtml(sStr)} ‚Üí ${escapeHtml(eStr)}</div>
        <div class="t2">
          <span class="badge ${isFree ? "ok" : "bad"}">${isFree ? "FREE" : "BUSY"}</span>
          <span class="mut">${selectedPCs.size ? ("PCs: " + selectedPCs.size) : "Select PCs"}</span>
          <span class="mut">${selectedPCs.size ? ("Total: " + money(total)) : ""}</span>
        </div>
      `;

      div.addEventListener("click", () => {
        if(!currentUser){
          alert(t("msgLoginNeed"));
          return;
        }
        if(selectedPCs.size===0){
          alert(t("msgPickPc"));
          return;
        }
        if(inPast){
          alert(t("msgPast"));
          return;
        }
        if(conflict){
          alert(`${t("msgOverlap")} ${conflict.pc}: ${conflict.booking.start}‚Üí${conflict.booking.end}`);
          return;
        }
        selectedSlot = range;
        rebuildSlots(true);
        renderSummary();
      });

      grid.appendChild(div);
    }

    $("slotHintBox").textContent = t("slotHint");
  }

  // =========================
  // Summary + QR + share
  // =========================
  function buildShareText(booking){
    const pcs = booking.pcs.join(", ");
    const when = booking.spansMidnight
      ? `${booking.dateStart} ${booking.start} ‚Üí ${addDays(parseISODate(booking.dateStart),1).toISOString().slice(0,10)} ${booking.end}`
      : `${booking.dateStart} ${booking.start} ‚Üí ${booking.end}`;

    return [
      "Sakompiutere Booking",
      `User: ${booking.email || booking.uid}`,
      `PCs: ${pcs}`,
      `Time: ${when}`,
      booking.note ? `Note: ${booking.note}` : null,
      `Cost per PC: ${money(booking.perPcGel)}`,
      `Total: ${money(booking.totalGel)}`
    ].filter(Boolean).join("\n");
  }

  function renderQR(text){
    const canvas = $("qrCanvas");
    if(!window.QRCode || !QRCode.toCanvas){
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#111"; ctx.font="12px sans-serif";
      ctx.fillText("QR lib not loaded", 20, 80);
      return;
    }
    QRCode.toCanvas(canvas, text, { width: 160, margin: 1 }, () => {});
  }

  async function copyShare(){
    if(!selectedSlot || selectedPCs.size===0 || !currentUser){
      setMsg(t("msgPickSlot"), "bad");
      return;
    }
    const mins = minutesBetween(selectedSlot.startAbs, selectedSlot.endAbs);
    const perPc = calcPriceGel(Number($("price").value||5), mins);
    const total = perPc * selectedPCs.size;

    const temp = {
      uid: currentUser.uid,
      email: currentUser.email,
      dateStart: selectedSlot.dateStartISO,
      start: selectedSlot.startStr,
      end: selectedSlot.endStr,
      spansMidnight: selectedSlot.spansMidnight,
      pcs: Array.from(selectedPCs),
      note: ($("note").value||"").trim(),
      perPcGel: perPc,
      totalGel: total,
    };
    const text = buildShareText(temp);

    try{
      await navigator.clipboard.writeText(text);
      setMsg(t("copied"), "good");
    }catch(e){
      setMsg(t("copyFail"), "bad");
    }
  }

  function renderSummary(){
    const note = ($("note").value || "").trim();
    const pcs = Array.from(selectedPCs);
    const pricePerHour = Number($("price").value || 5);

    let perPc=0, total=0, when="‚Äî", dur="‚Äî";
    if(selectedSlot){
      const mins = minutesBetween(selectedSlot.startAbs, selectedSlot.endAbs);
      perPc = calcPriceGel(pricePerHour, mins);
      total = perPc * pcs.length;
      dur = `${mins} min`;
      when = selectedSlot.spansMidnight
        ? `${selectedSlot.dateStartISO} ${selectedSlot.startStr} ‚Üí ${addDays(parseISODate(selectedSlot.dateStartISO),1).toISOString().slice(0,10)} ${selectedSlot.endStr}`
        : `${selectedSlot.dateStartISO} ${selectedSlot.startStr} ‚Üí ${selectedSlot.endStr}`;
    }

    $("summaryBox").innerHTML = `
      <b>${t("step3")}</b><br/>
      ‚Ä¢ ${t("user")}: <b>${escapeHtml(currentUser ? (currentUser.email || currentUser.uid) : "‚Äî")}</b><br/>
      ‚Ä¢ ${t("colTime")}: <b>${escapeHtml(when)}</b> <span class="hint">(${dur})</span><br/>
      ‚Ä¢ ${t("selected")}: <b>${pcs.length}</b><br/>
      ‚Ä¢ PCs: <b>${escapeHtml(pcs.length ? pcs.join(", ") : "‚Äî")}</b><br/>
      ‚Ä¢ ${t("colCost")} (per PC): <b>${money(perPc)}</b><br/>
      ‚Ä¢ ${t("colCost")} total: <b>${money(total)}</b><br/>
      ${note ? ("‚Ä¢ "+t("colNote")+": <b>"+escapeHtml(note)+"</b><br/>") : ""}
    `;
  }

  // =========================
  // Firestore: live bookings
  // =========================
  function dateRangeForListener(dateISO){
    // listen for selected date only (+ optional next day if spans midnight exists)
    // for simplicity: we listen all bookings with dateStart == dateISO
    return dateISO;
  }

  function startBookingsListener(){
    if(!firebaseOk || !db) return;
    if(unsubBookings) unsubBookings();

    const dateISO = $("date").value;
    const qDate = dateRangeForListener(dateISO);

    const qy = query(
      collection(db, "bookings"),
      where("dateStart", "==", qDate),
      orderBy("start", "asc"),
      limit(500)
    );

    unsubBookings = onSnapshot(qy, (snap) => {
      bookings = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderPills();
      if($("step2Box") && !$("step2Box").classList.contains("hide")) rebuildSlots(true);
      renderMyTable();
      renderAdminTable();
    }, (err) => {
      console.warn("onSnapshot error:", err);
    });
  }

  // =========================
  // Create booking (Firestore)
  // =========================
  async function createBooking(){
    if(!currentUser){
      setMsg(t("msgLoginNeed"), "bad");
      return;
    }
    if(selectedPCs.size===0){
      setMsg(t("msgPickPc"), "bad");
      return;
    }
    if(!selectedSlot){
      setMsg(t("msgPickSlot"), "bad");
      return;
    }

    // validate date ahead
    const d0 = parseISODate(selectedSlot.dateStartISO);
    const today0 = parseISODate(toISODate(new Date()));
    const diffDays = Math.round((d0 - today0)/86400000);
    if(diffDays > MAX_DAYS_AHEAD){
      setMsg(t("msgTooFar"), "bad");
      return;
    }

    // past check
    if(selectedSlot.startAbs.getTime() < new Date().getTime()){
      setMsg(t("msgPast"), "bad");
      return;
    }

    // duration check
    const mins = minutesBetween(selectedSlot.startAbs, selectedSlot.endAbs);
    if(mins < MIN_BOOK_MINUTES || mins > MAX_BOOK_HOURS*60){
      setMsg("Invalid duration", "bad");
      return;
    }

    // conflicts check (fresh)
    const conflict = anyConflictForSelection(selectedSlot);
    if(conflict){
      setMsg(`${t("msgOverlap")} ${conflict.pc}`, "bad");
      return;
    }

    const pricePerHour = Number($("price").value || 5);
    const perPc = calcPriceGel(pricePerHour, mins);
    const total = perPc * selectedPCs.size;

    const payload = {
      uid: currentUser.uid,
      email: currentUser.email || "",
      displayName: currentUser.displayName || "",
      pcs: Array.from(selectedPCs),
      dateStart: selectedSlot.dateStartISO,
      start: selectedSlot.startStr,
      end: selectedSlot.endStr,
      spansMidnight: selectedSlot.spansMidnight,
      note: ($("note").value||"").trim(),
      pricePerHour,
      perPcGel: perPc,
      totalGel: total,
      createdAt: serverTimestamp()
    };

    try{
      const ref = await addDoc(collection(db, "bookings"), payload);
      setMsg(`${t("msgCreated")}: 1`, "good");

      // QR for this booking
      const shareText = buildShareText({ ...payload, id: ref.id });
      renderQR(shareText);

      // move to my bookings view
      renderMyTable();
      renderAdminTable();
    }catch(e){
      console.error(e);
      setMsg("Firestore error (check rules).", "bad");
    }
  }

  // =========================
  // My bookings (by uid)
  // =========================
  function renderMyTable(){
    const tbody = $("myTable");
    tbody.innerHTML = "";

    if(!currentUser){
      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">Login required</td></tr>`;
      return;
    }

    const list = bookings
      .filter(b => b.uid === currentUser.uid)
      .sort((a,b)=> (a.dateStart+a.start).localeCompare(b.dateStart+b.start));

    if(!list.length){
      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">${t("msgNoMy")}</td></tr>`;
      return;
    }

    for(const b of list){
      const timeStr = `${b.start} ‚Üí ${b.end}${b.spansMidnight ? " (+1)" : ""}`;
      const pcsStr = (b.pcs||[]).join(", ");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(b.dateStart)}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(pcsStr)}</b></td>
        <td style="color:var(--muted)">${escapeHtml(b.note || "")}</td>
        <td>${money(b.totalGel)}</td>
        <td><button class="mini danger" data-id="${b.id}">Cancel</button></td>
      `;
      tbody.appendChild(tr);
    }

    tbody.querySelectorAll("button[data-id]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const id = btn.getAttribute("data-id");
        if(!confirm(`Cancel booking?`)) return;
        try{
          await deleteDoc(doc(db, "bookings", id));
        }catch(e){
          console.error(e);
          alert("Delete error (rules?)");
        }
      });
    });
  }

  // =========================
  // Admin
  // =========================
  function updateAdminFlag(){
    const email = (currentUser && currentUser.email) ? currentUser.email.toLowerCase() : "";
    isAdmin = !!email && ADMIN_EMAILS.map(x=>x.toLowerCase()).includes(email);
    $("adminBox").classList.toggle("hide", !isAdmin);
  }

  function renderAdminTable(){
    $("adminBox").classList.toggle("hide", !isAdmin);
    const tbody = $("bookTable");
    tbody.innerHTML = "";
    if(!isAdmin) return;

    const q = ($("search").value||"").trim().toLowerCase();
    const list = bookings
      .filter(b => !q || (b.email||"").toLowerCase().includes(q) || (b.pcs||[]).join(",").toLowerCase().includes(q))
      .sort((a,b)=> (a.dateStart+a.start).localeCompare(b.dateStart+b.start));

    for(const b of list){
      const timeStr = `${b.start} ‚Üí ${b.end}${b.spansMidnight ? " (+1)" : ""}`;
      const pcsStr = (b.pcs||[]).join(", ");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(b.dateStart)}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(pcsStr)}</b></td>
        <td><b>${escapeHtml(b.email || b.uid)}</b></td>
        <td>${money(b.totalGel)}</td>
        <td><button class="mini danger" data-id="${b.id}">Delete</button></td>
      `;
      tbody.appendChild(tr);
    }

    tbody.querySelectorAll("button[data-id]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const id = btn.getAttribute("data-id");
        if(!confirm("Delete booking?")) return;
        await deleteDoc(doc(db, "bookings", id));
      });
    });
  }

  async function wipeAllDev(){
    if(!isAdmin) return;
    if(!confirm("DEV WIPE: Delete ALL bookings in this date view?")) return;

    // delete only current loaded bookings (dateStart == selected date)
    try{
      const batch = writeBatch(db);
      for(const b of bookings){
        batch.delete(doc(db, "bookings", b.id));
      }
      await batch.commit();
    }catch(e){
      console.error(e);
      alert("Wipe error (rules?)");
    }
  }

  // =========================
  // Auth modal
  // =========================
  function openAuth(){
    $("authBack").classList.add("show");
    $("authMsg").textContent = firebaseOk ? "‚Äî" : "Firebase config missing / wrong";
  }
  function closeAuth(){
    $("authBack").classList.remove("show");
  }
  function setAuthMsg(s){ $("authMsg").textContent = s; }

  async function doLogin(){
    if(!firebaseOk) return setAuthMsg("Firebase init failed.");
    const email = ($("authEmail").value||"").trim();
    const pass = ($("authPass").value||"").trim();
    if(!email || !pass) return setAuthMsg("Fill email + password");
    try{
      await signInWithEmailAndPassword(auth, email, pass);
      setAuthMsg("OK");
      closeAuth();
    }catch(e){
      console.error(e);
      setAuthMsg(e.code || "login error");
    }
  }

  async function doRegister(){
    if(!firebaseOk) return setAuthMsg("Firebase init failed.");
    const email = ($("authEmail").value||"").trim();
    const pass = ($("authPass").value||"").trim();
    const nick = ($("authNick").value||"").trim();
    if(!email || !pass) return setAuthMsg("Fill email + password");
    try{
      const cred = await createUserWithEmailAndPassword(auth, email, pass);
      if(nick){
        await updateProfile(cred.user, { displayName: nick });
      }
      setAuthMsg("Registered OK");
      closeAuth();
    }catch(e){
      console.error(e);
      setAuthMsg(e.code || "register error");
    }
  }

  async function doReset(){
    if(!firebaseOk) return setAuthMsg("Firebase init failed.");
    const email = ($("authEmail").value||"").trim();
    if(!email) return setAuthMsg("Enter email");
    try{
      await sendPasswordResetEmail(auth, email);
      setAuthMsg("Reset email sent");
    }catch(e){
      console.error(e);
      setAuthMsg(e.code || "reset error");
    }
  }

  // =========================
  // Boot
  // =========================
  function boot(){
    const now = new Date();
    $("todayPill").textContent = now.toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
    $("date").value = toISODate(now);

    // restore settings
    $("slotLen").value = String(slotLen);
    $("toggleOnlyFreeBtn").classList.toggle("primary", onlyFree);

    // apply language
    applyLang();

    // initial UI
    renderPCGrid();
    renderSelected();

    slotWindowStartMin = computeSlotWindowBase();
    rebuildSlots();

    renderSummary();
    showIntro();

    // language buttons
    $("lang_ru").onclick = () => { lang="ru"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };
    $("lang_en").onclick = () => { lang="en"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };
    $("lang_ka").onclick = () => { lang="ka"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };

    // intro buttons
    $("startBtn").onclick = () => {
      if(!currentUser){ alert(t("msgLoginNeed")); return; }
      setStep(1);
    };
    $("viewMyBtn").onclick = () => {
      $("myBox").classList.remove("hide");
      renderMyTable();
      $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("loginBtn").onclick = openAuth;

    // auth modal
    $("authCloseBtn").onclick = closeAuth;
    $("authBack").addEventListener("click", (e)=>{ if(e.target === $("authBack")) closeAuth(); });
    $("doLoginBtn").onclick = doLogin;
    $("doRegisterBtn").onclick = doRegister;
    $("doResetBtn").onclick = doReset;

    // step1
    $("clearPcBtn").onclick = () => { selectedPCs.clear(); renderSelected(); renderPCGrid(); rebuildSlots(); renderSummary(); };

    $("toStep2Btn").onclick = () => {
      if(!currentUser){ alert(t("msgLoginNeed")); return; }
      if(selectedPCs.size===0){ alert(t("msgPickPc")); return; }
      setStep(2);
      rebuildSlots();
      renderSummary();
    };

    $("date").addEventListener("change", ()=>{
      slotWindowStartMin = computeSlotWindowBase();
      selectedSlot = null;
      rebuildSlots();
      startBookingsListener();
      renderSummary();
    });

    $("note").addEventListener("input", ()=>renderSummary());
    $("price").addEventListener("input", ()=>{ rebuildSlots(true); renderSummary(); });

    $("slotLen").addEventListener("change", ()=>{
      slotLen = Number($("slotLen").value || 60);
      localStorage.setItem(SLOT_LEN_KEY, String(slotLen));
      selectedSlot = null;
      rebuildSlots();
      renderSummary();
    });

    $("toggleOnlyFreeBtn").onclick = () => {
      onlyFree = !onlyFree;
      localStorage.setItem(ONLY_FREE_KEY, onlyFree ? "1":"0");
      $("toggleOnlyFreeBtn").classList.toggle("primary", onlyFree);
      rebuildSlots(true);
    };

    $("prevSlotsBtn").onclick = () => {
      slotWindowStartMin = clamp((slotWindowStartMin ?? 0) - slotWinHours*60, 0, 1440 - SLOT_STEP_MINUTES);
      selectedSlot = null;
      rebuildSlots();
      renderSummary();
    };
    $("nextSlotsBtn").onclick = () => {
      slotWindowStartMin = clamp((slotWindowStartMin ?? 0) + slotWinHours*60, 0, 1440 - SLOT_STEP_MINUTES);
      selectedSlot = null;
      rebuildSlots();
      renderSummary();
    };

    // step2 -> step3
    $("backTo1Btn").onclick = () => setStep(1);
    $("toStep3Btn").onclick = () => {
      if(!currentUser){ alert(t("msgLoginNeed")); return; }
      if(selectedPCs.size===0){ alert(t("msgPickPc")); return; }
      if(!selectedSlot){ alert(t("msgPickSlot")); return; }
      setStep(3);
      renderSummary();
      setMsg("OK", "info");
    };

    // step3 actions
    $("backTo2Btn").onclick = () => setStep(2);
    $("createBtn").onclick = createBooking;
    $("copyShareBtn").onclick = copyShare;
    $("showMyInlineBtn").onclick = () => {
      $("myBox").classList.remove("hide");
      renderMyTable();
      $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
    };

    // my box
    $("myCloseBtn").onclick = () => $("myBox").classList.add("hide");
    $("myRefreshBtn").onclick = () => renderMyTable();

    // admin buttons
    $("openAdminBtn").onclick = () => {
      if(!currentUser){ alert(t("msgLoginNeed")); return; }
      if(!isAdmin){ alert(t("promptAdmin")); return; }
      $("adminBox").classList.remove("hide");
      $("adminBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("exitAdminBtn").onclick = () => $("adminBox").classList.add("hide");

    $("search").addEventListener("input", renderAdminTable);
    $("clearFilterBtn").onclick = () => { $("search").value=""; renderAdminTable(); };
    $("wipeBtn").onclick = wipeAllDev;

    $("logoutBtn").onclick = async () => {
      if(!firebaseOk || !auth) return;
      await signOut(auth);
    };

    // Esc back to intro
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") showIntro(); });

    // Auth state
    if(firebaseOk && auth){
      onAuthStateChanged(auth, (u) => {
        currentUser = u;
        updateAdminFlag();
        renderPills();

        $("logoutBtn").style.display = u ? "inline-block" : "none";
        $("exitAdminBtn").style.display = isAdmin ? "inline-block" : "none";

        // start listener only when logged in (optional). We can listen without login too,
        // but you asked for shared registrations, so keep it clean.
        if(u){
          startBookingsListener();
        }else{
          bookings = [];
          renderPills();
          renderMyTable();
          renderAdminTable();
          if(unsubBookings){ unsubBookings(); unsubBookings = null; }
        }
      });
    }else{
      // no firebase - keep in intro
      setMsg("Firebase config missing", "bad");
    }
  }

  boot();
})();
</script>

<script>
/* non-module part: language buttons need IDs exist already, keep empty */
</script>
</body>
</html>
