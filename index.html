<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sakompiutere Gaming ‚Äî Booking</title>
  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg:#070a12;
      --card:#0b1020;
      --muted:#9aa4bf;
      --text:#eaf0ff;
      --line:rgba(255,255,255,.08);
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(900px 700px at 80% 10%, rgba(167,139,250,.14), transparent 60%),
        radial-gradient(800px 700px at 40% 120%, rgba(52,211,153,.10), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1180px; margin:0 auto; padding:18px;}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: radial-gradient(circle at 30% 20%, rgba(110,231,255,.9), rgba(167,139,250,.8) 40%, rgba(0,0,0,0) 72%),
                  linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow: 0 12px 30px rgba(0,0,0,.4);
    }
    .brand h1{margin:0; font-size:16px; letter-spacing:.4px}
    .brand .sub{margin:0; color:var(--muted); font-size:12px}
    .rightbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted); font-size:12px;
    }
    .pill strong{color:var(--text); font-weight:800}
    .lang{
      display:flex; gap:6px;
      padding:6px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }
    .lang button{
      padding:7px 10px; border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:800;
      font-size:12px;
    }
    .lang button.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.10);
      color: var(--text);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      header{position:static;}
    }

    .card{
      border:1px solid var(--line);
      border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .hd h2{margin:0; font-size:14px}
    .hint{color:var(--muted); font-size:12px}
    .bd{padding:14px 16px}

    .stepper{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .step{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .step .n{
      width:22px; height:22px; border-radius:999px;
      display:grid; place-items:center;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:900;
    }
    .step.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.08);
      color: var(--text);
    }
    .step.active .n{border-color: rgba(110,231,255,.55); color: var(--text)}

    .notice{
      border:1px dashed rgba(110,231,255,.35);
      background: rgba(110,231,255,.06);
      padding:12px 12px;
      border-radius:16px;
      font-size:12px;
      line-height:1.35;
    }
    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.2px;
    }
    button:hover{border-color: rgba(110,231,255,.5)}
    .primary{
      border-color: rgba(110,231,255,.55);
      background: linear-gradient(180deg, rgba(110,231,255,.18), rgba(167,139,250,.10));
    }
    .ghost{background:transparent}
    .danger{border-color: rgba(251,113,133,.6); background: rgba(251,113,133,.10)}
    .mini{padding:6px 10px; border-radius:12px; font-size:12px; font-weight:900}

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(110,231,255,.6); box-shadow:0 0 0 3px rgba(110,231,255,.12)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;}
    @media (max-width:520px){ .row{grid-template-columns:1fr;} }

    .pcgrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .pcgrid{grid-template-columns: repeat(2, 1fr);} }

    .pc{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
      position:relative;
      min-height:76px;
    }
    .pc:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.4)}
    .pc .name{font-weight:1000; letter-spacing:.3px}
    .pc .meta{margin-top:6px; color:var(--muted); font-size:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .tag{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(0,0,0,.25);
      font-size:12px; color:var(--muted);
    }
    .dot{width:8px; height:8px; border-radius:999px; background: var(--muted)}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .dot.warn{background:var(--warn)}

    .pc.selected{
      border-color: rgba(110,231,255,.75);
      box-shadow: 0 0 0 3px rgba(110,231,255,.10);
    }
    .check{
      position:absolute; top:10px; right:10px;
      width:22px; height:22px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      display:grid; place-items:center;
      color: transparent;
      font-weight:1000;
      font-size:12px;
    }
    .pc.selected .check{
      border-color: rgba(110,231,255,.75);
      background: rgba(110,231,255,.14);
      color: var(--text);
    }

    .chipbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      padding:9px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      cursor:pointer;
      font-weight:1000;
      font-size:12px;
    }
    .chip.active{
      border-color: rgba(110,231,255,.6);
      background: rgba(110,231,255,.10);
    }

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:16px;
      margin-top:10px;
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:12px;
    }
    .table th{color:var(--muted); font-weight:900; text-align:left; background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}

    .footerbar{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-top:12px;
      color: var(--muted);
      font-size:12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding:2px 6px;
      border:1px solid var(--line);
      border-radius:8px;
      background:rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
    }
    .hide{display:none !important;}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="t_title">Sakompiutere Gaming ‚Äî Booking</h1>
        <p class="sub" id="t_sub">–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</p>
      </div>
    </div>

    <div class="rightbar">
      <div class="lang" aria-label="Language selector">
        <button id="lang_ru">RU</button>
        <button id="lang_en">EN</button>
        <button id="lang_ka">KA</button>
      </div>
      <div class="pill"><span id="t_today">–°–µ–≥–æ–¥–Ω—è</span>: <strong id="todayPill">‚Äî</strong></div>
      <div class="pill"><span id="t_bookings">–ë—Ä–æ–Ω–µ–π</span>: <strong id="countPill">0</strong></div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="hd">
        <div class="stepper">
          <div class="step" id="step1"><span class="n">1</span><span id="t_step1">–ö–æ–º–ø—å—é—Ç–µ—Ä—ã</span></div>
          <div class="step" id="step2"><span class="n">2</span><span id="t_step2">–í—Ä–µ–º—è</span></div>
          <div class="step" id="step3"><span class="n">3</span><span id="t_step3">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span></div>
        </div>
        <div class="hint" id="t_hint">–°–¥–µ–ª–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ</div>
      </div>

      <div class="bd">
        <div class="notice" id="introBox">
          <b id="t_fast">üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥</b><br/>
          <span id="t_intro1">1) –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö</span><br/>
          <span id="t_intro2">2) –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span><br/>
          <span id="t_intro3">3) –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏ –≥–æ—Ç–æ–≤–æ</span>
          <div class="btns">
            <button class="primary" id="startBtn">‚ñ∂ <span id="t_start">–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</span></button>
            <button class="ghost" id="viewMyBtn">üë§ <span id="t_my">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
          </div>
        </div>

        <!-- STEP 1 -->
        <div id="step1Box" class="hide">
          <div class="row">
            <div>
              <label id="t_nickLabel">–¢–≤–æ–π –Ω–∏–∫</label>
              <input id="nick" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: KiraLite" />
            </div>
            <div>
              <label id="t_dateLabel">–î–∞—Ç–∞</label>
              <input id="date" type="date" />
            </div>
          </div>

          <div class="hint" id="t_pickpc">–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö (–∫–ª–∏–∫–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏):</div>
          <div id="pcGrid" class="pcgrid" aria-label="–°–ø–∏—Å–æ–∫ –ü–ö"></div>

          <div class="btns">
            <button class="primary" id="toStep2Btn">‚û° <span id="t_next">–î–∞–ª–µ–µ</span></button>
            <button class="ghost" id="clearPcBtn">‚úñ <span id="t_clear">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</span></button>
          </div>

          <div class="notice" style="margin-top:10px;">
            <span id="t_selected">–í—ã–±—Ä–∞–Ω–æ –ü–ö</span>: <b id="selectedCount">0</b>
            <span id="t_selectedList">‚Äî —Å–ø–∏—Å–æ–∫</span>: <b id="selectedList">‚Äî</b>
          </div>
        </div>

        <!-- STEP 2 -->
        <div id="step2Box" class="hide">
          <div class="row">
            <div>
              <label id="t_startLabel">–ù–∞—á–∞–ª–æ</label>
              <input id="start" type="time" />
            </div>
            <div>
              <label id="t_endLabel">–ö–æ–Ω–µ—Ü</label>
              <input id="end" type="time" />
            </div>
          </div>

          <div class="hint" id="t_durationHint">–ë—ã—Å—Ç—Ä–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</div>
          <div class="chipbar" id="durChips">
            <div class="chip" data-min="30">30m</div>
            <div class="chip" data-min="60">1h</div>
            <div class="chip" data-min="120">2h</div>
            <div class="chip" data-min="180">3h</div>
            <div class="chip" data-min="240">4h</div>
          </div>

          <div class="row" style="margin-top:10px;">
            <div>
              <label id="t_noteLabel">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="note" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: CS2 / –¢—É—Ä–Ω–∏—Ä" />
            </div>
            <div>
              <label id="t_priceLabel">–¶–µ–Ω–∞ (GEL/—á–∞—Å)</label>
              <input id="price" type="number" min="0" step="0.5" value="5" />
            </div>
          </div>

          <div class="btns">
            <button class="ghost" id="backTo1Btn">‚¨Ö <span id="t_back">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="toStep3Btn">‚û° <span id="t_next2">–î–∞–ª–µ–µ</span></button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div id="step3Box" class="hide">
          <div class="notice" id="summaryBox"></div>

          <div class="btns">
            <button class="ghost" id="backTo2Btn">‚¨Ö <span id="t_back2">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="createBtn">‚úÖ <span id="t_bookNow">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</span></button>
          </div>

          <div class="notice" id="msg" style="margin-top:10px;" aria-live="polite">
            OK
          </div>

          <div class="btns" style="margin-top:10px;">
            <button class="ghost" id="showMyInlineBtn">üë§ <span id="t_my2">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
          </div>
        </div>

        <!-- MY BOOKINGS -->
        <div id="myBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;" id="t_myTitle">–ú–æ–∏ –±—Ä–æ–Ω–∏</h2>
            <div class="hint" id="t_myHint">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –Ω–∏–∫—É</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="row">
              <div>
                <label id="t_myNick">–ù–∏–∫</label>
                <input id="myNickInput" type="text" placeholder="–≤–≤–µ–¥–∏ –Ω–∏–∫" />
              </div>
              <div style="display:flex; align-items:end; gap:10px;">
                <button class="primary" id="mySearchBtn">üîé <span id="t_show">–ü–æ–∫–∞–∑–∞—Ç—å</span></button>
                <button class="ghost" id="myCloseBtn">‚úñ <span id="t_close">–ó–∞–∫—Ä—ã—Ç—å</span></button>
              </div>
            </div>

            <table class="table" role="table" aria-label="–ú–æ–∏ –±—Ä–æ–Ω–∏">
              <thead>
                <tr>
                  <th style="width:140px" id="t_colDate">–î–∞—Ç–∞</th>
                  <th style="width:140px" id="t_colTime">–í—Ä–µ–º—è</th>
                  <th style="width:120px" id="t_colPc">–ü–ö</th>
                  <th id="t_colNote">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                  <th style="width:110px" id="t_colCost">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                </tr>
              </thead>
              <tbody id="myTable"></tbody>
            </table>
          </div>
        </div>

        <!-- ADMIN (hidden by default) -->
        <div id="adminBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;">Admin</h2>
            <div class="hint" id="t_adminHint">–¢–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="row">
              <div>
                <label id="t_search">–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö)</label>
                <input id="search" type="text" placeholder="–ø–æ–∏—Å–∫" />
              </div>
              <div style="display:flex; align-items:end; gap:10px;">
                <button class="ghost" id="clearFilterBtn">–°–±—Ä–æ—Å</button>
                <button class="danger" id="wipeBtn">–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë</button>
              </div>
            </div>

            <table class="table" role="table" aria-label="–í—Å–µ –±—Ä–æ–Ω–∏ (admin)">
              <thead>
                <tr>
                  <th style="width:140px" id="t_colDate2">–î–∞—Ç–∞</th>
                  <th style="width:140px" id="t_colTime2">–í—Ä–µ–º—è</th>
                  <th style="width:120px" id="t_colPc2">–ü–ö</th>
                  <th id="t_colNick2">–ù–∏–∫</th>
                  <th style="width:110px" id="t_colCost2">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                  <th style="width:160px" id="t_colAct2">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="bookTable"></tbody>
            </table>
          </div>
        </div>

        <div class="footerbar">
          <div>
            <span class="kbd">Esc</span> ‚Äî <span id="t_esc">–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–æ–∑–¥–∞–Ω–∏—é</span>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="mini ghost" id="openAdminBtn">üîê Admin</button>
            <button class="mini ghost" id="exitAdminBtn" class="hide">üö™ Exit</button>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT: small helper + status -->
    <div class="card">
      <div class="hd">
        <h2 id="t_sideTitle">–ü–æ–¥—Å–∫–∞–∑–∫–∞</h2>
        <div class="hint" id="t_sideHint">—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É</div>
      </div>
      <div class="bd">
        <div class="notice" id="helpBox"></div>

        <div style="height:12px"></div>
        <div class="notice">
          <b id="t_rules">–ü—Ä–∞–≤–∏–ª–∞</b><br/>
          ‚Ä¢ <span id="t_rule1">–ù–µ–ª—å–∑—è –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –±—Ä–æ–Ω–∏ –Ω–∞ –æ–¥–Ω–æ–º –ü–ö</span><br/>
          ‚Ä¢ <span id="t_rule2">–ú–∏–Ω–∏–º—É–º 30 –º–∏–Ω—É—Ç, –º–∞–∫—Å–∏–º—É–º 8 —á–∞—Å–æ–≤</span><br/>
          ‚Ä¢ <span id="t_rule3">–°–µ–π—á–∞—Å –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–º –æ–±–ª–∞–∫–æ)</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ====== CONFIG ======
  const PCs = ["Bishop","Godzilla","Elf","Kadita","Orc","Lancelot","Fantomas","Soultaker","Pudge","Kratos"];
  const STORAGE_KEY = "sg_bookings_v2";
  const LANG_KEY = "sg_lang";
  const ADMIN_KEY = "sg_admin";
  const ADMIN_PASSWORD = "1234"; // <-- –ø–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π

  // ====== i18n ======
  const i18n = {
    ru: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
      today:"–°–µ–≥–æ–¥–Ω—è", bookings:"–ë—Ä–æ–Ω–µ–π",
      step1:"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã", step2:"–í—Ä–µ–º—è", step3:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
      hint:"–°–¥–µ–ª–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ",
      fast:"üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥",
      intro1:"1) –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö",
      intro2:"2) –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
      intro3:"3) –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏ –≥–æ—Ç–æ–≤–æ",
      start:"–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
      my:"–ú–æ–∏ –±—Ä–æ–Ω–∏",
      nickLabel:"–¢–≤–æ–π –Ω–∏–∫",
      dateLabel:"–î–∞—Ç–∞",
      pickpc:"–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö (–∫–ª–∏–∫–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏):",
      next:"–î–∞–ª–µ–µ",
      clear:"–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä",
      selected:"–í—ã–±—Ä–∞–Ω–æ –ü–ö",
      selectedList:"‚Äî —Å–ø–∏—Å–æ–∫",
      startLabel:"–ù–∞—á–∞–ª–æ",
      endLabel:"–ö–æ–Ω–µ—Ü",
      durationHint:"–ë—ã—Å—Ç—Ä–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:",
      noteLabel:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      priceLabel:"–¶–µ–Ω–∞ (GEL/—á–∞—Å)",
      back:"–ù–∞–∑–∞–¥",
      bookNow:"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
      myTitle:"–ú–æ–∏ –±—Ä–æ–Ω–∏",
      myHint:"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –Ω–∏–∫—É",
      myNick:"–ù–∏–∫",
      show:"–ü–æ–∫–∞–∑–∞—Ç—å",
      close:"–ó–∞–∫—Ä—ã—Ç—å",
      colDate:"–î–∞—Ç–∞",
      colTime:"–í—Ä–µ–º—è",
      colPc:"–ü–ö",
      colNote:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
      colCost:"–°—Ç–æ–∏–º–æ—Å—Ç—å",
      sideTitle:"–ü–æ–¥—Å–∫–∞–∑–∫–∞",
      sideHint:"—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É",
      help:
`‚úÖ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:
1) –ù–∞–∂–º–∏ ‚Äú–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Äù
2) –í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
3) –í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4) –ù–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù

üë§ ‚Äú–ú–æ–∏ –±—Ä–æ–Ω–∏‚Äù ‚Äî —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏.`,
      rules:"–ü—Ä–∞–≤–∏–ª–∞",
      rule1:"–ù–µ–ª—å–∑—è –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –±—Ä–æ–Ω–∏ –Ω–∞ –æ–¥–Ω–æ–º –ü–ö",
      rule2:"–ú–∏–Ω–∏–º—É–º 30 –º–∏–Ω—É—Ç, –º–∞–∫—Å–∏–º—É–º 8 —á–∞—Å–æ–≤",
      rule3:"–°–µ–π—á–∞—Å –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–º –æ–±–ª–∞–∫–æ)",
      esc:"–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–æ–∑–¥–∞–Ω–∏—é",
      adminHint:"–¢–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
      search:"–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö)",
      colNick2:"–ù–∏–∫",
      colAct2:"–î–µ–π—Å—Ç–≤–∏—è",
      msgPickPc:"–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã 1 –ü–ö.",
      msgNick:"–í–≤–µ–¥–∏ –Ω–∏–∫.",
      msgTime:"–í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞.",
      msgOverlap:"–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –Ω–∞ –ü–ö",
      msgCreated:"–ì–æ—Ç–æ–≤–æ! –°–æ–∑–¥–∞–Ω–æ –±—Ä–æ–Ω–µ–π",
      msgNoMy:"–ù–µ—Ç –±—Ä–æ–Ω–µ–π –ø–æ –Ω–∏–∫—É",
      msgAdminOn:"Admin –≤–∫–ª—é—á–µ–Ω.",
      msgAdminOff:"Admin –≤—ã–∫–ª—é—á–µ–Ω.",
      promptAdmin:"–í–≤–µ–¥–∏ –∞–¥–º–∏–Ω-–ø–∞—Ä–æ–ª—å:",
      wrongPass:"–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.",
      confirmWipe:"–¢–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å –í–°–ï –±—Ä–æ–Ω–∏ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ?"
    },
    en: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"Pick PC ‚Üí pick time ‚Üí confirm",
      today:"Today", bookings:"Bookings",
      step1:"PCs", step2:"Time", step3:"Confirm",
      hint:"Made super simple",
      fast:"üéÆ Booking in 30 seconds",
      intro1:"1) Pick one or multiple PCs",
      intro2:"2) Pick date and duration",
      intro3:"3) Confirm ‚Äî done",
      start:"Start booking",
      my:"My bookings",
      nickLabel:"Your nickname",
      dateLabel:"Date",
      pickpc:"Select 1 or multiple PCs (click cards):",
      next:"Next",
      clear:"Clear selection",
      selected:"Selected PCs",
      selectedList:"‚Äî list",
      startLabel:"Start",
      endLabel:"End",
      durationHint:"Quick duration:",
      noteLabel:"Note (optional)",
      priceLabel:"Price (GEL/hour)",
      back:"Back",
      bookNow:"Book now",
      myTitle:"My bookings",
      myHint:"Filtered by nickname",
      myNick:"Nickname",
      show:"Show",
      close:"Close",
      colDate:"Date",
      colTime:"Time",
      colPc:"PC",
      colNote:"Note",
      colCost:"Cost",
      sideTitle:"Hint",
      sideHint:"so users understand fast",
      help:
`‚úÖ How to use:
1) Tap ‚ÄúStart booking‚Äù
2) Pick PCs (multi-select)
3) Pick time & duration
4) Tap ‚ÄúBook now‚Äù

üë§ ‚ÄúMy bookings‚Äù shows your records.`,
      rules:"Rules",
      rule1:"No overlaps on the same PC",
      rule2:"Min 30 min, max 8 hours",
      rule3:"Now it‚Äôs local storage (cloud later)",
      esc:"back to create mode",
      adminHint:"Management only",
      search:"Search (nick/PC)",
      colNick2:"Nick",
      colAct2:"Actions",
      msgPickPc:"Select at least 1 PC.",
      msgNick:"Enter your nickname.",
      msgTime:"Pick start and end time.",
      msgOverlap:"Overlap on PC",
      msgCreated:"Done! Bookings created",
      msgNoMy:"No bookings for nickname",
      msgAdminOn:"Admin enabled.",
      msgAdminOff:"Admin disabled.",
      promptAdmin:"Enter admin password:",
      wrongPass:"Wrong password.",
      confirmWipe:"Delete ALL bookings on this device?"
    },
    ka: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"·Éê·Éò·É†·É©·Éò·Éî PC ‚Üí ·Éê·Éò·É†·É©·Éò·Éî ·Éì·É†·Éù ‚Üí ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî",
      today:"·Éì·É¶·Éî·É°", bookings:"·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      step1:"·Éô·Éù·Éõ·Éû·Éò·É£·É¢·Éî·É†·Éî·Éë·Éò", step2:"·Éì·É†·Éù", step3:"·Éì·Éê·Éì·Éê·É°·É¢·É£·É†·Éî·Éë·Éê",
      hint:"·Éõ·Éê·É•·É°·Éò·Éõ·Éê·Éö·É£·É†·Éê·Éì ·Éõ·Éê·É†·É¢·Éò·Éï·Éò",
      fast:"üéÆ ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò 30 ·É¨·Éê·Éõ·É®·Éò",
      intro1:"1) ·Éê·Éò·É†·É©·Éò·Éî ·Éî·É†·Éó·Éò ·Éê·Éú ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC",
      intro2:"2) ·Éê·Éò·É†·É©·Éò·Éî ·Éó·Éê·É†·Éò·É¶·Éò ·Éì·Éê ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê",
      intro3:"3) ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî ‚Äî ·Éõ·Éñ·Éê·Éì·Éê·Éê",
      start:"·Éì·Éê·É¨·Éß·Éî·Éë·Éê",
      my:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      nickLabel:"·Éú·Éò·Éô·Éò",
      dateLabel:"·Éó·Éê·É†·Éò·É¶·Éò",
      pickpc:"·Éê·Éò·É†·É©·Éò·Éî 1 ·Éê·Éú ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC (·Éì·Éê·Éê·Éô·Éö·Éò·Éô·Éî):",
      next:"·É®·Éî·Éõ·Éì·Éî·Éí·Éò",
      clear:"·Éí·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê",
      selected:"·Éê·É†·É©·Éî·É£·Éö·Éò PC",
      selectedList:"‚Äî ·É°·Éò·Éê",
      startLabel:"·Éì·Éê·É¨·Éß·Éî·Éë·Éê",
      endLabel:"·Éì·Éê·É°·É†·É£·Éö·Éî·Éë·Éê",
      durationHint:"·É°·É¨·É†·Éê·É§·Éò ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê:",
      noteLabel:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù)",
      priceLabel:"·É§·Éê·É°·Éò (GEL/·É°·Éê·Éê·Éó·Éò)",
      back:"·É£·Éô·Éê·Éú",
      bookNow:"·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê",
      myTitle:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      myHint:"·Éú·Éò·Éô·Éò·Éó ·É§·Éò·Éö·É¢·É†·Éê·É™·Éò·Éê",
      myNick:"·Éú·Éò·Éô·Éò",
      show:"·É©·Éï·Éî·Éú·Éî·Éë·Éê",
      close:"·Éì·Éê·ÉÆ·É£·É†·Éï·Éê",
      colDate:"·Éó·Éê·É†·Éò·É¶·Éò",
      colTime:"·Éì·É†·Éù",
      colPc:"PC",
      colNote:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê",
      colCost:"·É§·Éê·É°·Éò",
      sideTitle:"·Éõ·Éò·Éú·Éò·É®·Éú·Éî·Éë·Éê",
      sideHint:"·É†·Éù·Éõ ·É°·É¨·É†·Éê·É§·Éê·Éì ·Éí·Éê·Éò·Éí·Éù·Éú",
      help:
`‚úÖ ·Éí·Éê·Éõ·Éù·Éß·Éî·Éú·Éî·Éë·Éê:
1) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·É¨·Éß·Éî·Éë·Éê‚Äù
2) ·Éê·Éò·É†·É©·Éò·Éî PC-·Éî·Éë·Éò (·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî)
3) ·Éê·Éò·É†·É©·Éò·Éî ·Éì·É†·Éù ·Éì·Éê ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê
4) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê‚Äù

üë§ ‚Äú·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò‚Äù ‚Äî ·É®·Éî·Éú·Éò ·É©·Éê·Éú·Éê·É¨·Éî·É†·Éî·Éë·Éò·Éê.`,
      rules:"·É¨·Éî·É°·Éî·Éë·Éò",
      rule1:"·Éî·É†·Éó PC-·Éñ·Éî ·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê",
      rule2:"·Éõ·Éò·Éú 30 ·É¨·Éó, ·Éõ·Éê·É•·É° 8 ·É°·Éê·Éê·Éó·Éò",
      rule3:"·Éê·ÉÆ·Éö·Éê ·Éò·Éú·Éê·ÉÆ·Éî·Éë·Éê ·Éö·Éù·Éô·Éê·Éö·É£·É†·Éê·Éì (·É®·Éî·Éõ·Éì·Éî·Éí ·É¶·É†·É£·Éë·Éî·Éö·Éò)",
      esc:"·Éì·Éê·Éë·É†·É£·Éú·Éî·Éë·Éê ·É®·Éî·É•·Éõ·Éú·Éê·Éñ·Éî",
      adminHint:"·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éõ·Éê·É†·Éó·Éï·Éê",
      search:"·É´·Éî·Éë·Éú·Éê (·Éú·Éò·Éô·Éò/PC)",
      colNick2:"·Éú·Éò·Éô·Éò",
      colAct2:"·É•·Éõ·Éî·Éì·Éî·Éë·Éê",
      msgPickPc:"·Éê·Éò·É†·É©·Éò·Éî ·Éõ·Éò·Éú·Éò·Éõ·É£·Éõ 1 PC.",
      msgNick:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî ·Éú·Éò·Éô·Éò.",
      msgTime:"·Éê·Éò·É†·É©·Éò·Éî ·Éì·Éê·É¨·Éß·Éî·Éë·Éê ·Éì·Éê ·Éì·Éê·É°·É†·É£·Éö·Éî·Éë·Éê.",
      msgOverlap:"·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê PC-·Éñ·Éî",
      msgCreated:"·Éõ·Éñ·Éê·Éì·Éê·Éê! ·É®·Éî·É•·Éõ·Éú·Éò·Éö·Éò·Éê ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      msgNoMy:"·Éê·Éõ ·Éú·Éò·Éô·Éñ·Éî ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·É† ·Éê·É†·Éò·É°",
      msgAdminOn:"Admin ·É©·Éê·É†·Éó·É£·Éö·Éò·Éê.",
      msgAdminOff:"Admin ·Éí·Éê·Éõ·Éù·É†·Éó·É£·Éö·Éò·Éê.",
      promptAdmin:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî admin ·Éû·Éê·É†·Éù·Éö·Éò:",
      wrongPass:"·Éê·É†·Éê·É°·É¨·Éù·É†·Éò ·Éû·Éê·É†·Éù·Éö·Éò.",
      confirmWipe:"·É¨·Éê·É®·Éê·Éö·Éù ·Éß·Éï·Éî·Éö·Éê ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·Éõ ·Éõ·Éù·É¨·Éß·Éù·Éë·Éò·Éö·Éù·Éë·Éê·Éñ·Éî?"
    }
  };

  // ====== HELPERS ======
  const $ = (id) => document.getElementById(id);
  const pad2 = (n) => String(n).padStart(2,"0");
  const toLocalISODate = (d) => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const minutesFromTimeStr = (t) => { const [h,m]=t.split(":").map(Number); return h*60+m; };
  const timeStrFromMinutes = (min) => { min=Math.max(0,Math.min(1440,min)); const h=Math.floor(min/60), m=min%60; return `${pad2(h)}:${pad2(m)}`; };
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  const money = (n)=>`${Number(n||0).toFixed(2)} GEL`;
  const calcPriceGel = (pricePerHour, mins)=>Math.round((Number(pricePerHour)*(mins/60))*2)/2;

  function setStep(n){
    $("step1").classList.toggle("active", n===1);
    $("step2").classList.toggle("active", n===2);
    $("step3").classList.toggle("active", n===3);
    $("step1Box").classList.toggle("hide", n!==1);
    $("step2Box").classList.toggle("hide", n!==2);
    $("step3Box").classList.toggle("hide", n!==3);
    $("introBox").classList.add("hide");
  }

  function setMsg(text, kind="info"){
    const el = $("msg");
    el.textContent = text;
    el.style.borderColor =
      kind==="good" ? "rgba(52,211,153,.45)" :
      kind==="bad" ? "rgba(251,113,133,.55)" :
      "rgba(110,231,255,.35)";
    el.style.background =
      kind==="good" ? "rgba(52,211,153,.08)" :
      kind==="bad" ? "rgba(251,113,133,.08)" :
      "rgba(110,231,255,.06)";
  }

  // ====== STATE ======
  let lang = localStorage.getItem(LANG_KEY) || "ru";
  if(!i18n[lang]) lang = "ru";

  let isAdmin = localStorage.getItem(ADMIN_KEY) === "1";
  let selectedPCs = new Set();

  // booking shape:
  // { id, nick, pc, date, start, end, note, pricePerHour, totalGel, createdAt }
  function loadBookings(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    }catch(e){ return []; }
  }
  function saveBookings(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

  let bookings = loadBookings();

  // ====== i18n apply ======
  function t(k){ return i18n[lang][k] ?? i18n["ru"][k] ?? k; }
  function applyLang(){
    $("t_title").textContent = t("title");
    $("t_sub").textContent = t("sub");
    $("t_today").textContent = t("today");
    $("t_bookings").textContent = t("bookings");
    $("t_step1").textContent = t("step1");
    $("t_step2").textContent = t("step2");
    $("t_step3").textContent = t("step3");
    $("t_hint").textContent = t("hint");
    $("t_fast").textContent = t("fast");
    $("t_intro1").textContent = t("intro1");
    $("t_intro2").textContent = t("intro2");
    $("t_intro3").textContent = t("intro3");
    $("t_start").textContent = t("start");
    $("t_my").textContent = t("my");
    $("t_nickLabel").textContent = t("nickLabel");
    $("t_dateLabel").textContent = t("dateLabel");
    $("t_pickpc").textContent = t("pickpc");
    $("t_next").textContent = t("next");
    $("t_clear").textContent = t("clear");
    $("t_selected").textContent = t("selected");
    $("t_selectedList").textContent = t("selectedList");
    $("t_startLabel").textContent = t("startLabel");
    $("t_endLabel").textContent = t("endLabel");
    $("t_durationHint").textContent = t("durationHint");
    $("t_noteLabel").textContent = t("noteLabel");
    $("t_priceLabel").textContent = t("priceLabel");
    $("t_back").textContent = t("back");
    $("t_back2").textContent = t("back");
    $("t_next2").textContent = t("next");
    $("t_bookNow").textContent = t("bookNow");
    $("t_my2").textContent = t("my");
    $("t_myTitle").textContent = t("myTitle");
    $("t_myHint").textContent = t("myHint");
    $("t_myNick").textContent = t("myNick");
    $("t_show").textContent = t("show");
    $("t_close").textContent = t("close");
    $("t_colDate").textContent = t("colDate");
    $("t_colTime").textContent = t("colTime");
    $("t_colPc").textContent = t("colPc");
    $("t_colNote").textContent = t("colNote");
    $("t_colCost").textContent = t("colCost");

    $("t_sideTitle").textContent = t("sideTitle");
    $("t_sideHint").textContent = t("sideHint");
    $("helpBox").textContent = t("help");

    $("t_rules").textContent = t("rules");
    $("t_rule1").textContent = t("rule1");
    $("t_rule2").textContent = t("rule2");
    $("t_rule3").textContent = t("rule3");
    $("t_esc").textContent = t("esc");

    $("t_adminHint").textContent = t("adminHint");
    $("t_search").textContent = t("search");
    $("t_colDate2").textContent = t("colDate");
    $("t_colTime2").textContent = t("colTime");
    $("t_colPc2").textContent = t("colPc");
    $("t_colNick2").textContent = t("colNick2");
    $("t_colCost2").textContent = t("colCost");
    $("t_colAct2").textContent = t("colAct2");

    // lang buttons
    $("lang_ru").classList.toggle("active", lang==="ru");
    $("lang_en").classList.toggle("active", lang==="en");
    $("lang_ka").classList.toggle("active", lang==="ka");
  }

  // ====== UI render ======
  function renderPills(){
    $("countPill").textContent = String(bookings.length);
    $("todayPill").textContent = new Date().toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
  }

  function pcStatusFor(pc, date){
    const list = bookings.filter(b=>b.pc===pc && b.date===date).sort((a,b)=>a.start.localeCompare(b.start));
    if(!list.length) return {dot:"good", text:"Free", next:"‚Äî"};
    // busy now?
    const now = new Date();
    const isToday = date === toLocalISODate(now);
    let dot="warn", text=`${list.length}`;
    if(isToday){
      const nowMin = now.getHours()*60 + now.getMinutes();
      for(const b of list){
        const s=minutesFromTimeStr(b.start), e=minutesFromTimeStr(b.end);
        if(nowMin>=s && nowMin<e){ dot="bad"; text="Busy"; break; }
      }
    }
    return {dot, text, next: list[0].start};
  }

  function renderPCGrid(){
    const grid = $("pcGrid");
    grid.innerHTML = "";
    const date = $("date").value;

    for(const pc of PCs){
      const st = pcStatusFor(pc, date);
      const div = document.createElement("div");
      div.className = "pc";
      if(selectedPCs.has(pc)) div.classList.add("selected");
      div.setAttribute("data-pc", pc);
      div.innerHTML = `
        <div class="check">‚úì</div>
        <div class="name">${pc}</div>
        <div class="meta">
          <span class="tag"><span class="dot ${st.dot}"></span>${st.dot==="good" ? "Free" : (st.dot==="bad" ? "Busy" : "Booked")}</span>
          <span>${st.next==="‚Äî" ? "‚Äî" : ("Next: "+st.next)}</span>
        </div>
      `;
      div.addEventListener("click", () => {
        if(selectedPCs.has(pc)) selectedPCs.delete(pc);
        else selectedPCs.add(pc);
        renderSelected();
        renderPCGrid();
      });
      grid.appendChild(div);
    }
  }

  function renderSelected(){
    const arr = Array.from(selectedPCs);
    $("selectedCount").textContent = String(arr.length);
    $("selectedList").textContent = arr.length ? arr.join(", ") : "‚Äî";
  }

  function normalizeEndByChip(mins){
    const s = minutesFromTimeStr($("start").value);
    $("end").value = timeStrFromMinutes(clamp(s + mins, 0, 1440));
  }

  function renderDurationChips(activeMin=null){
    document.querySelectorAll("#durChips .chip").forEach(ch=>{
      const m = Number(ch.getAttribute("data-min"));
      ch.classList.toggle("active", activeMin===m);
    });
  }

  function overlaps(pc, date, sMin, eMin, ignoreId=null){
    for(const b of bookings){
      if(ignoreId && b.id===ignoreId) continue;
      if(b.pc!==pc || b.date!==date) continue;
      const bs=minutesFromTimeStr(b.start), be=minutesFromTimeStr(b.end);
      if(Math.max(sMin, bs) < Math.min(eMin, be)) return b;
    }
    return null;
  }

  function createMultiBooking(){
    const nick = ($("nick").value || "").trim();
    const date = $("date").value;
    const start = $("start").value;
    const end = $("end").value;
    const note = ($("note").value || "").trim();
    const pricePerHour = Number($("price").value || 5);

    if(!nick) return setMsg(t("msgNick"), "bad");
    if(selectedPCs.size===0) return setMsg(t("msgPickPc"), "bad");
    if(!date || !start || !end) return setMsg(t("msgTime"), "bad");

    const sMin = minutesFromTimeStr(start);
    const eMin = minutesFromTimeStr(end);
    const mins = eMin - sMin;

    if(mins < 30) return setMsg("Min 30 minutes.", "bad");
    if(mins > 8*60) return setMsg("Max 8 hours.", "bad");
    if(eMin <= sMin) return setMsg(t("msgTime"), "bad");

    // check conflicts for all selected PCs (atomic)
    const conflicts = [];
    for(const pc of selectedPCs){
      const c = overlaps(pc, date, sMin, eMin);
      if(c) conflicts.push({pc, c});
    }
    if(conflicts.length){
      const first = conflicts[0];
      return setMsg(`${t("msgOverlap")} ${first.pc}: ${first.c.start}‚Üí${first.c.end} (${first.c.nick})`, "bad");
    }

    const totalGel = calcPriceGel(pricePerHour, mins);

    // create one booking per pc
    const created = [];
    for(const pc of selectedPCs){
      created.push({
        id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2)),
        nick, pc, date, start, end, note,
        pricePerHour,
        totalGel,
        createdAt: new Date().toISOString()
      });
    }

    bookings = bookings.concat(created);
    saveBookings(bookings);

    setMsg(`${t("msgCreated")}: ${created.length}`, "good");
    renderPills();
    renderPCGrid();
    renderAdminTable();
    renderMyTable(nick);

    // keep user at step 3 but show updated summary
    renderSummary();
  }

  function renderSummary(){
    const nick = ($("nick").value || "").trim();
    const date = $("date").value;
    const start = $("start").value;
    const end = $("end").value;
    const note = ($("note").value || "").trim();
    const pricePerHour = Number($("price").value || 5);

    const sMin = minutesFromTimeStr(start);
    const eMin = minutesFromTimeStr(end);
    const mins = eMin - sMin;
    const pcs = Array.from(selectedPCs);
    const perPc = (mins>0) ? calcPriceGel(pricePerHour, mins) : 0;
    const total = perPc * pcs.length;

    $("summaryBox").innerHTML = `
      <b>${t("step3")}</b><br/>
      ‚Ä¢ ${t("nickLabel")}: <b>${nick || "‚Äî"}</b><br/>
      ‚Ä¢ ${t("dateLabel")}: <b>${date || "‚Äî"}</b><br/>
      ‚Ä¢ ${t("colTime")}: <b>${start || "‚Äî"} ‚Üí ${end || "‚Äî"}</b><br/>
      ‚Ä¢ ${t("selected")}: <b>${pcs.length}</b><br/>
      ‚Ä¢ PCs: <b>${pcs.length ? pcs.join(", ") : "‚Äî"}</b><br/>
      ‚Ä¢ ${t("colCost")} (per PC): <b>${money(perPc)}</b><br/>
      ‚Ä¢ ${t("colCost")} total: <b>${money(total)}</b><br/>
      ${note ? ("‚Ä¢ "+t("noteLabel")+": <b>"+note+"</b><br/>") : ""}
    `;
  }

  // ====== My bookings ======
  function renderMyTable(nick){
    const tbody = $("myTable");
    tbody.innerHTML = "";
    const q = (nick || "").trim();
    if(!q){
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted)">‚Äî</td></tr>`;
      return;
    }
    const list = bookings
      .filter(b => (b.nick||"").trim().toLowerCase() === q.toLowerCase())
      .sort((a,b)=> (a.date+a.start+a.pc).localeCompare(b.date+b.start+b.pc));

    if(!list.length){
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted)">${t("msgNoMy")}: <b>${q}</b></td></tr>`;
      return;
    }

    for(const b of list){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${b.date}</td>
        <td>${b.start} ‚Üí ${b.end}</td>
        <td><b>${b.pc}</b></td>
        <td style="color:var(--muted)">${b.note || ""}</td>
        <td>${money(b.totalGel)}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  // ====== Admin ======
  function renderAdminTable(){
    const box = $("adminBox");
    box.classList.toggle("hide", !isAdmin);

    const tbody = $("bookTable");
    tbody.innerHTML = "";
    if(!isAdmin) return;

    const q = ($("search").value || "").trim().toLowerCase();
    const list = bookings
      .filter(b => !q || (b.nick||"").toLowerCase().includes(q) || (b.pc||"").toLowerCase().includes(q))
      .sort((a,b)=> (a.date+a.start+a.pc).localeCompare(b.date+b.start+b.pc));

    for(const b of list){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${b.date}</td>
        <td>${b.start} ‚Üí ${b.end}</td>
        <td><b>${b.pc}</b></td>
        <td><b>${b.nick}</b></td>
        <td>${money(b.totalGel)}</td>
        <td>
          <button class="mini danger" data-act="del" data-id="${b.id}">Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    }

    tbody.querySelectorAll("button[data-act='del']").forEach(btn=>{
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-id");
        const b = bookings.find(x=>x.id===id);
        if(!b) return;
        if(!confirm(`Delete booking?\n${b.nick} ‚Ä¢ ${b.pc}\n${b.date} ${b.start}‚Üí${b.end}`)) return;
        bookings = bookings.filter(x=>x.id!==id);
        saveBookings(bookings);
        renderPills();
        renderPCGrid();
        renderAdminTable();
        setMsg("Deleted.", "good");
      });
    });
  }

  function adminOn(){
    isAdmin = true;
    localStorage.setItem(ADMIN_KEY, "1");
    setMsg(t("msgAdminOn"), "good");
    renderAdminTable();
  }
  function adminOff(){
    isAdmin = false;
    localStorage.setItem(ADMIN_KEY, "0");
    setMsg(t("msgAdminOff"), "info");
    renderAdminTable();
  }

  // ====== FLOW actions ======
  function openMyBox(prefillNick){
    $("myBox").classList.remove("hide");
    $("myNickInput").value = prefillNick || $("nick").value || "";
    renderMyTable($("myNickInput").value);
    // scroll a bit for mobile
    $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
  }
  function closeMyBox(){ $("myBox").classList.add("hide"); }

  // ====== BOOT ======
  function boot(){
    // defaults
    const d = new Date();
    $("todayPill").textContent = d.toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
    $("date").value = toLocalISODate(d);

    const startMin = clamp(d.getHours()*60 + (Math.ceil(d.getMinutes()/5)*5), 0, 23*60+55);
    $("start").value = timeStrFromMinutes(startMin);
    $("end").value = timeStrFromMinutes(clamp(startMin + 60, 0, 1440));

    renderPills();
    applyLang();
    renderSelected();
    renderPCGrid();
    renderAdminTable();

    // events: language
    $("lang_ru").onclick = () => { lang="ru"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };
    $("lang_en").onclick = () => { lang="en"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };
    $("lang_ka").onclick = () => { lang="ka"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); };

    // start flow
    $("startBtn").onclick = () => { setStep(1); };
    $("viewMyBtn").onclick = () => openMyBox($("nick").value);

    // step 1 buttons
    $("clearPcBtn").onclick = () => { selectedPCs.clear(); renderSelected(); renderPCGrid(); };
    $("toStep2Btn").onclick = () => {
      const nick = ($("nick").value||"").trim();
      if(!nick) return alert(t("msgNick"));
      if(selectedPCs.size===0) return alert(t("msgPickPc"));
      setStep(2);
      // preselect 1h chip visually
      renderDurationChips(60);
      normalizeEndByChip(60);
      renderSummary();
    };

    // date change affects status
    $("date").addEventListener("change", () => renderPCGrid());

    // duration chips
    document.querySelectorAll("#durChips .chip").forEach(ch=>{
      ch.addEventListener("click", ()=>{
        const mins = Number(ch.getAttribute("data-min"));
        renderDurationChips(mins);
        normalizeEndByChip(mins);
        renderSummary();
      });
    });

    // manual time changes
    $("start").addEventListener("change", () => { renderDurationChips(null); renderSummary(); });
    $("end").addEventListener("change", () => { renderDurationChips(null); renderSummary(); });
    $("price").addEventListener("input", () => { renderSummary(); });

    // step 2 navigation
    $("backTo1Btn").onclick = () => setStep(1);
    $("toStep3Btn").onclick = () => {
      if(selectedPCs.size===0) return alert(t("msgPickPc"));
      setStep(3);
      renderSummary();
      setMsg("OK", "info");
    };

    // step 3 actions
    $("backTo2Btn").onclick = () => setStep(2);
    $("createBtn").onclick = createMultiBooking;
    $("showMyInlineBtn").onclick = () => openMyBox($("nick").value);

    // my box
    $("mySearchBtn").onclick = () => renderMyTable($("myNickInput").value);
    $("myCloseBtn").onclick = closeMyBox;

    // admin
    $("openAdminBtn").onclick = () => {
      if(isAdmin) return;
      const pass = prompt(t("promptAdmin"));
      if(pass === null) return;
      if(pass === ADMIN_PASSWORD) adminOn();
      else alert(t("wrongPass"));
    };
    $("exitAdminBtn").onclick = () => adminOff();

    $("search").addEventListener("input", renderAdminTable);
    $("clearFilterBtn").onclick = () => { $("search").value=""; renderAdminTable(); };
    $("wipeBtn").onclick = () => {
      if(!confirm(t("confirmWipe"))) return;
      bookings = [];
      saveBookings(bookings);
      selectedPCs.clear();
      renderSelected();
      renderPills();
      renderPCGrid();
      renderAdminTable();
      setMsg("Wiped.", "good");
    };

    // show/hide admin exit button
    const adminWatcher = setInterval(()=>{
      $("exitAdminBtn").style.display = isAdmin ? "inline-block" : "none";
    }, 300);

    // Esc: back to intro (simple)
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        // back to intro
        $("introBox").classList.remove("hide");
        $("step1Box").classList.add("hide");
        $("step2Box").classList.add("hide");
        $("step3Box").classList.add("hide");
        $("step1").classList.remove("active");
        $("step2").classList.remove("active");
        $("step3").classList.remove("active");
      }
    });
  }

  boot();
})();
</script>
</body>
</html>
