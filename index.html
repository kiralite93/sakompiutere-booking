<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sakompiutere Gaming ‚Äî Booking</title>
  <meta name="theme-color" content="#0b1020" />
  <!-- QR generator (tiny CDN). If it fails to load, site still works (QR just won‚Äôt show). -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    :root{
      --bg:#070a12;
      --card:#0b1020;
      --muted:#9aa4bf;
      --text:#eaf0ff;
      --line:rgba(255,255,255,.08);
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(110,231,255,.12), transparent 60%),
        radial-gradient(900px 700px at 80% 10%, rgba(167,139,250,.14), transparent 60%),
        radial-gradient(800px 700px at 40% 120%, rgba(52,211,153,.10), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1180px; margin:0 auto; padding:18px;}
    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:10;
      backdrop-filter: blur(10px);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: radial-gradient(circle at 30% 20%, rgba(110,231,255,.9), rgba(167,139,250,.8) 40%, rgba(0,0,0,0) 72%),
                  linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow: 0 12px 30px rgba(0,0,0,.4);
    }
    .brand h1{margin:0; font-size:16px; letter-spacing:.4px}
    .brand .sub{margin:0; color:var(--muted); font-size:12px}
    .rightbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted); font-size:12px;
    }
    .pill strong{color:var(--text); font-weight:900}
    .lang{
      display:flex; gap:6px;
      padding:6px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }
    .lang button{
      padding:7px 10px; border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:900;
      font-size:12px;
    }
    .lang button.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.10);
      color: var(--text);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      header{position:static;}
    }
    .card{
      border:1px solid var(--line);
      border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .hd h2{margin:0; font-size:14px}
    .hint{color:var(--muted); font-size:12px}
    .bd{padding:14px 16px}

    .stepper{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .step{
      display:flex; gap:10px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      color:var(--muted);
      font-size:12px;
      user-select:none;
    }
    .step .n{
      width:22px; height:22px; border-radius:999px;
      display:grid; place-items:center;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:1000;
    }
    .step.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.08);
      color: var(--text);
    }
    .step.active .n{border-color: rgba(110,231,255,.55); color: var(--text)}

    .notice{
      border:1px dashed rgba(110,231,255,.35);
      background: rgba(110,231,255,.06);
      padding:12px 12px;
      border-radius:16px;
      font-size:12px;
      line-height:1.35;
    }

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.2px;
    }
    button:hover{border-color: rgba(110,231,255,.5)}
    .primary{
      border-color: rgba(110,231,255,.55);
      background: linear-gradient(180deg, rgba(110,231,255,.18), rgba(167,139,250,.10));
    }
    .ghost{background:transparent}
    .danger{border-color: rgba(251,113,133,.6); background: rgba(251,113,133,.10)}
    .mini{padding:6px 10px; border-radius:12px; font-size:12px; font-weight:1000}

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
    }
    input:focus{border-color: rgba(110,231,255,.6); box-shadow:0 0 0 3px rgba(110,231,255,.12)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;}
    @media (max-width:520px){ .row{grid-template-columns:1fr;} }

    .pcgrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .pcgrid{grid-template-columns: repeat(2, 1fr);} }

    .pc{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
      position:relative;
      min-height:78px;
    }
    .pc:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.4)}
    .pc .name{font-weight:1100; letter-spacing:.3px}
    .pc .meta{margin-top:6px; color:var(--muted); font-size:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .tag{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line); background:rgba(0,0,0,.25);
      font-size:12px; color:var(--muted);
    }
    .dot{width:8px; height:8px; border-radius:999px; background: var(--muted)}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .dot.warn{background:var(--warn)}

    .pc.selected{
      border-color: rgba(110,231,255,.75);
      box-shadow: 0 0 0 3px rgba(110,231,255,.10);
    }
    .check{
      position:absolute; top:10px; right:10px;
      width:22px; height:22px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      display:grid; place-items:center;
      color: transparent;
      font-weight:1100;
      font-size:12px;
    }
    .pc.selected .check{
      border-color: rgba(110,231,255,.75);
      background: rgba(110,231,255,.14);
      color: var(--text);
    }

    /* Availability highlight */
    .pc.freeForRange{border-color: rgba(52,211,153,.55);}
    .pc.busyForRange{border-color: rgba(251,113,133,.65);}
    .pc.busyForRange .tag{border-color: rgba(251,113,133,.35); color: rgba(251,113,133,.95);}
    .pc.freeForRange .tag{border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95);}

    .chipbar{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .chip{
      padding:9px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      cursor:pointer;
      font-weight:1100;
      font-size:12px;
    }
    .chip.active{
      border-color: rgba(110,231,255,.6);
      background: rgba(110,231,255,.10);
    }
    .chipsSelected{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;
      padding:10px; border-radius:16px; border:1px solid var(--line);
      background:rgba(0,0,0,.18);
    }
    .pcchip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px;
      border:1px solid rgba(110,231,255,.30);
      background: rgba(110,231,255,.08);
      font-size:12px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
    }
    .pcchip .x{
      width:18px; height:18px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      display:grid; place-items:center;
      color: var(--muted);
      background: rgba(0,0,0,.20);
      font-weight:1100;
    }

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:16px;
      margin-top:10px;
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:12px;
    }
    .table th{color:var(--muted); font-weight:1100; text-align:left; background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}

    .cards{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-top:10px;
    }
    .bcard{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.18);
      padding:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
    }
    .bcard .left{display:flex; flex-direction:column; gap:4px;}
    .bcard .top{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .badge{
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      font-size:12px;
      font-weight:1100;
    }
    .badge.ok{border-color: rgba(52,211,153,.35); color: rgba(52,211,153,.95)}
    .badge.warn{border-color: rgba(251,191,36,.35); color: rgba(251,191,36,.95)}
    .bcard .mut{color:var(--muted); font-size:12px}
    .footerbar{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-top:12px;
      color: var(--muted);
      font-size:12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding:2px 6px;
      border:1px solid var(--line);
      border-radius:8px;
      background:rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
    }
    .hide{display:none !important;}

    /* Print support */
    @media print{
      header, #rightSide, #openAdminBtn, #exitAdminBtn, #introBox, #step1Box, #step2Box, #step3Box, #myBox { display:none !important; }
      body{ background:#fff !important; color:#000 !important; }
      .card{ box-shadow:none !important; background:#fff !important; border:1px solid #ddd !important; }
      .wrap{ max-width:100% !important; }
      .bcard{ border:1px solid #ddd !important; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="t_title">Sakompiutere Gaming ‚Äî Booking</h1>
        <p class="sub" id="t_sub">–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</p>
      </div>
    </div>

    <div class="rightbar">
      <div class="lang" aria-label="Language selector">
        <button id="lang_ru">RU</button>
        <button id="lang_en">EN</button>
        <button id="lang_ka">KA</button>
      </div>
      <div class="pill"><span id="t_today">–°–µ–≥–æ–¥–Ω—è</span>: <strong id="todayPill">‚Äî</strong></div>
      <div class="pill"><span id="t_bookings">–ë—Ä–æ–Ω–µ–π</span>: <strong id="countPill">0</strong></div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="hd">
        <div class="stepper">
          <div class="step" id="step1"><span class="n">1</span><span id="t_step1">–ö–æ–º–ø—å—é—Ç–µ—Ä—ã</span></div>
          <div class="step" id="step2"><span class="n">2</span><span id="t_step2">–í—Ä–µ–º—è</span></div>
          <div class="step" id="step3"><span class="n">3</span><span id="t_step3">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span></div>
        </div>
        <div class="hint" id="t_hint">–°–¥–µ–ª–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ</div>
      </div>

      <div class="bd">
        <div class="notice" id="introBox">
          <b id="t_fast">üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥</b><br/>
          <span id="t_intro1">1) –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö</span><br/>
          <span id="t_intro2">2) –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span><br/>
          <span id="t_intro3">3) –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏ –≥–æ—Ç–æ–≤–æ</span>
          <div class="btns">
            <button class="primary" id="startBtn">‚ñ∂ <span id="t_start">–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</span></button>
            <button class="ghost" id="viewMyBtn">üë§ <span id="t_my">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
            <button class="ghost" id="todayBtn">üìÖ <span id="t_todayBtn">–°–µ–≥–æ–¥–Ω—è</span></button>
          </div>
        </div>

        <!-- TODAY VIEW -->
        <div id="todayBox" class="hide">
          <div class="notice">
            <b id="t_todayTitle">üìÖ –°–µ–≥–æ–¥–Ω—è</b><br/>
            <span id="t_todayDesc">–ó–¥–µ—Å—å –ø–æ–∫–∞–∑–∞–Ω—ã –±—Ä–æ–Ω–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (—É–¥–æ–±–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é).</span>
          </div>
          <div class="btns">
            <button class="ghost" id="todayBackBtn">‚¨Ö <span id="t_back">–ù–∞–∑–∞–¥</span></button>
            <button class="ghost" id="printTodayBtn">üñ® <span id="t_print">–ü–µ—á–∞—Ç—å</span></button>
          </div>
          <div id="todayCards" class="cards"></div>
        </div>

        <!-- STEP 1 -->
        <div id="step1Box" class="hide">
          <div class="row">
            <div>
              <label id="t_nickLabel">–¢–≤–æ–π –Ω–∏–∫</label>
              <input id="nick" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: KiraLite" />
            </div>
            <div>
              <label id="t_dateLabel">–î–∞—Ç–∞</label>
              <input id="date" type="date" />
            </div>
          </div>

          <div class="hint" id="t_pickpc">–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö (–∫–ª–∏–∫–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏):</div>

          <div class="chipsSelected">
            <div style="width:100%; color:var(--muted); font-size:12px; margin-bottom:6px;">
              <span id="t_selected">–í—ã–±—Ä–∞–Ω–æ –ü–ö</span>: <b id="selectedCount">0</b>
            </div>
            <div id="selectedChips" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
          </div>

          <div class="btns">
            <button class="primary" id="toStep2Btn">‚û° <span id="t_next">–î–∞–ª–µ–µ</span></button>
            <button class="ghost" id="clearPcBtn">‚úñ <span id="t_clear">–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä</span></button>
          </div>

          <div class="notice" style="margin-top:10px;">
            <b id="t_tipAvail">–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b>
            <span id="t_tipAvail2">–ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ –ü–ö –ø–æ–¥—Å–≤–µ—Ç—è—Ç—Å—è ‚Äú—Å–≤–æ–±–æ–¥–Ω–æ/–∑–∞–Ω—è—Ç–æ‚Äù –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.</span>
          </div>

          <div id="pcGrid" class="pcgrid" aria-label="–°–ø–∏—Å–æ–∫ –ü–ö"></div>
        </div>

        <!-- STEP 2 -->
        <div id="step2Box" class="hide">
          <div class="row">
            <div>
              <label id="t_startLabel">–ù–∞—á–∞–ª–æ</label>
              <input id="start" type="time" />
            </div>
            <div>
              <label id="t_endLabel">–ö–æ–Ω–µ—Ü</label>
              <input id="end" type="time" />
            </div>
          </div>

          <div class="hint" id="t_durationHint">–ë—ã—Å—Ç—Ä–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</div>
          <div class="chipbar" id="durChips">
            <div class="chip" data-min="30">30m</div>
            <div class="chip" data-min="60">1h</div>
            <div class="chip" data-min="120">2h</div>
            <div class="chip" data-min="180">3h</div>
            <div class="chip" data-min="240">4h</div>
          </div>

          <div class="btns" style="margin-top:10px">
            <button class="ghost mini" id="toggleOnlyFreeBtn">‚úÖ <span id="t_onlyFree">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ</span></button>
            <span class="pill"><span id="t_crossMidnight">–ß–µ—Ä–µ–∑ –Ω–æ—á—å</span>: <strong id="crossMidnightPill">‚Äî</strong></span>
          </div>

          <div class="row" style="margin-top:10px;">
            <div>
              <label id="t_noteLabel">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="note" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: CS2 / –¢—É—Ä–Ω–∏—Ä" />
            </div>
            <div>
              <label id="t_priceLabel">–¶–µ–Ω–∞ (GEL/—á–∞—Å)</label>
              <input id="price" type="number" min="0" step="0.5" value="5" />
            </div>
          </div>

          <div class="notice" id="availabilityHintBox"></div>

          <div class="btns">
            <button class="ghost" id="backTo1Btn">‚¨Ö <span id="t_back">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="toStep3Btn">‚û° <span id="t_next2">–î–∞–ª–µ–µ</span></button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div id="step3Box" class="hide">
          <div class="notice" id="summaryBox"></div>

          <div class="btns">
            <button class="ghost" id="backTo2Btn">‚¨Ö <span id="t_back2">–ù–∞–∑–∞–¥</span></button>
            <button class="primary" id="createBtn">‚úÖ <span id="t_bookNow">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</span></button>
          </div>

          <div class="notice" id="msg" style="margin-top:10px;" aria-live="polite">OK</div>

          <div class="notice" id="nextStepsBox" style="margin-top:10px;">
            <b id="t_nextStepsTitle">–ß—Ç–æ –¥–∞–ª—å—à–µ?</b><br/>
            <span id="t_nextSteps1">‚úÖ –ü–æ–¥–æ–π–¥–∏ –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –Ω–∞–∑–æ–≤–∏ —Å–≤–æ–π –Ω–∏–∫.</span><br/>
            <span id="t_nextSteps2">‚è∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–∏–π—Ç–∏ –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞.</span><br/>
            <span id="t_nextSteps3">üí≥ –û–ø–ª–∞—Ç–∞ ‚Äî –Ω–∞ –º–µ—Å—Ç–µ (–æ–Ω–ª–∞–π–Ω –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ).</span>
          </div>

          <div class="btns" style="margin-top:10px;">
            <button class="ghost" id="showMyInlineBtn">üë§ <span id="t_my2">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
            <button class="ghost" id="copyShareBtn">üîó <span id="t_copyShare">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω—å</span></button>
          </div>

          <div class="notice" style="margin-top:10px;">
            <b id="t_qrTitle">QR –±—Ä–æ–Ω–∏</b><br/>
            <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:10px;">
              <canvas id="qrCanvas" width="160" height="160" style="background:#fff;border-radius:12px;border:1px solid rgba(255,255,255,.08)"></canvas>
              <div class="hint" id="qrHint">QR –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏. –ï—Å–ª–∏ QR –Ω–µ –ø–æ—è–≤–∏–ª—Å—è ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–∫, —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.</div>
            </div>
          </div>
        </div>

        <!-- MY BOOKINGS -->
        <div id="myBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;" id="t_myTitle">–ú–æ–∏ –±—Ä–æ–Ω–∏</h2>
            <div class="hint" id="t_myHint">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –Ω–∏–∫—É</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="row">
              <div>
                <label id="t_myNick">–ù–∏–∫</label>
                <input id="myNickInput" type="text" placeholder="–≤–≤–µ–¥–∏ –Ω–∏–∫" />
              </div>
              <div style="display:flex; align-items:end; gap:10px; flex-wrap:wrap;">
                <button class="primary" id="mySearchBtn">üîé <span id="t_show">–ü–æ–∫–∞–∑–∞—Ç—å</span></button>
                <button class="ghost" id="myCloseBtn">‚úñ <span id="t_close">–ó–∞–∫—Ä—ã—Ç—å</span></button>
              </div>
            </div>

            <table class="table" role="table" aria-label="–ú–æ–∏ –±—Ä–æ–Ω–∏">
              <thead>
                <tr>
                  <th style="width:160px" id="t_colDate">–î–∞—Ç–∞</th>
                  <th style="width:160px" id="t_colTime">–í—Ä–µ–º—è</th>
                  <th style="width:120px" id="t_colPc">–ü–ö</th>
                  <th id="t_colNote">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                  <th style="width:110px" id="t_colCost">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                  <th style="width:140px" id="t_colCancel">–û—Ç–º–µ–Ω–∞</th>
                </tr>
              </thead>
              <tbody id="myTable"></tbody>
            </table>

            <div class="hint" style="margin-top:10px;" id="t_myCancelHint">
              –û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏ (–ø–æ –Ω–∏–∫—É). –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ.
            </div>
          </div>
        </div>

        <!-- ADMIN (hidden by default) -->
        <div id="adminBox" class="hide" style="margin-top:12px;">
          <div class="hd" style="border:1px solid var(--line); border-radius:16px; margin-top:10px;">
            <h2 style="margin:0;font-size:14px;">Admin</h2>
            <div class="hint" id="t_adminHint">–¢–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
          </div>
          <div class="bd" style="border:1px solid var(--line); border-radius:16px; border-top:none;">
            <div class="row">
              <div>
                <label id="t_search">–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö)</label>
                <input id="search" type="text" placeholder="–ø–æ–∏—Å–∫" />
              </div>
              <div style="display:flex; align-items:end; gap:10px; flex-wrap:wrap;">
                <button class="ghost" id="clearFilterBtn">–°–±—Ä–æ—Å</button>
                <button class="ghost" id="printTodayAdminBtn">üñ® <span id="t_print2">–ü–µ—á–∞—Ç—å ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù</span></button>
                <button class="danger" id="wipeBtn">–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë</button>
              </div>
            </div>

            <table class="table" role="table" aria-label="–í—Å–µ –±—Ä–æ–Ω–∏ (admin)">
              <thead>
                <tr>
                  <th style="width:160px" id="t_colDate2">–î–∞—Ç–∞</th>
                  <th style="width:160px" id="t_colTime2">–í—Ä–µ–º—è</th>
                  <th style="width:120px" id="t_colPc2">–ü–ö</th>
                  <th id="t_colNick2">–ù–∏–∫</th>
                  <th style="width:110px" id="t_colCost2">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                  <th style="width:160px" id="t_colAct2">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="bookTable"></tbody>
            </table>
          </div>
        </div>

        <div class="footerbar">
          <div><span class="kbd">Esc</span> ‚Äî <span id="t_esc">–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç</span></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="mini ghost" id="openAdminBtn">üîê Admin</button>
            <button class="mini ghost" id="exitAdminBtn">üö™ Exit</button>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT -->
    <div class="card" id="rightSide">
      <div class="hd">
        <h2 id="t_sideTitle">–ü–æ–¥—Å–∫–∞–∑–∫–∞</h2>
        <div class="hint" id="t_sideHint">—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É</div>
      </div>
      <div class="bd">
        <div class="notice" id="helpBox"></div>

        <div style="height:12px"></div>
        <div class="notice" id="rulesBox"></div>

        <div style="height:12px"></div>
        <div class="notice">
          <b id="t_settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤ –∫–æ–¥–µ)</b><br/>
          <span class="hint" id="t_settingsDesc">
            –ï—Å–ª–∏ –∫–ª—É–± 24/7 ‚Äî –æ—Ç–∫–ª—é—á–∏ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã. –í—Å—ë –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ JS.
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // =========================
  // CONFIG (—Ç—É—Ç –º–µ–Ω—è–µ—à—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–¥ –∫–ª—É–±)
  // =========================
  const PCs = ["Bishop","Godzilla","Elf","Kadita","Orc","Lancelot","Fantomas","Soultaker","Pudge","Kratos"];

  const STORAGE_KEY = "sg_bookings_v3";
  const LANG_KEY = "sg_lang";
  const ADMIN_KEY = "sg_admin";
  const NICK_KEY = "sg_nick";
  const ONLY_FREE_KEY = "sg_only_free";

  const ADMIN_PASSWORD = "1234"; // ‚Üê –ø–æ–º–µ–Ω—è–π

  const MIN_BOOK_MINUTES = 30;
  const MAX_BOOK_HOURS = 8;
  const MAX_DAYS_AHEAD = 14;   // –º–∞–∫—Å–∏–º—É–º –±—Ä–æ–Ω–∏ –≤–ø–µ—Ä—ë–¥
  const ARRIVE_MIN_BEFORE = 5; // —Ç–µ–∫—Å—Ç ‚Äú–ø—Ä–∏–¥–∏ –∑–∞ 5 –º–∏–Ω—É—Ç‚Äù

  // –†–∞–±–æ—á–∏–µ —á–∞—Å—ã (–µ—Å–ª–∏ –∫–ª—É–± –Ω–µ 24/7)
  const WORKING_HOURS_ENABLED = true; // ‚Üê –ø–æ—Å—Ç–∞–≤—å false –µ—Å–ª–∏ 24/7
  const WORK_START = "10:00";         // –æ—Ç–∫—Ä—ã—Ç–∏–µ
  const WORK_END = "03:00";           // –∑–∞–∫—Ä—ã—Ç–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å)

  // =========================
  // i18n
  // =========================
  const i18n = {
    ru: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –≤—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
      today:"–°–µ–≥–æ–¥–Ω—è", bookings:"–ë—Ä–æ–Ω–µ–π",
      step1:"–ö–æ–º–ø—å—é—Ç–µ—Ä—ã", step2:"–í—Ä–µ–º—è", step3:"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
      hint:"–°–¥–µ–ª–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ",
      fast:"üéÆ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ 30 —Å–µ–∫—É–Ω–¥",
      intro1:"1) –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö",
      intro2:"2) –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
      intro3:"3) –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –∏ –≥–æ—Ç–æ–≤–æ",
      start:"–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
      my:"–ú–æ–∏ –±—Ä–æ–Ω–∏",
      todayBtn:"–°–µ–≥–æ–¥–Ω—è",
      todayTitle:"üìÖ –°–µ–≥–æ–¥–Ω—è",
      todayDesc:"–ó–¥–µ—Å—å –ø–æ–∫–∞–∑–∞–Ω—ã –±—Ä–æ–Ω–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (—É–¥–æ–±–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é).",
      print:"–ü–µ—á–∞—Ç—å",
      nickLabel:"–¢–≤–æ–π –Ω–∏–∫",
      dateLabel:"–î–∞—Ç–∞",
      pickpc:"–í—ã–±–µ—Ä–∏ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö (–∫–ª–∏–∫–∞–π –∫–∞—Ä—Ç–æ—á–∫–∏):",
      next:"–î–∞–ª–µ–µ",
      clear:"–û—á–∏—Å—Ç–∏—Ç—å –≤—ã–±–æ—Ä",
      selected:"–í—ã–±—Ä–∞–Ω–æ –ü–ö",
      tipAvail:"–ü–æ–¥—Å–∫–∞–∑–∫–∞:",
      tipAvail2:"–ù–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ –ü–ö –ø–æ–¥—Å–≤–µ—Ç—è—Ç—Å—è ‚Äú—Å–≤–æ–±–æ–¥–Ω–æ/–∑–∞–Ω—è—Ç–æ‚Äù –∏–º–µ–Ω–Ω–æ –ø–æ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.",
      startLabel:"–ù–∞—á–∞–ª–æ",
      endLabel:"–ö–æ–Ω–µ—Ü",
      durationHint:"–ë—ã—Å—Ç—Ä–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:",
      onlyFree:"–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ",
      crossMidnight:"–ß–µ—Ä–µ–∑ –Ω–æ—á—å",
      noteLabel:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      priceLabel:"–¶–µ–Ω–∞ (GEL/—á–∞—Å)",
      back:"–ù–∞–∑–∞–¥",
      bookNow:"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
      myTitle:"–ú–æ–∏ –±—Ä–æ–Ω–∏",
      myHint:"–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –Ω–∏–∫—É",
      myNick:"–ù–∏–∫",
      show:"–ü–æ–∫–∞–∑–∞—Ç—å",
      close:"–ó–∞–∫—Ä—ã—Ç—å",
      colDate:"–î–∞—Ç–∞",
      colTime:"–í—Ä–µ–º—è",
      colPc:"–ü–ö",
      colNote:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
      colCost:"–°—Ç–æ–∏–º–æ—Å—Ç—å",
      colCancel:"–û—Ç–º–µ–Ω–∞",
      myCancelHint:"–û—Ç–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏ (–ø–æ –Ω–∏–∫—É). –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ.",
      sideTitle:"–ü–æ–¥—Å–∫–∞–∑–∫–∞",
      sideHint:"—á—Ç–æ–±—ã –∏–≥—Ä–æ–∫ –ø–æ–Ω—è–ª —Å—Ä–∞–∑—É",
      help:
`‚úÖ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:
1) –ù–∞–∂–º–∏ ‚Äú–ù–∞—á–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ‚Äù
2) –í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
3) –í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4) –ù–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù

üë§ ‚Äú–ú–æ–∏ –±—Ä–æ–Ω–∏‚Äù ‚Äî —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å/–æ—Ç–º–µ–Ω–∏—Ç—å —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏.`,
      rules:"–ü—Ä–∞–≤–∏–ª–∞",
      rule1:"–ù–µ–ª—å–∑—è –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –±—Ä–æ–Ω–∏ –Ω–∞ –æ–¥–Ω–æ–º –ü–ö",
      rule2:`–ú–∏–Ω–∏–º—É–º ${MIN_BOOK_MINUTES} –º–∏–Ω—É—Ç, –º–∞–∫—Å–∏–º—É–º ${MAX_BOOK_HOURS} —á–∞—Å–æ–≤`,
      rule3:`–ú–æ–∂–Ω–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –Ω–∞ ${MAX_DAYS_AHEAD} –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥`,
      rule4on:`–†–∞–±–æ—á–∏–µ —á–∞—Å—ã: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"–†–∞–±–æ—á–∏–µ —á–∞—Å—ã: 24/7",
      esc:"–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç",
      adminHint:"–¢–æ–ª—å–∫–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è",
      search:"–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö)",
      colNick2:"–ù–∏–∫",
      colAct2:"–î–µ–π—Å—Ç–≤–∏—è",
      print2:"–ü–µ—á–∞—Ç—å ‚Äú–°–µ–≥–æ–¥–Ω—è‚Äù",
      msgPickPc:"–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã 1 –ü–ö.",
      msgNick:"–í–≤–µ–¥–∏ –Ω–∏–∫.",
      msgTime:"–í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞.",
      msgPast:"–ù–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º.",
      msgTooFar:"–°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ. –í—ã–±–µ—Ä–∏ –¥–∞—Ç—É –±–ª–∏–∂–µ.",
      msgDur:"–ù–µ–≤–µ—Ä–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.",
      msgHours:"–í–Ω–µ —Ä–∞–±–æ—á–∏—Ö —á–∞—Å–æ–≤ –∫–ª—É–±–∞.",
      msgOverlap:"–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –Ω–∞ –ü–ö",
      msgCreated:"–ì–æ—Ç–æ–≤–æ! –°–æ–∑–¥–∞–Ω–æ –±—Ä–æ–Ω–µ–π",
      msgNoMy:"–ù–µ—Ç –±—Ä–æ–Ω–µ–π –ø–æ –Ω–∏–∫—É",
      msgAdminOn:"Admin –≤–∫–ª—é—á–µ–Ω.",
      msgAdminOff:"Admin –≤—ã–∫–ª—é—á–µ–Ω.",
      promptAdmin:"–í–≤–µ–¥–∏ –∞–¥–º–∏–Ω-–ø–∞—Ä–æ–ª—å:",
      wrongPass:"–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.",
      confirmWipe:"–¢–æ—á–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å –í–°–ï –±—Ä–æ–Ω–∏ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ?",
      nextStepsTitle:"–ß—Ç–æ –¥–∞–ª—å—à–µ?",
      nextSteps1:"‚úÖ –ü–æ–¥–æ–π–¥–∏ –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏ –Ω–∞–∑–æ–≤–∏ —Å–≤–æ–π –Ω–∏–∫.",
      nextSteps2:`‚è∞ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–∏–π—Ç–∏ –∑–∞ ${ARRIVE_MIN_BEFORE} –º–∏–Ω—É—Ç –¥–æ –Ω–∞—á–∞–ª–∞.`,
      nextSteps3:"üí≥ –û–ø–ª–∞—Ç–∞ ‚Äî –Ω–∞ –º–µ—Å—Ç–µ (–æ–Ω–ª–∞–π–Ω –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ).",
      copyShare:"–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω—å",
      copied:"–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä.",
      copyFail:"–ù–µ —Å–º–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ‚Äî –≤—ã–¥–µ–ª–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é.",
      qrTitle:"QR –±—Ä–æ–Ω–∏",
      qrHint:"QR –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—Ä–æ–Ω–∏. –ï—Å–ª–∏ QR –Ω–µ –ø–æ—è–≤–∏–ª—Å—è ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–∫.",
      availHint:"–°–µ–π—á–∞—Å –ü–ö –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∏–Ω—Ç–µ—Ä–≤–∞–ª—É: –∑–µ–ª—ë–Ω—ã–π ‚Äî —Å–≤–æ–±–æ–¥–µ–Ω, –∫—Ä–∞—Å–Ω—ã–π ‚Äî –∑–∞–Ω—è—Ç."
    },

    en: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"Pick PC ‚Üí pick time ‚Üí confirm",
      today:"Today", bookings:"Bookings",
      step1:"PCs", step2:"Time", step3:"Confirm",
      hint:"Made super simple",
      fast:"üéÆ Booking in 30 seconds",
      intro1:"1) Pick one or multiple PCs",
      intro2:"2) Pick date and duration",
      intro3:"3) Confirm ‚Äî done",
      start:"Start booking",
      my:"My bookings",
      todayBtn:"Today",
      todayTitle:"üìÖ Today",
      todayDesc:"Today bookings (useful for admin and users).",
      print:"Print",
      nickLabel:"Your nickname",
      dateLabel:"Date",
      pickpc:"Select 1 or multiple PCs (click cards):",
      next:"Next",
      clear:"Clear selection",
      selected:"Selected PCs",
      tipAvail:"Tip:",
      tipAvail2:"Next step will highlight PCs as free/busy for your chosen time.",
      startLabel:"Start",
      endLabel:"End",
      durationHint:"Quick duration:",
      onlyFree:"Show only free",
      crossMidnight:"Overnight",
      noteLabel:"Note (optional)",
      priceLabel:"Price (GEL/hour)",
      back:"Back",
      bookNow:"Book now",
      myTitle:"My bookings",
      myHint:"Filtered by nickname",
      myNick:"Nickname",
      show:"Show",
      close:"Close",
      colDate:"Date",
      colTime:"Time",
      colPc:"PC",
      colNote:"Note",
      colCost:"Cost",
      colCancel:"Cancel",
      myCancelHint:"You can cancel only your bookings (by nickname). Admin can cancel any.",
      sideTitle:"Hint",
      sideHint:"so users understand fast",
      help:
`‚úÖ How to use:
1) Tap ‚ÄúStart booking‚Äù
2) Pick PCs (multi-select)
3) Pick time & duration
4) Tap ‚ÄúBook now‚Äù

üë§ ‚ÄúMy bookings‚Äù to view/cancel your records.`,
      rules:"Rules",
      rule1:"No overlaps on the same PC",
      rule2:`Min ${MIN_BOOK_MINUTES} min, max ${MAX_BOOK_HOURS} hours`,
      rule3:`Max booking ahead: ${MAX_DAYS_AHEAD} days`,
      rule4on:`Working hours: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"Working hours: 24/7",
      esc:"back to start",
      adminHint:"Management only",
      search:"Search (nick/PC)",
      colNick2:"Nick",
      colAct2:"Actions",
      print2:"Print ‚ÄúToday‚Äù",
      msgPickPc:"Select at least 1 PC.",
      msgNick:"Enter your nickname.",
      msgTime:"Pick start and end time.",
      msgPast:"You can‚Äôt book in the past.",
      msgTooFar:"Too far ahead. Choose a closer date.",
      msgDur:"Invalid duration.",
      msgHours:"Outside working hours.",
      msgOverlap:"Overlap on PC",
      msgCreated:"Done! Bookings created",
      msgNoMy:"No bookings for nickname",
      msgAdminOn:"Admin enabled.",
      msgAdminOff:"Admin disabled.",
      promptAdmin:"Enter admin password:",
      wrongPass:"Wrong password.",
      confirmWipe:"Delete ALL bookings on this device?",
      nextStepsTitle:"What‚Äôs next?",
      nextSteps1:"‚úÖ Tell admin your nickname.",
      nextSteps2:`‚è∞ Please come ${ARRIVE_MIN_BEFORE} minutes earlier.`,
      nextSteps3:"üí≥ Pay on site (online later).",
      copyShare:"Copy booking",
      copied:"Copied to clipboard.",
      copyFail:"Copy failed ‚Äî select and copy manually.",
      qrTitle:"Booking QR",
      qrHint:"QR updates after booking. If not visible ‚Äî it‚Äôs OK.",
      availHint:"PCs are highlighted for your selected time: green ‚Äî free, red ‚Äî busy."
    },

    ka: {
      title:"Sakompiutere Gaming ‚Äî Booking",
      sub:"·Éê·Éò·É†·É©·Éò·Éî PC ‚Üí ·Éê·Éò·É†·É©·Éò·Éî ·Éì·É†·Éù ‚Üí ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî",
      today:"·Éì·É¶·Éî·É°", bookings:"·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      step1:"·Éô·Éù·Éõ·Éû·Éò·É£·É¢·Éî·É†·Éî·Éë·Éò", step2:"·Éì·É†·Éù", step3:"·Éì·Éê·Éì·Éê·É°·É¢·É£·É†·Éî·Éë·Éê",
      hint:"·Éõ·Éê·É•·É°·Éò·Éõ·Éê·Éö·É£·É†·Éê·Éì ·Éõ·Éê·É†·É¢·Éò·Éï·Éò",
      fast:"üéÆ ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò 30 ·É¨·Éê·Éõ·É®·Éò",
      intro1:"1) ·Éê·Éò·É†·É©·Éò·Éî ·Éî·É†·Éó·Éò ·Éê·Éú ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC",
      intro2:"2) ·Éê·Éò·É†·É©·Éò·Éî ·Éó·Éê·É†·Éò·É¶·Éò ·Éì·Éê ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê",
      intro3:"3) ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî ‚Äî ·Éõ·Éñ·Éê·Éì·Éê·Éê",
      start:"·Éì·Éê·É¨·Éß·Éî·Éë·Éê",
      my:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      todayBtn:"·Éì·É¶·Éî·É°",
      todayTitle:"üìÖ ·Éì·É¶·Éî·É°",
      todayDesc:"·Éì·É¶·Éî·Éï·Éê·Éú·Éì·Éî·Éö·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò (·Éê·Éì·Éõ·Éò·Éú·Éò·É°·Éó·Éï·Éò·É° ·Éì·Éê ·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éö·Éò·É°·Éó·Éï·Éò·É°).",
      print:"·Éë·Éî·É≠·Éì·Éï·Éê",
      nickLabel:"·Éú·Éò·Éô·Éò",
      dateLabel:"·Éó·Éê·É†·Éò·É¶·Éò",
      pickpc:"·Éê·Éò·É†·É©·Éò·Éî 1 ·Éê·Éú ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC (·Éì·Éê·Éê·Éô·Éö·Éò·Éô·Éî):",
      next:"·É®·Éî·Éõ·Éì·Éî·Éí·Éò",
      clear:"·Éí·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê",
      selected:"·Éê·É†·É©·Éî·É£·Éö·Éò PC",
      tipAvail:"·Éõ·Éò·Éú·Éò·É®·Éú·Éî·Éë·Éê:",
      tipAvail2:"·É®·Éî·Éõ·Éì·Éî·Éí ·Éú·Éê·Éë·Éò·ÉØ·Éñ·Éî PC-·Éî·Éë·Éò ·Éõ·Éù·Éú·Éò·É®·Éú·É£·Éö·Éò ·Éò·É•·Éú·Éî·Éë·Éê ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò/·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò ·Éó·É•·Éï·Éî·Éú·É° ·Éì·É†·Éù·Éñ·Éî.",
      startLabel:"·Éì·Éê·É¨·Éß·Éî·Éë·Éê",
      endLabel:"·Éì·Éê·É°·É†·É£·Éö·Éî·Éë·Éê",
      durationHint:"·É°·É¨·É†·Éê·É§·Éò ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê:",
      onlyFree:"·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò",
      crossMidnight:"·É¶·Éê·Éõ·Éò·Éó ·Éí·Éê·Éì·Éê·É°·Éï·Éö·Éê",
      noteLabel:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù)",
      priceLabel:"·É§·Éê·É°·Éò (GEL/·É°·Éê·Éê·Éó·Éò)",
      back:"·É£·Éô·Éê·Éú",
      bookNow:"·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê",
      myTitle:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      myHint:"·Éú·Éò·Éô·Éò·Éó ·É§·Éò·Éö·É¢·É†·Éê·É™·Éò·Éê",
      myNick:"·Éú·Éò·Éô·Éò",
      show:"·É©·Éï·Éî·Éú·Éî·Éë·Éê",
      close:"·Éì·Éê·ÉÆ·É£·É†·Éï·Éê",
      colDate:"·Éó·Éê·É†·Éò·É¶·Éò",
      colTime:"·Éì·É†·Éù",
      colPc:"PC",
      colNote:"·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê",
      colCost:"·É§·Éê·É°·Éò",
      colCancel:"·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê",
      myCancelHint:"·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê ·Éí·Éê·Éê·É£·É•·Éõ·Éù ·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·É®·Éî·Éú·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò (·Éú·Éò·Éô·Éò·Éó). ·Éê·Éì·Éõ·Éò·Éú·É° ·É®·Éî·É£·É´·Éö·Éò·Éê ·Éß·Éï·Éî·Éö·Éê.",
      sideTitle:"·Éõ·Éò·Éú·Éò·É®·Éú·Éî·Éë·Éê",
      sideHint:"·É†·Éù·Éõ ·É°·É¨·É†·Éê·É§·Éê·Éì ·Éí·Éê·Éò·Éí·Éù·Éú",
      help:
`‚úÖ ·Éí·Éê·Éõ·Éù·Éß·Éî·Éú·Éî·Éë·Éê:
1) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·É¨·Éß·Éî·Éë·Éê‚Äù
2) ·Éê·Éò·É†·É©·Éò·Éî PC-·Éî·Éë·Éò (·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî)
3) ·Éê·Éò·É†·É©·Éò·Éî ·Éì·É†·Éù ·Éì·Éê ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê
4) ·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê‚Äù

üë§ ‚Äú·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò‚Äù ‚Äî ·Éú·Éê·ÉÆ·Éï·Éê/·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê.`,
      rules:"·É¨·Éî·É°·Éî·Éë·Éò",
      rule1:"·Éî·É†·Éó PC-·Éñ·Éî ·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê",
      rule2:`·Éõ·Éò·Éú ${MIN_BOOK_MINUTES} ·É¨·Éó, ·Éõ·Éê·É•·É° ${MAX_BOOK_HOURS} ·É°·Éó`,
      rule3:`·Éõ·Éê·É•·É° ·É¨·Éò·Éú·Éê·É°·É¨·Éê·É†: ${MAX_DAYS_AHEAD} ·Éì·É¶·Éî`,
      rule4on:`·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·Éò: ${WORK_START} ‚Üí ${WORK_END}`,
      rule4off:"·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·Éò: 24/7",
      esc:"·Éì·Éê·Éë·É†·É£·Éú·Éî·Éë·Éê ·Éì·Éê·É°·Éê·É¨·Éß·Éò·É°·Éñ·Éî",
      adminHint:"·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éõ·Éê·É†·Éó·Éï·Éê",
      search:"·É´·Éî·Éë·Éú·Éê (·Éú·Éò·Éô·Éò/PC)",
      colNick2:"·Éú·Éò·Éô·Éò",
      colAct2:"·É•·Éõ·Éî·Éì·Éî·Éë·Éê",
      print2:"·Éë·Éî·É≠·Éì·Éï·Éê ‚Äú·Éì·É¶·Éî·É°‚Äù",
      msgPickPc:"·Éê·Éò·É†·É©·Éò·Éî ·Éõ·Éò·Éú·Éò·Éõ·É£·Éõ 1 PC.",
      msgNick:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî ·Éú·Éò·Éô·Éò.",
      msgTime:"·Éê·Éò·É†·É©·Éò·Éî ·Éì·Éê·É¨·Éß·Éî·Éë·Éê ·Éì·Éê ·Éì·Éê·É°·É†·É£·Éö·Éî·Éë·Éê.",
      msgPast:"·É¨·Éê·É†·É°·É£·Éö·É®·Éò ·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê.",
      msgTooFar:"·É´·Éê·Éö·Éò·Éê·Éú ·É®·Éù·É†·É°·Éê·Éê. ·Éê·Éò·É†·É©·Éò·Éî ·Éê·ÉÆ·Éö·Éù ·Éó·Éê·É†·Éò·É¶·Éò.",
      msgDur:"·Éê·É†·Éê·É°·É¨·Éù·É†·Éò ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê.",
      msgHours:"·É°·Éê·Éõ·É£·É®·Éê·Éù ·É°·Éê·Éê·Éó·Éî·Éë·É° ·Éí·Éê·É†·Éî·Éó·Éê·Éê.",
      msgOverlap:"·Éí·Éê·Éì·Éê·Éô·Éï·Éî·Éó·Éê PC-·Éñ·Éî",
      msgCreated:"·Éõ·Éñ·Éê·Éì·Éê·Éê! ·É®·Éî·É•·Éõ·Éú·Éò·Éö·Éò·Éê ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      msgNoMy:"·Éê·Éõ ·Éú·Éò·Éô·Éñ·Éî ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·É† ·Éê·É†·Éò·É°",
      msgAdminOn:"Admin ·É©·Éê·É†·Éó·É£·Éö·Éò·Éê.",
      msgAdminOff:"Admin ·Éí·Éê·Éõ·Éù·É†·Éó·É£·Éö·Éò·Éê.",
      promptAdmin:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî admin ·Éû·Éê·É†·Éù·Éö·Éò:",
      wrongPass:"·Éê·É†·Éê·É°·É¨·Éù·É†·Éò ·Éû·Éê·É†·Éù·Éö·Éò.",
      confirmWipe:"·É¨·Éê·É®·Éê·Éö·Éù ·Éß·Éï·Éî·Éö·Éê ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·Éõ ·Éõ·Éù·É¨·Éß·Éù·Éë·Éò·Éö·Éù·Éë·Éê·Éñ·Éî?",
      nextStepsTitle:"·É®·Éî·Éõ·Éì·Éî·Éí ·É†·Éê?",
      nextSteps1:"‚úÖ ·É£·Éó·ÉÆ·Éê·É†·Éò ·Éê·Éì·Éõ·Éò·Éú·É° ·É®·Éî·Éú·Éò ·Éú·Éò·Éô·Éò.",
      nextSteps2:`‚è∞ ·Éõ·Éù·Éì·Éò ${ARRIVE_MIN_BEFORE} ·É¨·É£·Éó·Éò·Éó ·Éê·Éì·É†·Éî.`,
      nextSteps3:"üí≥ ·Éí·Éê·Éì·Éê·ÉÆ·Éì·Éê ·Éê·Éì·Éí·Éò·Éö·Éñ·Éî (·Éù·Éú·Éö·Éê·Éò·Éú ·É®·Éî·Éõ·Éì·Éî·Éí).",
      copyShare:"·ÉØ·Éê·Éï·É®·Éú·Éò·É° ·Éô·Éù·Éû·Éò·É†·Éî·Éë·Éê",
      copied:"·Éô·Éù·Éû·Éò·É†·Éî·Éë·É£·Éö·Éò·Éê.",
      copyFail:"·Éô·Éù·Éû·Éò·É†·Éî·Éë·Éê ·Éï·Éî·É† ·Éõ·Éù·ÉÆ·Éî·É†·ÉÆ·Éì·Éê ‚Äî ·ÉÆ·Éî·Éö·Éò·Éó ·Éì·Éê·Éê·Éô·Éù·Éû·Éò·É†·Éî.",
      qrTitle:"QR ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò",
      qrHint:"QR ·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éì·Éî·Éë·Éê ·ÉØ·Éê·Éï·É®·Éú·Éò·É° ·É®·Éî·Éõ·Éì·Éî·Éí. ·Éó·É£ ·Éê·É† ·É©·Éê·Éú·É° ‚Äî ok.",
      availHint:"PC-·Éî·Éë·Éò ·Éõ·Éù·Éú·Éò·É®·Éú·É£·Éö·Éò·Éê ·Éó·É•·Éï·Éî·Éú·É° ·Éì·É†·Éù·Éñ·Éî: ·Éõ·É¨·Éï·Éê·Éú·Éî ‚Äî ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò, ·É¨·Éò·Éó·Éî·Éö·Éò ‚Äî ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò."
    }
  };

  // =========================
  // Helpers
  // =========================
  const $ = (id) => document.getElementById(id);
  const pad2 = (n)=>String(n).padStart(2,"0");
  const toLocalISODate = (d)=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const parseDateISO = (iso)=>{ const [y,m,d]=iso.split("-").map(Number); return new Date(y, m-1, d, 0,0,0,0); };
  const minutesFromTimeStr = (t)=>{ const [h,m]=t.split(":").map(Number); return h*60+m; };
  const timeStrFromMinutes = (min)=>{ min=Math.max(0,Math.min(1440,min)); const h=Math.floor(min/60), m=min%60; return `${pad2(h)}:${pad2(m)}`; };
  const money = (n)=>`${Number(n||0).toFixed(2)} GEL`;
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  const calcPriceGel = (pricePerHour, mins)=>Math.round((Number(pricePerHour)*(mins/60))*2)/2;
  const addDays = (dateObj, days)=>{ const d=new Date(dateObj); d.setDate(d.getDate()+days); return d; };

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // =========================
  // Storage
  // =========================
  function loadBookings(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    }catch(e){ return []; }
  }
  function saveBookings(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

  // =========================
  // State
  // =========================
  let lang = localStorage.getItem(LANG_KEY) || "ru";
  if(!i18n[lang]) lang = "ru";

  let isAdmin = localStorage.getItem(ADMIN_KEY) === "1";
  let onlyFree = localStorage.getItem(ONLY_FREE_KEY) === "1";
  let selectedPCs = new Set();

  let bookings = loadBookings();

  // =========================
  // i18n apply
  // =========================
  function t(k){ return i18n[lang][k] ?? i18n["ru"][k] ?? k; }

  function applyLang(){
    $("t_title").textContent = t("title");
    $("t_sub").textContent = t("sub");
    $("t_today").textContent = t("today");
    $("t_bookings").textContent = t("bookings");

    $("t_step1").textContent = t("step1");
    $("t_step2").textContent = t("step2");
    $("t_step3").textContent = t("step3");
    $("t_hint").textContent = t("hint");

    $("t_fast").textContent = t("fast");
    $("t_intro1").textContent = t("intro1");
    $("t_intro2").textContent = t("intro2");
    $("t_intro3").textContent = t("intro3");
    $("t_start").textContent = t("start");
    $("t_my").textContent = t("my");
    $("t_my2").textContent = t("my");
    $("t_todayBtn").textContent = t("todayBtn");

    $("t_todayTitle").textContent = t("todayTitle");
    $("t_todayDesc").textContent = t("todayDesc");
    $("t_print").textContent = t("print");
    $("t_print2").textContent = t("print2");

    $("t_nickLabel").textContent = t("nickLabel");
    $("t_dateLabel").textContent = t("dateLabel");
    $("t_pickpc").textContent = t("pickpc");
    $("t_next").textContent = t("next");
    $("t_next2").textContent = t("next");
    $("t_clear").textContent = t("clear");
    $("t_selected").textContent = t("selected");
    $("t_tipAvail").textContent = t("tipAvail");
    $("t_tipAvail2").textContent = t("tipAvail2");

    $("t_startLabel").textContent = t("startLabel");
    $("t_endLabel").textContent = t("endLabel");
    $("t_durationHint").textContent = t("durationHint");
    $("t_onlyFree").textContent = t("onlyFree");
    $("t_crossMidnight").textContent = t("crossMidnight");

    $("t_noteLabel").textContent = t("noteLabel");
    $("t_priceLabel").textContent = t("priceLabel");
    $("t_back").textContent = t("back");
    $("t_back2").textContent = t("back");

    $("t_bookNow").textContent = t("bookNow");

    $("t_myTitle").textContent = t("myTitle");
    $("t_myHint").textContent = t("myHint");
    $("t_myNick").textContent = t("myNick");
    $("t_show").textContent = t("show");
    $("t_close").textContent = t("close");

    $("t_colDate").textContent = t("colDate");
    $("t_colTime").textContent = t("colTime");
    $("t_colPc").textContent = t("colPc");
    $("t_colNote").textContent = t("colNote");
    $("t_colCost").textContent = t("colCost");
    $("t_colCancel").textContent = t("colCancel");
    $("t_myCancelHint").textContent = t("myCancelHint");

    $("t_sideTitle").textContent = t("sideTitle");
    $("t_sideHint").textContent = t("sideHint");
    $("helpBox").textContent = t("help");

    $("rulesBox").innerHTML = `
      <b>${t("rules")}</b><br/>
      ‚Ä¢ ${t("rule1")}<br/>
      ‚Ä¢ ${t("rule2")}<br/>
      ‚Ä¢ ${t("rule3")}<br/>
      ‚Ä¢ ${WORKING_HOURS_ENABLED ? t("rule4on") : t("rule4off")}
    `;

    $("t_settingsTitle").textContent = "Settings";
    $("t_settingsDesc").textContent = "Change config at top of JS.";

    $("t_esc").textContent = t("esc");
    $("t_adminHint").textContent = t("adminHint");
    $("t_search").textContent = t("search");

    $("t_colDate2").textContent = t("colDate");
    $("t_colTime2").textContent = t("colTime");
    $("t_colPc2").textContent = t("colPc");
    $("t_colNick2").textContent = t("colNick2");
    $("t_colCost2").textContent = t("colCost");
    $("t_colAct2").textContent = t("colAct2");

    $("t_nextStepsTitle").textContent = t("nextStepsTitle");
    $("t_nextSteps1").textContent = t("nextSteps1");
    $("t_nextSteps2").textContent = t("nextSteps2");
    $("t_nextSteps3").textContent = t("nextSteps3");
    $("t_copyShare").textContent = t("copyShare");
    $("t_qrTitle").textContent = t("qrTitle");
    $("qrHint").textContent = t("qrHint");

    // Language buttons
    $("lang_ru").classList.toggle("active", lang==="ru");
    $("lang_en").classList.toggle("active", lang==="en");
    $("lang_ka").classList.toggle("active", lang==="ka");

    // Only free button visual
    $("toggleOnlyFreeBtn").classList.toggle("primary", onlyFree);
  }

  // =========================
  // Flow / UI
  // =========================
  function setStep(n){
    $("step1").classList.toggle("active", n===1);
    $("step2").classList.toggle("active", n===2);
    $("step3").classList.toggle("active", n===3);
    $("step1Box").classList.toggle("hide", n!==1);
    $("step2Box").classList.toggle("hide", n!==2);
    $("step3Box").classList.toggle("hide", n!==3);
    $("introBox").classList.add("hide");
    $("todayBox").classList.add("hide");
  }

  function showIntro(){
    $("introBox").classList.remove("hide");
    $("step1Box").classList.add("hide");
    $("step2Box").classList.add("hide");
    $("step3Box").classList.add("hide");
    $("todayBox").classList.add("hide");
    $("step1").classList.remove("active");
    $("step2").classList.remove("active");
    $("step3").classList.remove("active");
  }

  function showToday(){
    $("todayBox").classList.remove("hide");
    $("introBox").classList.add("hide");
    $("step1Box").classList.add("hide");
    $("step2Box").classList.add("hide");
    $("step3Box").classList.add("hide");
    $("step1").classList.remove("active");
    $("step2").classList.remove("active");
    $("step3").classList.remove("active");
    renderTodayCards();
  }

  function setMsg(text, kind="info"){
    const el = $("msg");
    el.textContent = text;
    el.style.borderColor =
      kind==="good" ? "rgba(52,211,153,.45)" :
      kind==="bad" ? "rgba(251,113,133,.55)" :
      "rgba(110,231,255,.35)";
    el.style.background =
      kind==="good" ? "rgba(52,211,153,.08)" :
      kind==="bad" ? "rgba(251,113,133,.08)" :
      "rgba(110,231,255,.06)";
  }

  function renderPills(){
    $("countPill").textContent = String(bookings.length);
    $("todayPill").textContent = new Date().toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
  }

  function renderSelected(){
    $("selectedCount").textContent = String(selectedPCs.size);

    const chips = $("selectedChips");
    chips.innerHTML = "";
    if(selectedPCs.size===0){
      chips.innerHTML = `<span class="hint">‚Äî</span>`;
      return;
    }
    for(const pc of Array.from(selectedPCs)){
      const ch = document.createElement("div");
      ch.className = "pcchip";
      ch.innerHTML = `${pc} <span class="x">√ó</span>`;
      ch.addEventListener("click", () => {
        selectedPCs.delete(pc);
        renderSelected();
        renderPCGrid();
        updateAvailabilityUI();
        renderSummary();
      });
      chips.appendChild(ch);
    }
  }

  function renderDurationChips(activeMin=null){
    document.querySelectorAll("#durChips .chip").forEach(ch=>{
      const m = Number(ch.getAttribute("data-min"));
      ch.classList.toggle("active", activeMin===m);
    });
  }

  function normalizeEndByChip(mins){
    const s = minutesFromTimeStr($("start").value);
    $("end").value = timeStrFromMinutes(clamp(s + mins, 0, 1440));
  }

  // =========================
  // Booking time as absolute range (support overnight)
  // =========================
  function getRangeFromInputs(){
    const dateStartISO = $("date").value;
    const startStr = $("start").value;
    const endStr = $("end").value;
    if(!dateStartISO || !startStr || !endStr) return null;

    const startMin = minutesFromTimeStr(startStr);
    const endMin = minutesFromTimeStr(endStr);

    const d0 = parseDateISO(dateStartISO);
    const startAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(startMin/60), startMin%60, 0, 0);

    let spansMidnight = false;
    let endAbs;
    if(endMin > startMin){
      endAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(endMin/60), endMin%60, 0, 0);
    }else{
      // overnight to next day
      spansMidnight = true;
      const d1 = addDays(d0, 1);
      endAbs = new Date(d1.getFullYear(), d1.getMonth(), d1.getDate(), Math.floor(endMin/60), endMin%60, 0, 0);
    }
    return { dateStartISO, startStr, endStr, startAbs, endAbs, spansMidnight };
  }

  function minutesBetween(a,b){ return Math.round((b - a)/60000); }

  // =========================
  // Working hours check (supports overnight hours)
  // =========================
  function isWithinWorkingHours(range){
    if(!WORKING_HOURS_ENABLED) return true;

    const ws = minutesFromTimeStr(WORK_START);
    const we = minutesFromTimeStr(WORK_END);

    // Working window can cross midnight.
    // We validate that BOTH start and end are inside the open window.
    const startMin = minutesFromTimeStr(range.startStr);
    const endMin = minutesFromTimeStr(range.endStr);

    const within = (m) => {
      if(we > ws){
        return m >= ws && m <= we;
      }else{
        // window crosses midnight, e.g. 10:00 -> 03:00 means open from 10:00..24:00 and 00:00..03:00
        return (m >= ws && m <= 1440) || (m >= 0 && m <= we);
      }
    };

    // If booking spans midnight, still check each endpoint by its local time component.
    return within(startMin) && within(endMin);
  }

  // =========================
  // Convert stored booking to absolute range
  // =========================
  function bookingToAbs(b){
    // b: {dateStart, start, end, spansMidnight, ...} (we keep compatibility with old)
    const dateISO = b.dateStart || b.date || "";
    const d0 = parseDateISO(dateISO);
    const sMin = minutesFromTimeStr(b.start);
    const eMin = minutesFromTimeStr(b.end);

    const startAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(sMin/60), sMin%60, 0, 0);

    let endAbs;
    const span = b.spansMidnight || (eMin <= sMin);
    if(!span){
      endAbs = new Date(d0.getFullYear(), d0.getMonth(), d0.getDate(), Math.floor(eMin/60), eMin%60, 0, 0);
    }else{
      const d1 = addDays(d0, 1);
      endAbs = new Date(d1.getFullYear(), d1.getMonth(), d1.getDate(), Math.floor(eMin/60), eMin%60, 0, 0);
    }
    return { startAbs, endAbs };
  }

  function intersects(a1,a2,b1,b2){
    return Math.max(a1.getTime(), b1.getTime()) < Math.min(a2.getTime(), b2.getTime());
  }

  // =========================
  // Availability per PC for current selected range
  // =========================
  function firstConflictForPC(pc, range){
    for(const b of bookings){
      if(b.pc !== pc) continue;
      const br = bookingToAbs(b);
      if(intersects(range.startAbs, range.endAbs, br.startAbs, br.endAbs)){
        return b;
      }
    }
    return null;
  }

  function renderPCGrid(){
    const grid = $("pcGrid");
    grid.innerHTML = "";

    const range = getRangeFromInputs(); // may be null on step1
    const date = $("date").value;

    for(const pc of PCs){
      let dot = "good";
      let label = "Free";
      let detail = "‚Äî";

      // if we have time range, show exact free/busy
      if(range){
        const c = firstConflictForPC(pc, range);
        if(c){
          dot = "bad";
          label = "Busy";
          detail = `Busy: ${c.start}‚Üí${c.end}${(c.spansMidnight || (minutesFromTimeStr(c.end)<=minutesFromTimeStr(c.start))) ? " (+1)" : ""}`;
        }else{
          dot = "good";
          label = "Free";
          detail = "Free for selected time";
        }
      }else{
        // fallback day-based info
        const dayList = bookings
          .filter(b => b.pc===pc && (b.dateStart||b.date)===date)
          .sort((a,b)=>a.start.localeCompare(b.start));
        if(dayList.length){
          dot = "warn";
          label = "Booked";
          detail = `Next: ${dayList[0].start}`;
        }
      }

      // Only free filter
      if(onlyFree && range){
        const c = firstConflictForPC(pc, range);
        if(c) continue;
      }

      const div = document.createElement("div");
      div.className = "pc";
      if(selectedPCs.has(pc)) div.classList.add("selected");
      div.setAttribute("data-pc", pc);

      if(range){
        const c = firstConflictForPC(pc, range);
        if(c) div.classList.add("busyForRange");
        else div.classList.add("freeForRange");
      }

      div.innerHTML = `
        <div class="check">‚úì</div>
        <div class="name">${pc}</div>
        <div class="meta">
          <span class="tag"><span class="dot ${dot}"></span>${label}</span>
          <span class="mut">${detail}</span>
        </div>
      `;

      div.addEventListener("click", () => {
        if(selectedPCs.has(pc)) selectedPCs.delete(pc);
        else selectedPCs.add(pc);
        renderSelected();
        renderPCGrid();
        renderSummary();
      });

      grid.appendChild(div);
    }
  }

  function updateAvailabilityUI(){
    const range = getRangeFromInputs();
    $("crossMidnightPill").textContent = range ? (range.spansMidnight ? "YES" : "NO") : "‚Äî";
    $("availabilityHintBox").textContent = t("availHint");
    renderPCGrid();
  }

  // =========================
  // Validation rules
  // =========================
  function validateBeforeNext(){
    const nick = ($("nick").value||"").trim();
    if(!nick) return {ok:false, msg:t("msgNick")};
    if(selectedPCs.size===0) return {ok:false, msg:t("msgPickPc")};

    // date range
    const dateISO = $("date").value;
    if(!dateISO) return {ok:false, msg:t("msgTime")};

    const d0 = parseDateISO(dateISO);
    const today0 = parseDateISO(toLocalISODate(new Date()));
    const diffDays = Math.round((d0 - today0)/86400000);
    if(diffDays > MAX_DAYS_AHEAD) return {ok:false, msg:t("msgTooFar")};

    // store nick
    localStorage.setItem(NICK_KEY, nick);

    return {ok:true};
  }

  function validateBeforeCreate(){
    const range = getRangeFromInputs();
    if(!range) return {ok:false, msg:t("msgTime")};

    const mins = minutesBetween(range.startAbs, range.endAbs);
    if(mins < MIN_BOOK_MINUTES || mins > MAX_BOOK_HOURS*60) return {ok:false, msg:t("msgDur")};

    // cannot book in past
    const now = new Date();
    if(range.startAbs.getTime() < now.getTime()) return {ok:false, msg:t("msgPast")};

    // working hours check
    if(!isWithinWorkingHours(range)) return {ok:false, msg:t("msgHours")};

    // conflicts check for all selected PCs
    for(const pc of selectedPCs){
      const c = firstConflictForPC(pc, range);
      if(c){
        return {ok:false, msg:`${t("msgOverlap")} ${pc}: ${c.start}‚Üí${c.end} (${c.nick})`};
      }
    }
    return {ok:true, range};
  }

  // =========================
  // Create bookings (multi-PC)
  // =========================
  function createMultiBooking(){
    const v = validateBeforeCreate();
    if(!v.ok){
      setMsg(v.msg, "bad");
      return;
    }
    const range = v.range;

    const nick = ($("nick").value||"").trim();
    const note = ($("note").value||"").trim();
    const pricePerHour = Number($("price").value || 5);
    const mins = minutesBetween(range.startAbs, range.endAbs);
    const perPc = calcPriceGel(pricePerHour, mins);

    const created = [];
    for(const pc of selectedPCs){
      created.push({
        id: (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2)),
        nick,
        pc,
        dateStart: range.dateStartISO,
        start: range.startStr,
        end: range.endStr,
        spansMidnight: range.spansMidnight,
        note,
        pricePerHour,
        totalGel: perPc,
        createdAt: new Date().toISOString()
      });
    }

    bookings = bookings.concat(created);
    saveBookings(bookings);
    renderPills();
    renderAdminTable();
    setMsg(`${t("msgCreated")}: ${created.length}`, "good");
    renderMyTable(nick);
    renderSummary();
    renderTodayCards();

    // Generate QR for this booking set (share payload)
    const payload = buildShareText({ nick, pcs:Array.from(selectedPCs), range, note, perPc, total: perPc*selectedPCs.size });
    renderQR(payload);

    // copy-friendly success
    $("qrHint").textContent = t("qrHint");
  }

  function buildShareText({nick, pcs, range, note, perPc, total}){
    const when = range.spansMidnight
      ? `${range.dateStartISO} ${range.startStr} ‚Üí ${addDays(parseDateISO(range.dateStartISO),1).toISOString().slice(0,10)} ${range.endStr}`
      : `${range.dateStartISO} ${range.startStr} ‚Üí ${range.endStr}`;

    return [
      "Sakompiutere Booking",
      `Nick: ${nick}`,
      `PCs: ${pcs.join(", ")}`,
      `Time: ${when}`,
      note ? `Note: ${note}` : null,
      `Cost per PC: ${money(perPc)}`,
      `Total: ${money(total)}`
    ].filter(Boolean).join("\n");
  }

  async function copyShare(){
    const range = getRangeFromInputs();
    const nick = ($("nick").value||"").trim();
    const note = ($("note").value||"").trim();
    if(!range || !nick || selectedPCs.size===0){
      setMsg("Fill booking first.", "bad");
      return;
    }
    const mins = minutesBetween(range.startAbs, range.endAbs);
    const perPc = calcPriceGel(Number($("price").value||5), mins);
    const text = buildShareText({
      nick,
      pcs:Array.from(selectedPCs),
      range,
      note,
      perPc,
      total: perPc*selectedPCs.size
    });

    try{
      await navigator.clipboard.writeText(text);
      setMsg(t("copied"), "good");
    }catch(e){
      setMsg(t("copyFail"), "bad");
    }
  }

  function renderQR(text){
    const canvas = $("qrCanvas");
    if(!window.QRCode || !QRCode.toCanvas){
      // fallback: clear canvas
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const g = ctx;
      g.fillStyle = "#ffffff";
      g.fillRect(0,0,canvas.width,canvas.height);
      g.fillStyle = "#111111";
      g.font = "12px sans-serif";
      g.fillText("QR lib not loaded", 20, 80);
      return;
    }
    QRCode.toCanvas(canvas, text, { width: 160, margin: 1 }, (err) => {
      if(err){
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0,0,canvas.width,canvas.height);
      }
    });
  }

  // =========================
  // Summary
  // =========================
  function renderSummary(){
    const nick = ($("nick").value || "").trim();
    const range = getRangeFromInputs();
    const note = ($("note").value || "").trim();
    const pricePerHour = Number($("price").value || 5);
    const pcs = Array.from(selectedPCs);

    let perPc=0, total=0, when="‚Äî", dur="‚Äî";
    if(range){
      const mins = minutesBetween(range.startAbs, range.endAbs);
      perPc = calcPriceGel(pricePerHour, mins);
      total = perPc * pcs.length;
      dur = `${mins} min`;
      when = range.spansMidnight
        ? `${range.dateStartISO} ${range.startStr} ‚Üí ${addDays(parseDateISO(range.dateStartISO),1).toISOString().slice(0,10)} ${range.endStr}`
        : `${range.dateStartISO} ${range.startStr} ‚Üí ${range.endStr}`;
    }

    $("summaryBox").innerHTML = `
      <b>${t("step3")}</b><br/>
      ‚Ä¢ ${t("nickLabel")}: <b>${escapeHtml(nick || "‚Äî")}</b><br/>
      ‚Ä¢ ${t("colTime")}: <b>${escapeHtml(when)}</b> <span class="hint">(${dur})</span><br/>
      ‚Ä¢ ${t("selected")}: <b>${pcs.length}</b><br/>
      ‚Ä¢ PCs: <b>${escapeHtml(pcs.length ? pcs.join(", ") : "‚Äî")}</b><br/>
      ‚Ä¢ ${t("colCost")} (per PC): <b>${money(perPc)}</b><br/>
      ‚Ä¢ ${t("colCost")} total: <b>${money(total)}</b><br/>
      ${note ? ("‚Ä¢ "+t("colNote")+": <b>"+escapeHtml(note)+"</b><br/>") : ""}
    `;
  }

  // =========================
  // Today cards
  // =========================
  function renderTodayCards(){
    const box = $("todayCards");
    if(!box) return;
    const todayISO = toLocalISODate(new Date());

    const list = bookings
      .filter(b => (b.dateStart||b.date) === todayISO)
      .sort((a,b)=> (a.start+a.pc).localeCompare(b.start+b.pc));

    box.innerHTML = "";
    if(!list.length){
      box.innerHTML = `<div class="notice">‚Äî</div>`;
      return;
    }

    for(const b of list){
      const span = b.spansMidnight || (minutesFromTimeStr(b.end)<=minutesFromTimeStr(b.start));
      const timeStr = span ? `${b.start} ‚Üí ${b.end} (+1)` : `${b.start} ‚Üí ${b.end}`;

      const card = document.createElement("div");
      card.className = "bcard";
      card.innerHTML = `
        <div class="left">
          <div class="top">
            <span class="badge ok">${escapeHtml(b.pc)}</span>
            <span class="badge">${escapeHtml(timeStr)}</span>
          </div>
          <div><b>${escapeHtml(b.nick)}</b></div>
          <div class="mut">${escapeHtml(b.note || "")}</div>
        </div>
        <div style="text-align:right;">
          <div class="mut">${money(b.totalGel)}</div>
        </div>
      `;
      box.appendChild(card);
    }
  }

  // =========================
  // My bookings + cancel own
  // =========================
  function renderMyTable(nick){
    const tbody = $("myTable");
    tbody.innerHTML = "";
    const q = (nick || "").trim();
    if(!q){
      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">‚Äî</td></tr>`;
      return;
    }

    const list = bookings
      .filter(b => (b.nick||"").trim().toLowerCase() === q.toLowerCase())
      .sort((a,b)=> ((a.dateStart||a.date)+a.start+a.pc).localeCompare((b.dateStart||b.date)+b.start+b.pc));

    if(!list.length){
      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">${t("msgNoMy")}: <b>${escapeHtml(q)}</b></td></tr>`;
      return;
    }

    for(const b of list){
      const span = b.spansMidnight || (minutesFromTimeStr(b.end)<=minutesFromTimeStr(b.start));
      const timeStr = span ? `${b.start} ‚Üí ${b.end} (+1)` : `${b.start} ‚Üí ${b.end}`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(b.dateStart || b.date)}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(b.pc)}</b></td>
        <td style="color:var(--muted)">${escapeHtml(b.note || "")}</td>
        <td>${money(b.totalGel)}</td>
        <td>
          <button class="mini danger" data-id="${b.id}">Cancel</button>
        </td>
      `;
      tbody.appendChild(tr);
    }

    tbody.querySelectorAll("button[data-id]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-id");
        const b = bookings.find(x=>x.id===id);
        if(!b) return;

        // only cancel own (by nickname) unless admin
        const currentNick = ($("myNickInput").value || "").trim().toLowerCase();
        if(!isAdmin && (b.nick||"").trim().toLowerCase() !== currentNick){
          alert("You can cancel only your bookings.");
          return;
        }
        if(!confirm(`Cancel booking?\n${b.nick} ‚Ä¢ ${b.pc}\n${b.dateStart||b.date} ${b.start}‚Üí${b.end}`)) return;
        bookings = bookings.filter(x=>x.id!==id);
        saveBookings(bookings);
        renderPills();
        renderMyTable($("myNickInput").value);
        renderAdminTable();
        updateAvailabilityUI();
        renderTodayCards();
      });
    });
  }

  function openMyBox(prefillNick){
    $("myBox").classList.remove("hide");
    $("myNickInput").value = prefillNick || localStorage.getItem(NICK_KEY) || $("nick").value || "";
    renderMyTable($("myNickInput").value);
    $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
  }
  function closeMyBox(){ $("myBox").classList.add("hide"); }

  // =========================
  // Admin
  // =========================
  function renderAdminTable(){
    $("adminBox").classList.toggle("hide", !isAdmin);

    const tbody = $("bookTable");
    tbody.innerHTML = "";
    if(!isAdmin) return;

    const q = ($("search").value||"").trim().toLowerCase();
    const list = bookings
      .filter(b => !q || (b.nick||"").toLowerCase().includes(q) || (b.pc||"").toLowerCase().includes(q))
      .sort((a,b)=> ((a.dateStart||a.date)+a.start+a.pc).localeCompare((b.dateStart||b.date)+b.start+b.pc));

    for(const b of list){
      const span = b.spansMidnight || (minutesFromTimeStr(b.end)<=minutesFromTimeStr(b.start));
      const timeStr = span ? `${b.start} ‚Üí ${b.end} (+1)` : `${b.start} ‚Üí ${b.end}`;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${escapeHtml(b.dateStart || b.date)}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(b.pc)}</b></td>
        <td><b>${escapeHtml(b.nick)}</b></td>
        <td>${money(b.totalGel)}</td>
        <td><button class="mini danger" data-id="${b.id}">Delete</button></td>
      `;
      tbody.appendChild(tr);
    }

    tbody.querySelectorAll("button[data-id]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.getAttribute("data-id");
        const b = bookings.find(x=>x.id===id);
        if(!b) return;
        if(!confirm(`Delete booking?\n${b.nick} ‚Ä¢ ${b.pc}\n${b.dateStart||b.date} ${b.start}‚Üí${b.end}`)) return;
        bookings = bookings.filter(x=>x.id!==id);
        saveBookings(bookings);
        renderPills();
        renderAdminTable();
        updateAvailabilityUI();
        renderTodayCards();
      });
    });
  }

  function adminOn(){
    isAdmin = true;
    localStorage.setItem(ADMIN_KEY, "1");
    setMsg(t("msgAdminOn"), "good");
    renderAdminTable();
  }
  function adminOff(){
    isAdmin = false;
    localStorage.setItem(ADMIN_KEY, "0");
    setMsg(t("msgAdminOff"), "info");
    renderAdminTable();
  }

  // =========================
  // Boot + events
  // =========================
  function boot(){
    // defaults
    const now = new Date();
    $("todayPill").textContent = now.toLocaleDateString(undefined, {year:"numeric", month:"2-digit", day:"2-digit"});
    $("date").value = toLocalISODate(now);

    // default time: round to 5 minutes
    const startMin = clamp(now.getHours()*60 + (Math.ceil(now.getMinutes()/5)*5), 0, 23*60+55);
    $("start").value = timeStrFromMinutes(startMin);
    $("end").value = timeStrFromMinutes(clamp(startMin + 60, 0, 1440));

    // restore nick
    const savedNick = localStorage.getItem(NICK_KEY) || "";
    if(savedNick) $("nick").value = savedNick;

    renderPills();
    applyLang();
    renderSelected();
    updateAvailabilityUI();
    renderAdminTable();
    renderTodayCards();

    // language buttons
    $("lang_ru").onclick = () => { lang="ru"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); updateAvailabilityUI(); };
    $("lang_en").onclick = () => { lang="en"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); updateAvailabilityUI(); };
    $("lang_ka").onclick = () => { lang="ka"; localStorage.setItem(LANG_KEY,lang); applyLang(); renderSummary(); updateAvailabilityUI(); };

    // intro buttons
    $("startBtn").onclick = () => setStep(1);
    $("viewMyBtn").onclick = () => openMyBox($("nick").value);
    $("todayBtn").onclick = () => showToday();

    // today view
    $("todayBackBtn").onclick = () => showIntro();
    $("printTodayBtn").onclick = () => window.print();

    // step1
    $("clearPcBtn").onclick = () => { selectedPCs.clear(); renderSelected(); updateAvailabilityUI(); renderSummary(); };

    $("toStep2Btn").onclick = () => {
      const v = validateBeforeNext();
      if(!v.ok){ alert(v.msg); return; }
      setStep(2);
      // suggest 1h
      renderDurationChips(60);
      normalizeEndByChip(60);
      updateAvailabilityUI();
      renderSummary();
    };

    $("nick").addEventListener("input", ()=>{
      localStorage.setItem(NICK_KEY, ($("nick").value||"").trim());
    });

    $("date").addEventListener("change", ()=>{
      // if date too far ahead warn but not block until creation
      updateAvailabilityUI();
      renderTodayCards();
    });

    // duration chips
    document.querySelectorAll("#durChips .chip").forEach(ch=>{
      ch.addEventListener("click", ()=>{
        const mins = Number(ch.getAttribute("data-min"));
        renderDurationChips(mins);
        normalizeEndByChip(mins);
        updateAvailabilityUI();
        renderSummary();
      });
    });

    // manual time changes
    $("start").addEventListener("change", ()=>{
      renderDurationChips(null);
      updateAvailabilityUI();
      renderSummary();
    });
    $("end").addEventListener("change", ()=>{
      renderDurationChips(null);
      updateAvailabilityUI();
      renderSummary();
    });

    $("price").addEventListener("input", ()=>renderSummary());
    $("note").addEventListener("input", ()=>renderSummary());

    $("toggleOnlyFreeBtn").onclick = () => {
      onlyFree = !onlyFree;
      localStorage.setItem(ONLY_FREE_KEY, onlyFree ? "1":"0");
      $("toggleOnlyFreeBtn").classList.toggle("primary", onlyFree);
      updateAvailabilityUI();
    };

    // step2 nav
    $("backTo1Btn").onclick = () => setStep(1);
    $("toStep3Btn").onclick = () => {
      const v = validateBeforeNext();
      if(!v.ok){ alert(v.msg); return; }
      setStep(3);
      renderSummary();
      setMsg("OK", "info");
    };

    // step3 nav
    $("backTo2Btn").onclick = () => setStep(2);
    $("createBtn").onclick = createMultiBooking;
    $("showMyInlineBtn").onclick = () => openMyBox($("nick").value);
    $("copyShareBtn").onclick = copyShare;

    // my box
    $("mySearchBtn").onclick = () => renderMyTable($("myNickInput").value);
    $("myCloseBtn").onclick = closeMyBox;

    // admin
    $("openAdminBtn").onclick = () => {
      if(isAdmin) return;
      const pass = prompt(t("promptAdmin"));
      if(pass === null) return;
      if(pass === ADMIN_PASSWORD) adminOn();
      else alert(t("wrongPass"));
    };
    $("exitAdminBtn").onclick = () => adminOff();
    $("exitAdminBtn").style.display = isAdmin ? "inline-block" : "none";

    // admin events
    $("search").addEventListener("input", renderAdminTable);
    $("clearFilterBtn").onclick = () => { $("search").value=""; renderAdminTable(); };
    $("printTodayAdminBtn").onclick = () => { renderTodayCards(); window.print(); };
    $("wipeBtn").onclick = () => {
      if(!confirm(t("confirmWipe"))) return;
      bookings = [];
      saveBookings(bookings);
      selectedPCs.clear();
      renderSelected();
      renderPills();
      updateAvailabilityUI();
      renderAdminTable();
      renderTodayCards();
      setMsg("Wiped.", "good");
    };

    // Esc back to intro
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") showIntro();
    });

    // initial cross-midnight pill + availability hint
    updateAvailabilityUI();
    renderSummary();
    showIntro();
  }

  boot();
})();
</script>
</body>
</html>
