<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Sakompiutere Gaming ‚Äî Booking</title>
  <meta name="theme-color" content="#0b1020" />
  <link rel="icon" href="data:," />

  <!-- Firebase v9 COMPAT -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    :root{
      --bg:#070a12;
      --card:#0b1020;
      --muted:#9aa4bf;
      --text:#eaf0ff;
      --line:rgba(255,255,255,.09);
      --accent:#6ee7ff;
      --accent2:#a78bfa;
      --good:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --shadow:0 20px 60px rgba(0,0,0,.55);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(110,231,255,.14), transparent 60%),
        radial-gradient(900px 700px at 80% 10%, rgba(167,139,250,.16), transparent 60%),
        radial-gradient(800px 700px at 40% 120%, rgba(52,211,153,.12), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .wrap{max-width:1180px; margin:0 auto; padding:18px;}

    .bgGlow{
      position:fixed; inset:-30%;
      background:
        radial-gradient(600px 400px at 20% 30%, rgba(110,231,255,.08), transparent 60%),
        radial-gradient(700px 450px at 75% 25%, rgba(167,139,250,.10), transparent 60%),
        radial-gradient(650px 420px at 55% 80%, rgba(52,211,153,.07), transparent 60%);
      animation: drift 14s ease-in-out infinite alternate;
      pointer-events:none;
      z-index:-1;
      opacity:.9;
    }
    @keyframes drift{
      0%{ transform: translate3d(-10px,-8px,0) scale(1.02); }
      100%{ transform: translate3d(14px,10px,0) scale(1.05); }
    }

    header{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px; border:1px solid var(--line); border-radius:var(--r);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:sticky; top:14px; z-index:20;
      backdrop-filter: blur(10px);
      animation: headIn .45s cubic-bezier(.2,.8,.2,1) both;
    }
    @keyframes headIn{from{transform:translateY(-12px);opacity:0}to{transform:translateY(0);opacity:1}}

    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background:
        radial-gradient(circle at 30% 20%, rgba(110,231,255,.95), rgba(167,139,250,.85) 40%, rgba(0,0,0,0) 72%),
        linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.02));
      border:1px solid var(--line);
      box-shadow: 0 12px 30px rgba(0,0,0,.4);
      position:relative; overflow:hidden;
      animation: float 3.6s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
    .logo:after{
      content:"";
      position:absolute; inset:-70%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.20), transparent);
      transform: rotate(20deg) translateX(-70%);
      animation: shine 5.5s ease-in-out infinite;
    }
    @keyframes shine{
      0%,70%{transform:rotate(20deg) translateX(-75%);opacity:0}
      80%{opacity:1}
      100%{transform:rotate(20deg) translateX(75%);opacity:0}
    }

    .brand h1{margin:0; font-size:16px; letter-spacing:.35px}
    .brand .sub{margin:0; color:var(--muted); font-size:12px}

    .rightbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .pill{
      padding:8px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted); font-size:12px;
      display:flex; gap:8px; align-items:center;
    }
    .pill strong{color:var(--text); font-weight:950}

    .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.22)}
    .dot.ok{
      background: rgba(52,211,153,.95);
      box-shadow: 0 0 0 0 rgba(52,211,153,.40);
      animation: pulse 1.8s ease-out infinite;
    }
    .dot.err{ background: rgba(251,113,133,.95); }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(52,211,153,.35); }
      70%{ box-shadow:0 0 0 10px rgba(52,211,153,0); }
      100%{ box-shadow:0 0 0 0 rgba(52,211,153,0); }
    }

    .lang{
      display:flex; gap:6px;
      padding:6px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }
    .lang button{
      padding:7px 10px; border-radius:999px;
      border:1px solid transparent;
      background:transparent;
      color:var(--muted);
      cursor:pointer;
      font-weight:950;
      font-size:12px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .lang button:hover{ transform: translateY(-1px); }
    .lang button.active{
      border-color: rgba(110,231,255,.55);
      background: rgba(110,231,255,.10);
      color: var(--text);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:18px;
      margin-top:16px;
      animation: fadeUp .35s ease both;
    }
    @keyframes fadeUp{from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr;}
      header{position:static;}
    }

    .card{
      border:1px solid var(--line);
      border-radius:var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.10);
    }
    .hd h2{margin:0; font-size:14px}
    .hint{color:var(--muted); font-size:12px}
    .bd{padding:14px 16px}

    .notice{
      border:1px dashed rgba(110,231,255,.35);
      background: rgba(110,231,255,.06);
      padding:12px 12px;
      border-radius:16px;
      font-size:12px;
      line-height:1.4;
      transition: transform .12s ease, border-color .2s ease, background .2s ease;
    }
    .notice:hover{transform:translateY(-1px);border-color:rgba(110,231,255,.50);background:rgba(110,231,255,.075)}

    .btns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.2px;
      transition: transform .10s ease, border-color .12s ease, background .12s ease, box-shadow .12s ease, opacity .12s ease;
      position:relative;
      overflow:hidden;
    }
    button:before{
      content:"";
      position:absolute; inset:-40% -40%;
      background: radial-gradient(240px 120px at 20% 30%, rgba(110,231,255,.16), transparent 55%);
      opacity:0;
      transition: opacity .2s ease;
      pointer-events:none;
    }
    button:hover:before{opacity:1}
    button:hover{border-color: rgba(110,231,255,.5); transform: translateY(-1px)}
    button:active{transform: translateY(0) scale(.99)}
    button[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .primary{
      border-color: rgba(110,231,255,.55);
      background: linear-gradient(180deg, rgba(110,231,255,.18), rgba(167,139,250,.10));
      box-shadow: 0 0 0 0 rgba(110,231,255,0);
    }
    .primary:hover{ box-shadow: 0 0 0 3px rgba(110,231,255,.10); }

    .ghost{background:transparent}
    .danger{border-color: rgba(251,113,133,.6); background: rgba(251,113,133,.10)}
    .mini{padding:6px 10px; border-radius:12px; font-size:12px; font-weight:1000}
    .chipmini{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:rgba(0,0,0,.18);
      color:var(--muted);
      font-size:12px;
      transition: transform .12s ease, border-color .12s ease;
    }
    .chipmini:hover{ transform: translateY(-1px); border-color: rgba(110,231,255,.35); }
    .chipmini b{color:var(--text)}

    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px}
    input, select{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      outline:none;
      transition: border-color .12s ease, box-shadow .12s ease, transform .12s ease;
    }
    input:focus, select:focus{border-color: rgba(110,231,255,.6); box-shadow:0 0 0 3px rgba(110,231,255,.12)}
    input:hover, select:hover{ transform: translateY(-1px); }
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;}
    @media (max-width:520px){ .row{grid-template-columns:1fr;} }

    .pcgrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 980px){ .pcgrid{grid-template-columns: repeat(2, 1fr);} }

    .pc{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:16px;
      background:rgba(0,0,0,.22);
      cursor:pointer;
      transition: transform .10s ease, border-color .12s ease, box-shadow .12s ease;
      user-select:none;
      position:relative;
      min-height:74px;
      overflow:hidden;
    }
    .pc:before{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(600px 220px at -20% 0%, rgba(110,231,255,.16), transparent 62%);
      opacity:0;
      transition: opacity .2s ease;
      pointer-events:none;
    }
    .pc:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.4)}
    .pc:hover:before{opacity:1}
    .pc .name{font-weight:1100; letter-spacing:.25px}
    .pc .meta{margin-top:6px; color:var(--muted); font-size:12px}
    .pc.selected{
      border-color: rgba(110,231,255,.75);
      box-shadow: 0 0 0 3px rgba(110,231,255,.10);
    }
    .check{
      position:absolute; top:10px; right:10px;
      width:22px; height:22px; border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      display:grid; place-items:center;
      color: transparent;
      font-weight:1100;
      font-size:12px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease, color .12s ease;
    }
    .pc.selected .check{
      border-color: rgba(110,231,255,.75);
      background: rgba(110,231,255,.14);
      color: var(--text);
      transform: scale(1.06);
    }

    .timeBox{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      border-radius:18px;
      padding:12px;
      transition: transform .12s ease, border-color .2s ease;
    }
    .timeBox:hover{ transform: translateY(-1px); border-color: rgba(110,231,255,.28); }
    .timeTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .timeTop .title{
      font-weight:1100; font-size:13px;
      display:flex; gap:10px; align-items:center;
    }
    .timeList{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:8px;
      margin-top:10px;
    }
    @media (max-width:980px){ .timeList{grid-template-columns: repeat(3, 1fr);} }
    @media (max-width:520px){ .timeList{grid-template-columns: repeat(2, 1fr);} }

    .tbtn{
      padding:10px 10px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      transition: transform .10s ease, border-color .12s ease, box-shadow .12s ease, filter .12s ease;
      font-weight:1100;
      text-align:center;
      user-select:none;
      position:relative;
      overflow:hidden;
      animation: inSlots .22s ease both;
    }
    @keyframes inSlots{from{transform:translateY(6px);opacity:0}to{transform:translateY(0);opacity:1}}
    .tbtn:after{
      content:"";
      position:absolute; inset:-40% -40%;
      background: radial-gradient(220px 120px at 20% 20%, rgba(110,231,255,.12), transparent 55%);
      opacity:0;
      transition: opacity .2s ease;
      pointer-events:none;
    }
    .tbtn:hover:after{opacity:1}
    .tbtn:hover{transform: translateY(-1px); border-color: rgba(110,231,255,.5)}
    .tbtn.busy{
      cursor:not-allowed;
      opacity:.65;
      border-color: rgba(251,113,133,.40);
      background: rgba(251,113,133,.06);
      color: rgba(251,113,133,.9);
      transform:none !important;
      filter: grayscale(.1);
    }
    .tbtn.active{
      border-color: rgba(110,231,255,.75);
      box-shadow: 0 0 0 3px rgba(110,231,255,.10);
      background: rgba(110,231,255,.08);
    }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border:1px solid var(--line);
      border-radius:16px;
      margin-top:10px;
    }
    th, td{
      padding:10px 10px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
      font-size:12px;
    }
    th{color:var(--muted); font-weight:1100; text-align:left; background:rgba(255,255,255,.03)}
    tr:last-child td{border-bottom:none}

    .footerbar{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-top:12px;
      color: var(--muted);
      font-size:12px;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding:2px 6px;
      border:1px solid var(--line);
      border-radius:8px;
      background:rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
    }
    .hide{display:none !important;}

    .panel{ animation: panelIn .22s ease both; }
    @keyframes panelIn{from{transform:translateY(8px);opacity:0}to{transform:translateY(0);opacity:1}}

    .toastIn{ animation: toast .25s ease both; }
    @keyframes toast{from{transform:translateY(6px);opacity:0}to{transform:translateY(0);opacity:1}}

    .backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.58);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:999;
    }
    .backdrop.show{display:flex; animation: fade .18s ease both;}
    @keyframes fade{ from{opacity:0} to{opacity:1} }
    .modal{
      width:min(560px, 100%);
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      animation: pop .22s ease both;
      transform-origin: 50% 20%;
    }
    @keyframes pop{from{transform:translateY(12px) scale(.98);opacity:0}to{transform:translateY(0) scale(1);opacity:1}}
    .mh{
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.14);
    }
    .mb{padding:14px 16px}
    .mut{color:var(--muted); font-size:12px}
    .linkbtn{
      border:1px solid var(--line);
      background:transparent;
      color:var(--muted);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      cursor:pointer;
    }
    .linkbtn:hover{ color:var(--text); border-color: rgba(110,231,255,.35); }

    .slider{
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 18px 55px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .sliderTop{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.16);
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size:12px;
      font-weight:1100;
      transition: transform .12s ease;
    }
    .badge:hover{ transform: translateY(-1px); }
    .slides{ position:relative; height: 260px; overflow:hidden; }
    .slide{
      position:absolute; inset:0;
      padding:16px 16px 14px;
      opacity:0; transform: translateX(14px);
      transition: opacity .35s ease, transform .35s ease;
      pointer-events:none;
    }
    .slide.active{ opacity:1; transform: translateX(0); pointer-events:auto; }
    .sIcon{
      width:44px; height:44px; border-radius:16px;
      border:1px solid var(--line);
      background:
        radial-gradient(circle at 20% 15%, rgba(110,231,255,.35), transparent 60%),
        radial-gradient(circle at 80% 20%, rgba(167,139,250,.28), transparent 60%),
        rgba(0,0,0,.20);
      display:grid; place-items:center;
      font-size:20px;
      margin-bottom:10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      animation: bob 2.8s ease-in-out infinite;
    }
    @keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
    .sH{ margin:0; font-size:14px; letter-spacing:.2px; font-weight:1200; }
    .sP{ margin:8px 0 0; color: var(--muted); font-size:12px; line-height:1.5; }
    .sList{
      margin:10px 0 0; padding:0; list-style:none;
      display:grid; gap:8px;
    }
    .sList li{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.06);
      background: rgba(0,0,0,.18);
      transition: transform .12s ease, border-color .12s ease;
    }
    .sList li:hover{ transform: translateY(-1px); border-color: rgba(110,231,255,.22); }
    .sliderBot{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:12px 14px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.14);
    }
    .dots{display:flex; gap:8px; align-items:center;}
    .sdot{
      width:8px; height:8px; border-radius:999px;
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.10);
      transition: transform .2s ease, background .2s ease;
      cursor:pointer;
    }
    .sdot.on{ background: rgba(110,231,255,.75); transform: scale(1.25); }
    .navBtn{ padding:8px 10px; border-radius:12px; font-size:12px; }

    .successBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.68);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:1000;
    }
    .successBackdrop.show{display:flex; animation: fade .18s ease both;}
    .successCard{
      width:min(560px, 100%);
      border:1px solid var(--line);
      border-radius:22px;
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      animation: pop .22s ease both;
    }
    .confetti{position:absolute; inset:0; pointer-events:none; overflow:hidden;}
    .confetti i{
      position:absolute;
      width:10px; height:14px;
      border-radius:3px;
      opacity:.85;
      transform: translateY(-20px) rotate(0deg);
      animation: fall 900ms linear forwards;
    }
    @keyframes fall{to{transform: translateY(520px) rotate(260deg); opacity:0.95;}}
    .successTop{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background: rgba(0,0,0,.16);
    }
    .successTop b{font-size:14px}
    .successBody{ padding:16px; }
    .bigCheck{
      width:62px; height:62px; border-radius:22px;
      border:1px solid rgba(52,211,153,.35);
      background: radial-gradient(circle at 25% 20%, rgba(52,211,153,.35), rgba(52,211,153,.08) 55%, rgba(0,0,0,.12));
      display:grid; place-items:center;
      font-size:28px;
      margin-bottom:12px;
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
      animation: checkPop .45s cubic-bezier(.2,.8,.2,1) both;
    }
    @keyframes checkPop{0%{transform:scale(.8);opacity:0}60%{transform:scale(1.08);opacity:1}100%{transform:scale(1);opacity:1}}
    .successInfo{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      border-radius:18px;
      padding:12px 12px;
      color: var(--muted);
      font-size:12px;
      line-height:1.55;
    }
    .successInfo b{color: var(--text)}
    .successActions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}

    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>

<body>
<div class="bgGlow" aria-hidden="true"></div>

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="t_title">Sakompiutere Gaming ‚Äî Booking</h1>
        <p class="sub" id="t_sub">–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –¥–∞—Ç—É ‚Üí –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</p>
      </div>
    </div>

    <div class="rightbar">
      <div class="lang" aria-label="Language selector">
        <button id="lang_ru" type="button">RU</button>
        <button id="lang_en" type="button">EN</button>
        <button id="lang_ka" type="button">KA</button>
      </div>

      <div class="pill"><span id="t_user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>: <strong id="userPill">‚Äî</strong></div>

      <div class="pill">
        <span class="dot" id="cloudDot"></span>
        <span id="t_status">–°—Ç–∞—Ç—É—Å</span>: <strong id="cloudPill">‚Ä¶</strong>
      </div>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <div class="hd">
        <h2 id="t_main">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <div class="hint" id="hintTop">–û–Ω–ª–∞–π–Ω –±–∞–∑–∞ —á–µ—Ä–µ–∑ Firebase</div>
      </div>

      <div class="bd">
        <!-- AUTH BAR -->
        <div class="notice" id="authBar">
          <b id="t_authTitle">–ê–∫–∫–∞—É–Ω—Ç</b><br/>
          <span id="t_authDesc">–ß—Ç–æ–±—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ‚Äî –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏.</span>
          <div class="btns">
            <button class="primary" id="openAuthBtn" type="button">üîë <span id="t_login">–í–æ–π—Ç–∏</span> / <span id="t_register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span></button>
            <button class="ghost hide" id="logoutBtn" type="button">üö™ <span id="t_logout">–í—ã–π—Ç–∏</span></button>
          </div>
          <div class="notice" style="margin-top:10px" id="authMsg">‚Äî</div>
        </div>

        <!-- FORM -->
        <div style="margin-top:12px">
          <div class="row">
            <div>
              <label id="t_nickLabel">–¢–≤–æ–π –Ω–∏–∫ (–≤ –∫–ª—É–±–µ)</label>
              <input id="nick" type="text" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: KiraLite" />
            </div>
            <div>
              <label id="t_dateLabel">–î–∞—Ç–∞ (—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å)</label>
              <input id="date" type="date" />
            </div>
          </div>

          <div class="row">
            <div>
              <label id="t_duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</label>
              <select id="duration">
                <option value="60">1h</option>
                <option value="90">1h 30m</option>
                <option value="120">2h</option>
                <option value="180">3h</option>
                <option value="240">4h</option>
              </select>
            </div>
            <div>
              <label id="t_noteLabel">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="note" type="text" placeholder="CS2 / –¢—É—Ä–Ω–∏—Ä" />
            </div>
          </div>

          <div class="hint" id="t_pickpc">–í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):</div>
          <div id="pcGrid" class="pcgrid"></div>

          <!-- TIME PICKER -->
          <div class="timeBox">
            <div class="timeTop">
              <div class="title">‚è± <span id="t_timeTitle">–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏</span></div>
              <div class="chipmini" id="pickedSummary"><b>‚Äî</b></div>
            </div>

            <div class="btns" style="margin-top:0">
              <button class="ghost mini" id="nextFreeBtn" type="button">‚ö° <span id="t_nextFree">–°–ª–µ–¥—É—é—â–∏–π —Å–≤–æ–±–æ–¥–Ω—ã–π</span></button>
              <button class="ghost mini" id="refreshBtn" type="button">üîÑ <span id="t_refresh">–û–±–Ω–æ–≤–∏—Ç—å</span></button>
            </div>

            <div class="timeList" id="timeList"></div>
            <div class="mut" style="margin-top:10px" id="timeHint">–í—ã–±–µ—Ä–∏ –ü–ö + –¥–∞—Ç—É + –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –ø–æ—è–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞—Ä—Ç—ã.</div>
          </div>

          <div class="btns" style="margin-top:12px">
            <button class="primary" id="createBtn" type="button">‚úÖ <span id="t_bookNow">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</span></button>
            <button class="ghost" id="myBtn" type="button">üë§ <span id="t_my">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
            <button class="ghost" id="todayBtn" type="button">üìÖ <span id="t_today">–°–µ–≥–æ–¥–Ω—è</span></button>
          </div>

          <div class="notice" style="margin-top:10px" id="msgBox">‚Äî</div>
        </div>

        <!-- MY BOOKINGS -->
        <div id="myBox" class="hide panel" style="margin-top:14px">
          <div class="btns">
            <button class="ghost" id="closeMyBtn" type="button">‚úñ <span id="t_close">–ó–∞–∫—Ä—ã—Ç—å</span></button>
          </div>
          <table>
            <thead>
              <tr>
                <th id="t_colDate">–î–µ–Ω—å</th>
                <th id="t_colTime">–í—Ä–µ–º—è</th>
                <th id="t_colPc">–ü–ö</th>
                <th id="t_colNote">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                <th id="t_colAct">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody id="myTable"></tbody>
          </table>
        </div>

        <!-- TODAY -->
        <div id="todayBox" class="hide panel" style="margin-top:14px">
          <div class="btns">
            <button class="ghost" id="closeTodayBtn" type="button">‚úñ <span id="t_close2">–ó–∞–∫—Ä—ã—Ç—å</span></button>
          </div>
          <table>
            <thead>
              <tr>
                <th id="t_colTime2">–í—Ä–µ–º—è</th>
                <th id="t_colPc2">–ü–ö</th>
                <th id="t_colNick2">–ù–∏–∫</th>
                <th id="t_colNote2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
              </tr>
            </thead>
            <tbody id="todayTable"></tbody>
          </table>
        </div>

        <!-- ADMIN -->
        <div id="adminBox" class="hide panel" style="margin-top:14px">
          <div class="notice">
            <b id="t_adminTitle">Admin</b> ‚Äî <span id="t_adminDesc">—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω—è–º–∏ (realtime)</span>
            <div class="row" style="margin-top:10px">
              <div>
                <label id="t_adminDateLabel">–î–∞—Ç–∞ (—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å)</label>
                <input id="adminDate" type="date" />
              </div>
              <div>
                <label id="t_adminSearchLabel">–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö/email)</label>
                <input id="adminSearch" type="text" placeholder="search" />
              </div>
            </div>
            <div class="btns">
              <button class="ghost" id="refreshAdminBtn" type="button">üîÑ <span id="t_refresh2">Refresh</span></button>
              <button class="danger" id="adminCloseBtn" type="button">üö™ <span id="t_closeAdmin">Close admin</span></button>
            </div>
          </div>

          <table>
            <thead>
              <tr>
                <th id="t_a_day">–î–µ–Ω—å</th><th id="t_a_time">–í—Ä–µ–º—è</th><th id="t_a_pc">–ü–ö</th><th id="t_a_nick">–ù–∏–∫</th><th id="t_a_user">User</th><th id="t_a_action">Action</th>
              </tr>
            </thead>
            <tbody id="adminTable"></tbody>
          </table>
        </div>

        <div class="footerbar">
          <div><span class="kbd">Esc</span> ‚Äî <span id="t_esc">–∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–∞</span></div>
          <div class="btns" style="margin:0">
            <button class="mini ghost" id="openAdminBtn" type="button">üîê <span id="t_adminBtn">Admin</span></button>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <div class="hd">
        <h2 id="t_side">–ü–æ–¥—Å–∫–∞–∑–∫–∞</h2>
        <div class="hint" id="t_side2">–∫–∞–∫ –∏–≥—Ä–æ–∫—É –ø–æ–Ω—è—Ç—å —Å—Ä–∞–∑—É</div>
      </div>
      <div class="bd">
        <div class="slider" id="onboard">
          <div class="sliderTop">
            <div style="display:flex; gap:10px; align-items:center; font-weight:1100">
              <span id="s_title">–ö–∞–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</span>
              <span class="badge" id="s_step">–®–∞–≥ 1/4</span>
            </div>
            <span class="badge" id="s_mode">Live</span>
          </div>

          <div class="slides">
            <div class="slide active" data-i="0">
              <div class="sIcon">üîë</div>
              <p class="sH" id="s0_h">–í—Ö–æ–¥</p>
              <p class="sP" id="s0_p">–í–æ–π–¥–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è ‚Äî –∏–Ω–∞—á–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.</p>
              <ul class="sList">
                <li><span>‚Ä¢</span><div id="s0_l1"><b>Login</b> –∑–∞—â–∏—â–∞–µ—Ç —Ç–≤–æ–∏ –±—Ä–æ–Ω–∏</div></li>
                <li><span>‚Ä¢</span><div id="s0_l2">–ü–æ—è–≤–∏—Ç—Å—è —Ä–∞–∑–¥–µ–ª <b>‚Äú–ú–æ–∏ –±—Ä–æ–Ω–∏‚Äù</b></div></li>
              </ul>
            </div>

            <div class="slide" data-i="1">
              <div class="sIcon">üñ•Ô∏è</div>
              <p class="sH" id="s1_h">–í—ã–±–æ—Ä –ü–ö</p>
              <p class="sP" id="s1_p">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö ‚Äî –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—Å—è –ø–æ –≤—Å–µ–º.</p>
              <ul class="sList">
                <li><span>‚Ä¢</span><div id="s1_l1">–ù–∞–∂–º–∏ –ü–ö ‚Äî –æ–Ω <b>–ø–æ–¥—Å–≤–µ—Ç–∏—Ç—Å—è</b></div></li>
                <li><span>‚Ä¢</span><div id="s1_l2">–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ ‚Äî <b>—Å–Ω—è—Ç—å</b></div></li>
              </ul>
            </div>

            <div class="slide" data-i="2">
              <div class="sIcon">‚è±</div>
              <p class="sH" id="s2_h">–í—Ä–µ–º—è</p>
              <p class="sP" id="s2_p">–í—ã–±–∏—Ä–∞–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å—Ç–∞—Ä—Ç. –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.</p>
              <ul class="sList">
                <li><span>‚Ä¢</span><div id="s2_l1">–ö–Ω–æ–ø–∫–∞ <b>‚Äú–°–ª–µ–¥—É—é—â–∏–π —Å–≤–æ–±–æ–¥–Ω—ã–π‚Äù</b></div></li>
                <li><span>‚Ä¢</span><div id="s2_l2">–ù–æ—á—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è <b>üåô(+1)</b></div></li>
              </ul>
            </div>

            <div class="slide" data-i="3">
              <div class="sIcon">‚úÖ</div>
              <p class="sH" id="s3_h">–ì–æ—Ç–æ–≤–æ</p>
              <p class="sP" id="s3_p">–ù–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù ‚Äî –ø–æ–∫–∞–∂–µ—Ç—Å—è —É—Å–ø–µ—Ö + –¥–µ—Ç–∞–ª–∏ + –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏.</p>
              <ul class="sList">
                <li><span>‚Ä¢</span><div id="s3_l1"><b>–ú–æ–∏ –±—Ä–æ–Ω–∏</b> ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä/–æ—Ç–º–µ–Ω–∞</div></li>
                <li><span>‚Ä¢</span><div id="s3_l2"><b>Admin</b> –≤–∏–¥–∏—Ç –±—Ä–æ–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div></li>
              </ul>
            </div>
          </div>

          <div class="sliderBot">
            <div class="dots" id="sdots"></div>
            <div class="btns" style="margin:0">
              <button class="navBtn ghost" type="button" id="prevSlide">‚Üê</button>
              <button class="navBtn primary" type="button" id="nextSlide">‚Üí</button>
            </div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="notice">
          <b>–í–∞–∂–Ω–æ</b><br/>
          Firebase —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ <b>http(s)</b>. –ù–∞ <b>file:///</b> –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è/–±–∞–∑–∞ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º.
        </div>
      </div>
    </div>

  </div>
</div>

<!-- AUTH MODAL -->
<div class="backdrop" id="authBackdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="mh">
      <div>
        <b id="t_authModal">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</b>
        <div class="mut" id="t_authModal2">Email + –ø–∞—Ä–æ–ª—å</div>
      </div>
      <button id="authCloseBtn" type="button">‚úñ</button>
    </div>
    <div class="mb">
      <div class="row">
        <div>
          <label id="t_email">Email</label>
          <input id="authEmail" type="email" placeholder="email@example.com" />
        </div>
        <div>
          <label id="t_pass">Password</label>
          <input id="authPass" type="password" placeholder="******" />
        </div>
      </div>
      <div class="btns">
        <button class="primary" id="doLoginBtn" type="button"><span id="t_login2">–í–æ–π—Ç–∏</span></button>
        <button class="ghost" id="doRegisterBtn" type="button"><span id="t_register2">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span></button>
        <button class="linkbtn" id="forgotBtn" type="button"><span id="t_forgot">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</span></button>
      </div>
      <div class="notice" style="margin-top:10px" id="authModalMsg">‚Äî</div>
    </div>
  </div>
</div>

<!-- SUCCESS -->
<div class="successBackdrop" id="successBackdrop" aria-hidden="true">
  <div class="successCard">
    <div class="confetti" id="confetti"></div>
    <div class="successTop">
      <b id="succTitle">‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</b>
      <button type="button" id="succClose">‚úñ</button>
    </div>
    <div class="successBody">
      <div class="bigCheck">‚úî</div>
      <div class="successInfo" id="succInfo"></div>
      <div class="successActions">
        <button class="primary" type="button" id="succMy">üë§ <span id="t_succMy">–ú–æ–∏ –±—Ä–æ–Ω–∏</span></button>
        <button class="ghost" type="button" id="succAgain">‚ûï <span id="t_succAgain">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë</span></button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // =========================
  // FIREBASE CONFIG
  // =========================
  const firebaseConfig = {
    apiKey: "AIzaSyDJ-5e_xLPW9PnYT66ENey_Ndh8HJdI5wc",
    authDomain: "sakompiutere-gaming.firebaseapp.com",
    projectId: "sakompiutere-gaming",
    storageBucket: "sakompiutere-gaming.firebasestorage.app",
    messagingSenderId: "508996154674",
    appId: "1:508996154674:web:0b6e475d284c49ba80d32b",
    measurementId: "G-H2HKS025KH"
  };

  // =========================
  // CLUB CONFIG
  // =========================
  const PCs = ["Bishop","Godzilla","Elf","Kadita","Orc","Lancelot","Fantomas","Soultaker","Pudge","Kratos"];
  const SLOT_STEP_MIN = 30;

  const WORKING_HOURS_ENABLED = true;
  const WORK_START = "10:00";
  const WORK_END   = "03:00";

  const ADMIN_EMAILS = [
    "adjarelispeak@gmail.com",
    "kiralite93@gmail.com",
  ].map(x => String(x).toLowerCase());

  // =========================
  // HELPERS
  // =========================
  const $ = (id) => document.getElementById(id);
  const pad2 = (n)=>String(n).padStart(2,"0");
  const toISODate = (d)=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
  const parseISODate = (iso)=>{ const [y,m,d]=iso.split("-").map(Number); return new Date(y,m-1,d,0,0,0,0); };
  const minutesFromHHMM = (t)=>{ const [h,m]=t.split(":").map(Number); return h*60+m; };
  const hhmmFromMinutes = (min)=>{ min=((min%1440)+1440)%1440; const h=Math.floor(min/60), m=min%60; return `${pad2(h)}:${pad2(m)}`; };
  const addDays = (dateObj, days) => new Date(dateObj.getTime() + days*24*60*60*1000);

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  // =========================
  // i18n (full)
  // =========================
  const LANG_KEY = "sg_lang";
  let lang = localStorage.getItem(LANG_KEY) || "ru";

  const i18n = {
    ru: {
      title: "Sakompiutere Gaming ‚Äî Booking",
      sub: "–í—ã–±–µ—Ä–∏ –ü–ö ‚Üí –¥–∞—Ç—É ‚Üí –≤—Ä–µ–º—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
      user: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
      status: "–°—Ç–∞—Ç—É—Å",
      main: "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ",
      hintTop: "–û–Ω–ª–∞–π–Ω –±–∞–∑–∞ —á–µ—Ä–µ–∑ Firebase",
      authTitle: "–ê–∫–∫–∞—É–Ω—Ç",
      authDesc: "–ß—Ç–æ–±—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ‚Äî –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏.",
      login: "–í–æ–π—Ç–∏",
      register: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
      logout: "–í—ã–π—Ç–∏",
      nickLabel: "–¢–≤–æ–π –Ω–∏–∫ (–≤ –∫–ª—É–±–µ)",
      dateLabel: "–î–∞—Ç–∞ (—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å)",
      duration: "–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
      noteLabel: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)",
      pickpc: "–í—ã–±–µ—Ä–∏ –ü–ö (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ):",
      timeTitle: "–í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏",
      nextFree: "–°–ª–µ–¥—É—é—â–∏–π —Å–≤–æ–±–æ–¥–Ω—ã–π",
      refresh: "–û–±–Ω–æ–≤–∏—Ç—å",
      timeHintIdle: "–í—ã–±–µ—Ä–∏ –ü–ö + –¥–∞—Ç—É + –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî –ø–æ—è–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞—Ä—Ç—ã.",
      timeHintPick: "–í—ã–±–µ—Ä–∏ —Å—Ç–∞—Ä—Ç (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã).",
      bookNow: "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
      my: "–ú–æ–∏ –±—Ä–æ–Ω–∏",
      today: "–°–µ–≥–æ–¥–Ω—è",
      close: "–ó–∞–∫—Ä—ã—Ç—å",
      colDay: "–î–µ–Ω—å",
      colTime: "–í—Ä–µ–º—è",
      colPc: "–ü–ö",
      colNote: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
      colAct: "–î–µ–π—Å—Ç–≤–∏—è",
      esc: "–∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–∞",
      adminBtn: "Admin",
      adminTitle: "Admin",
      adminDesc: "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω—è–º–∏ (realtime)",
      adminDateLabel: "–î–∞—Ç–∞ (—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å)",
      adminSearchLabel: "–ü–æ–∏—Å–∫ (–Ω–∏–∫/–ü–ö/email)",
      closeAdmin: "Close admin",
      tableA: { day:"–î–µ–Ω—å", time:"–í—Ä–µ–º—è", pc:"–ü–ö", nick:"–ù–∏–∫", user:"User", action:"Action" },
      modalTitle: "–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
      modalSub: "Email + –ø–∞—Ä–æ–ª—å",
      email:"Email",
      pass:"Password",
      forgot:"–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?",
      login2:"–í–æ–π—Ç–∏",
      register2:"–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
      s_title:"–ö–∞–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
      s0:{h:"–í—Ö–æ–¥", p:"–í–æ–π–¥–∏ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è ‚Äî –∏–Ω–∞—á–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.", l1:"<b>Login</b> –∑–∞—â–∏—â–∞–µ—Ç —Ç–≤–æ–∏ –±—Ä–æ–Ω–∏", l2:"–ü–æ—è–≤–∏—Ç—Å—è —Ä–∞–∑–¥–µ–ª <b>‚Äú–ú–æ–∏ –±—Ä–æ–Ω–∏‚Äù</b>"},
      s1:{h:"–í—ã–±–æ—Ä –ü–ö", p:"–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö ‚Äî –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—Å—è –ø–æ –≤—Å–µ–º.", l1:"–ù–∞–∂–º–∏ –ü–ö ‚Äî –æ–Ω <b>–ø–æ–¥—Å–≤–µ—Ç–∏—Ç—Å—è</b>", l2:"–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ ‚Äî <b>—Å–Ω—è—Ç—å</b>"},
      s2:{h:"–í—Ä–µ–º—è", p:"–í—ã–±–∏—Ä–∞–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å—Ç–∞—Ä—Ç. –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.", l1:"–ö–Ω–æ–ø–∫–∞ <b>‚Äú–°–ª–µ–¥—É—é—â–∏–π —Å–≤–æ–±–æ–¥–Ω—ã–π‚Äù</b>", l2:"–ù–æ—á—å –ø–æ–º–µ—á–∞–µ—Ç—Å—è <b>üåô(+1)</b>"},
      s3:{h:"–ì–æ—Ç–æ–≤–æ", p:"–ù–∞–∂–º–∏ ‚Äú–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å‚Äù ‚Äî –ø–æ–∫–∞–∂–µ—Ç—Å—è —É—Å–ø–µ—Ö + –¥–µ—Ç–∞–ª–∏ + –±—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏.", l1:"<b>–ú–æ–∏ –±—Ä–æ–Ω–∏</b> ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä/–æ—Ç–º–µ–Ω–∞", l2:"<b>Admin</b> –≤–∏–¥–∏—Ç –±—Ä–æ–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"},
      msg: {
        welcome:"–í–æ–π–¥–∏, –≤—ã–±–µ—Ä–∏ –ü–ö –∏ –≤—Ä–µ–º—è ‚Äî –∏ –±—Ä–æ–Ω–∏—Ä—É–π ‚úÖ",
        loginFirst:"–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏.",
        enterNick:"–í–≤–µ–¥–∏ –Ω–∏–∫.",
        pickDate:"–í—ã–±–µ—Ä–∏ –¥–∞—Ç—É.",
        pickPc:"–í—ã–±–µ—Ä–∏ –ü–ö.",
        pickTime:"–í—ã–±–µ—Ä–∏ –≤—Ä–µ–º—è.",
        past:"–ù–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º.",
        creating:"–°–æ–∑–¥–∞—é –±—Ä–æ–Ω—å‚Ä¶",
        ok:"‚úÖ –ë—Ä–æ–Ω—å —Å–æ–∑–¥–∞–Ω–∞!",
        nextFreeNone:"–°–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ—Ç üòï",
        refreshed:"–û–±–Ω–æ–≤–ª–µ–Ω–æ.",
        rulesDenied:"Firestore permission denied. –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å Firestore Rules –≤ Firebase Console.",
        blockedByClient:"–ó–∞–ø—Ä–æ—Å—ã –∫ Firestore –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º (uBlock/AdBlock/Brave Shields). –û—Ç–∫–ª—é—á–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è —Å–∞–π—Ç–∞ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π –≤ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.",
        fsError:"Firestore error. –û—Ç–∫—Ä–æ–π Console (F12) –∏ –ø—Ä–∏—à–ª–∏ 1 –∫—Ä–∞—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É.",
        selected:"–í—ã–±—Ä–∞–Ω–æ –≤—Ä–µ–º—è: ",
        cancelOk:"–û—Ç–º–µ–Ω–µ–Ω–æ.",
        delOk:"–£–¥–∞–ª–µ–Ω–æ.",
        notAdmin:"–¢—ã –Ω–µ –∞–¥–º–∏–Ω. –î–æ–±–∞–≤—å email –≤ ADMIN_EMAILS."
      },
      succ:{ title:"‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ", my:"–ú–æ–∏ –±—Ä–æ–Ω–∏", again:"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë", hintAdmin:"–ê–¥–º–∏–Ω —É–≤–∏–¥–∏—Ç –±—Ä–æ–Ω—å –≤ —Ä–∞–∑–¥–µ–ª–µ Admin (–µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∞–≤–∞)." },
      cancelConfirm:"Cancel booking?",
      deleteConfirm:"Delete booking?",
      loginErr:"–í–≤–µ–¥–∏—Ç–µ email+password",
      resetSent:"–ü–∏—Å—å–º–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ",
      loginOK:"OK",
      created:"Created!"
    },

    en: {
      title: "Sakompiutere Gaming ‚Äî Booking",
      sub: "Pick PC ‚Üí date ‚Üí time ‚Üí confirm",
      user: "User",
      status: "Status",
      main: "Booking",
      hintTop: "Live database via Firebase",
      authTitle: "Account",
      authDesc: "Login required to book.",
      login: "Login",
      register: "Register",
      logout: "Logout",
      nickLabel: "Your nickname (club)",
      dateLabel: "Date (work day)",
      duration: "Duration",
      noteLabel: "Note (optional)",
      pickpc: "Select PCs (multi-select):",
      timeTitle: "Pick time",
      nextFree: "Next available",
      refresh: "Refresh",
      timeHintIdle: "Pick PCs + date + duration ‚Äî available starts will appear.",
      timeHintPick: "Pick a start time (only real free options are shown).",
      bookNow: "Book now",
      my: "My bookings",
      today: "Today",
      close: "Close",
      colDay: "Day",
      colTime: "Time",
      colPc: "PC",
      colNote: "Note",
      colAct: "Actions",
      esc: "close panels",
      adminBtn: "Admin",
      adminTitle: "Admin",
      adminDesc: "manage bookings (realtime)",
      adminDateLabel: "Date (work day)",
      adminSearchLabel: "Search (nick/PC/email)",
      closeAdmin: "Close admin",
      tableA: { day:"Day", time:"Time", pc:"PC", nick:"Nick", user:"User", action:"Action" },
      modalTitle: "Login / Register",
      modalSub: "Email + password",
      email:"Email",
      pass:"Password",
      forgot:"Forgot password?",
      login2:"Login",
      register2:"Register",
      s_title:"How to book",
      s0:{h:"Login", p:"Login or register ‚Äî otherwise booking can‚Äôt be created.", l1:"<b>Login</b> protects your bookings", l2:"You‚Äôll see <b>‚ÄúMy bookings‚Äù</b>"},
      s1:{h:"Pick PCs", p:"You can select multiple PCs ‚Äî time checks all selected.", l1:"Tap a PC ‚Äî it becomes <b>selected</b>", l2:"Tap again ‚Äî <b>unselect</b>"},
      s2:{h:"Pick time", p:"Choose an available start. Only real free options are shown.", l1:"Use <b>‚ÄúNext available‚Äù</b>", l2:"Night is marked <b>üåô(+1)</b>"},
      s3:{h:"Done", p:"Press ‚ÄúBook now‚Äù ‚Äî success screen + details + quick actions.", l1:"<b>My bookings</b> ‚Äî view/cancel", l2:"<b>Admin</b> sees bookings in realtime"},
      msg: {
        welcome:"Login, pick PCs & time ‚Äî then book ‚úÖ",
        loginFirst:"Please login first.",
        enterNick:"Enter your nickname.",
        pickDate:"Pick a date.",
        pickPc:"Pick PCs.",
        pickTime:"Pick a time.",
        past:"Cannot book in the past.",
        creating:"Creating booking‚Ä¶",
        ok:"‚úÖ Booking created!",
        nextFreeNone:"No free time üòï",
        refreshed:"Refreshed.",
        rulesDenied:"Firestore permission denied. Update Firestore Rules in Firebase Console.",
        blockedByClient:"Firestore requests are blocked by an extension (uBlock/AdBlock/Brave Shields). Disable blocking for this site or use Incognito without extensions.",
        fsError:"Firestore error. Open Console (F12) and send 1 red line.",
        selected:"Selected time: ",
        cancelOk:"Canceled.",
        delOk:"Deleted.",
        notAdmin:"You are not admin. Add your email to ADMIN_EMAILS."
      },
      succ:{ title:"‚úÖ Booking successful", my:"My bookings", again:"Book again", hintAdmin:"Admin will see it in Admin panel (if allowed)." },
      cancelConfirm:"Cancel booking?",
      deleteConfirm:"Delete booking?",
      loginErr:"Enter email+password",
      resetSent:"Password reset email sent ‚úÖ",
      loginOK:"OK",
      created:"Created!"
    },

    ka: {
      title: "Sakompiutere Gaming ‚Äî Booking",
      sub: "·Éê·Éò·É†·É©·Éò·Éî PC ‚Üí ·Éó·Éê·É†·Éò·É¶·Éò ‚Üí ·Éì·É†·Éù ‚Üí ·Éì·Éê·Éê·Éì·Éê·É°·É¢·É£·É†·Éî",
      user: "·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò",
      status: "·É°·É¢·Éê·É¢·É£·É°·Éò",
      main: "·ÉØ·Éê·Éï·É®·Éê·Éú·Éò",
      hintTop: "·Éù·Éú·Éö·Éê·Éò·Éú ·Éë·Éê·Éñ·Éê Firebase-·Éò·Éó",
      authTitle: "·Éê·É•·Éê·É£·Éú·Éó·Éò",
      authDesc: "·ÉØ·Éê·Éï·É®·Éú·Éò·É°·Éó·Éï·Éò·É° ·É°·Éê·É≠·Éò·É†·Éù·Éê ·É®·Éî·É°·Éï·Éö·Éê.",
      login: "·É®·Éî·É°·Éï·Éö·Éê",
      register: "·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê",
      logout: "·Éí·Éê·É°·Éï·Éö·Éê",
      nickLabel: "·Éú·Éò·Éô·Éò (·Éô·Éö·É£·Éë·É®·Éò)",
      dateLabel: "·Éó·Éê·É†·Éò·É¶·Éò (·É°·Éê·Éõ·É£·É®·Éê·Éù ·Éì·É¶·Éî)",
      duration: "·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê",
      noteLabel: "·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù)",
      pickpc: "·Éê·Éò·É†·É©·Éò·Éî PC-·Éî·Éë·Éò (·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî):",
      timeTitle: "·Éì·É†·Éù·Éò·É° ·Éê·É†·É©·Éî·Éï·Éê",
      nextFree: "·É®·Éî·Éõ·Éì·Éî·Éí·Éò ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò",
      refresh: "·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·Éê",
      timeHintIdle: "·Éê·Éò·É†·É©·Éò·Éî PC + ·Éó·Éê·É†·Éò·É¶·Éò + ·ÉÆ·Éê·Éú·Éí·É†·É´·Éö·Éò·Éï·Éù·Éë·Éê ‚Äî ·Éí·Éê·Éõ·Éù·É©·Éú·Éì·Éî·Éë·Éê ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·É°·É¢·Éê·É†·É¢·Éî·Éë·Éò.",
      timeHintPick: "·Éê·Éò·É†·É©·Éò·Éî ·Éì·Éê·É¨·Éß·Éî·Éë·Éê (·Éú·Éê·É©·Éï·Éî·Éú·Éî·Éë·Éò·Éê ·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·É†·Éî·Éê·Éö·É£·É†·Éê·Éì ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éï·Éê·É†·Éò·Éê·Éú·É¢·Éî·Éë·Éò).",
      bookNow: "·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê",
      my: "·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò",
      today: "·Éì·É¶·Éî·É°",
      close: "·Éì·Éê·ÉÆ·É£·É†·Éï·Éê",
      colDay: "·Éì·É¶·Éî",
      colTime: "·Éì·É†·Éù",
      colPc: "PC",
      colNote: "·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê",
      colAct: "·É•·Éõ·Éî·Éì·Éî·Éë·Éê",
      esc: "·É§·Éê·Éú·ÉØ·É†·Éî·Éë·Éò·É° ·Éì·Éê·ÉÆ·É£·É†·Éï·Éê",
      adminBtn: "Admin",
      adminTitle: "Admin",
      adminDesc: "·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò·É° ·Éõ·Éê·É†·Éó·Éï·Éê (realtime)",
      adminDateLabel: "·Éó·Éê·É†·Éò·É¶·Éò (·É°·Éê·Éõ·É£·É®·Éê·Éù ·Éì·É¶·Éî)",
      adminSearchLabel: "·É´·Éò·Éî·Éë·Éê (·Éú·Éò·Éô·Éò/PC/email)",
      closeAdmin: "Close admin",
      tableA: { day:"·Éì·É¶·Éî", time:"·Éì·É†·Éù", pc:"PC", nick:"·Éú·Éò·Éô·Éò", user:"User", action:"Action" },
      modalTitle: "·É®·Éî·É°·Éï·Éö·Éê / ·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê",
      modalSub: "Email + ·Éû·Éê·É†·Éù·Éö·Éò",
      email:"Email",
      pass:"Password",
      forgot:"·Éì·Éê·Éí·Éê·Éï·Éò·É¨·Éß·Éì·Éê ·Éû·Éê·É†·Éù·Éö·Éò?",
      login2:"·É®·Éî·É°·Éï·Éö·Éê",
      register2:"·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éê",
      s_title:"·É†·Éù·Éí·Éù·É† ·Éì·Éê·Éï·ÉØ·Éê·Éï·É®·Éú·Éù",
      s0:{h:"·É®·Éî·É°·Éï·Éö·Éê", p:"·É®·Éî·Éì·Éò ·Éê·Éú ·Éì·Éê·É†·Éî·Éí·Éò·É°·É¢·É†·Éò·É†·Éì·Éò ‚Äî ·É°·ÉÆ·Éï·Éê ·É®·Éî·Éõ·Éó·ÉÆ·Éï·Éî·Éï·Éê·É®·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·Éê·É† ·É®·Éî·Éò·É•·Éõ·Éú·Éî·Éë·Éê.", l1:"<b>Login</b> ·Éò·É™·Éê·Éï·É° ·É®·Éî·Éú·É° ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·É°", l2:"·Éí·Éê·Éõ·Éù·É©·Éú·Éì·Éî·Éë·Éê <b>‚Äú·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò‚Äù</b>"},
      s1:{h:"PC-·Éî·Éë·Éò·É° ·Éê·É†·É©·Éî·Éï·Éê", p:"·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê ·É†·Éê·Éõ·Éì·Éî·Éú·Éò·Éõ·Éî PC ‚Äî ·Éì·É†·Éù ·É®·Éî·Éõ·Éù·É¨·Éõ·Éì·Éî·Éë·Éê ·Éß·Éï·Éî·Éö·Éê ·Éê·É†·É©·Éî·É£·Éö·Éñ·Éî.", l1:"·Éì·Éê·Éê·É≠·Éò·É†·Éî PC-·É° ‚Äî <b>·Éê·Éò·É†·É©·Éî·Éï·Éê</b>", l2:"·Éõ·Éî·Éù·É†·Éî·Éì ‚Äî <b>·Éí·Éê·É£·É•·Éõ·Éì·Éî·Éë·Éê</b>"},
      s2:{h:"·Éì·É†·Éù", p:"·Éê·Éò·É†·É©·Éò·Éî ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éì·Éê·É¨·Éß·Éî·Éë·Éê. ·Éú·Éê·É©·Éï·Éî·Éú·Éî·Éë·Éò·Éê ·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·É†·Éî·Éê·Éö·É£·É†·Éê·Éì ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éï·Éê·É†·Éò·Éê·Éú·É¢·Éî·Éë·Éò.", l1:"·Éí·Éê·Éõ·Éù·Éò·Éß·Éî·Éú·Éî <b>‚Äú·É®·Éî·Éõ·Éì·Éî·Éí·Éò ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò‚Äù</b>", l2:"·É¶·Éê·Éõ·Éî ·Éê·É¶·Éú·Éò·É®·Éú·É£·Éö·Éò·Éê <b>üåô(+1)</b>"},
      s3:{h:"·Éõ·Éñ·Éê·Éì·Éê·Éê", p:"·Éì·Éê·Éê·É≠·Éò·É†·Éî ‚Äú·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê‚Äù ‚Äî ·Éí·Éê·Éõ·Éù·É©·Éú·Éì·Éî·Éë·Éê ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·Éê + ·Éì·Éî·É¢·Éê·Éö·Éî·Éë·Éò + ·É°·É¨·É†·Éê·É§·Éò ·É•·Éõ·Éî·Éì·Éî·Éë·Éî·Éë·Éò.", l1:"<b>·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò</b> ‚Äî ·Éú·Éê·ÉÆ·Éï·Éê/·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê", l2:"<b>Admin</b> ·ÉÆ·Éî·Éì·Éê·Éï·É° realtime-·É®·Éò"},
      msg: {
        welcome:"·É®·Éî·Éì·Éò, ·Éê·Éò·É†·É©·Éò·Éî PC ·Éì·Éê ·Éì·É†·Éù ‚Äî ·Éì·Éê ·É®·Éî·Éõ·Éì·Éî·Éí ·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éî ‚úÖ",
        loginFirst:"·ÉØ·Éî·É† ·É®·Éî·Éì·Éò.",
        enterNick:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî ·Éú·Éò·Éô·Éò.",
        pickDate:"·Éê·Éò·É†·É©·Éò·Éî ·Éó·Éê·É†·Éò·É¶·Éò.",
        pickPc:"·Éê·Éò·É†·É©·Éò·Éî PC.",
        pickTime:"·Éê·Éò·É†·É©·Éò·Éî ·Éì·É†·Éù.",
        past:"·É¨·Éê·É†·É°·É£·Éö·É®·Éò ·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê ·Éê·É† ·É®·Éî·Éò·É´·Éö·Éî·Éë·Éê.",
        creating:"·Éï·É•·Éõ·Éú·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·É°‚Ä¶",
        ok:"‚úÖ ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·É®·Éî·Éò·É•·Éõ·Éú·Éê!",
        nextFreeNone:"·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éì·É†·Éù ·Éê·É† ·Éê·É†·Éò·É° üòï",
        refreshed:"·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éì·Éê.",
        rulesDenied:"Firestore permission denied. ·Éí·Éê·Éú·Éê·Éê·ÉÆ·Éö·Éî Firestore Rules Firebase Console-·É®·Éò.",
        blockedByClient:"Firestore-·Éò·É° ·Éõ·Éù·Éó·ÉÆ·Éù·Éï·Éú·Éî·Éë·É° ·Éë·Éö·Éù·Éô·Éê·Éï·É° ·Éí·Éê·É§·Éê·É†·Éó·Éù·Éî·Éë·Éê (uBlock/AdBlock/Brave Shields). ·Éí·Éê·Éõ·Éù·É†·Éó·Éî ·Éë·Éö·Éù·Éô·Éò ·Éê·Éõ ·É°·Éê·Éò·É¢·Éñ·Éî ·Éê·Éú ·Éí·Éê·ÉÆ·É°·Éî·Éú·Éò ·Éò·Éú·Éô·Éù·Éí·Éú·Éò·É¢·Éù ·É†·Éî·Éü·Éò·Éõ·É®·Éò ·Éí·Éê·É§·Éê·É†·Éó·Éù·Éî·Éë·Éî·Éë·Éò·É° ·Éí·Éê·É†·Éî·É®·Éî.",
        fsError:"Firestore error. ·Éí·Éê·ÉÆ·É°·Éî·Éú·Éò Console (F12) ·Éì·Éê ·Éí·Éê·Éõ·Éù·Éõ·Éò·Éí·Éñ·Éê·Éï·Éú·Éî 1 ·É¨·Éò·Éó·Éî·Éö·Éò ·ÉÆ·Éê·Éñ·Éò.",
        selected:"·Éê·É†·É©·Éî·É£·Éö·Éò ·Éì·É†·Éù: ",
        cancelOk:"·Éí·Éê·É£·É•·Éõ·Éì·Éê.",
        delOk:"·É¨·Éê·Éò·É®·Éê·Éö·Éê.",
        notAdmin:"Admin ·Éê·É† ·ÉÆ·Éê·É†. ·Éì·Éê·Éê·Éõ·Éê·É¢·Éî email ADMIN_EMAILS-·É®·Éò."
      },
      succ:{ title:"‚úÖ ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·É£·Éö·Éò·Éê", my:"·É©·Éî·Éõ·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò", again:"·Éô·Éò·Éì·Éî·Éï ·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éê", hintAdmin:"Admin ·Éú·Éê·ÉÆ·Éê·Éï·É° Admin ·Éû·Éê·Éú·Éî·Éö·É®·Éò (·Éó·É£ ·Éê·É•·Éï·É° ·É£·É§·Éö·Éî·Éë·Éê)." },
      cancelConfirm:"Cancel booking?",
      deleteConfirm:"Delete booking?",
      loginErr:"·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî email+password",
      resetSent:"·Éû·Éê·É†·Éù·Éö·Éò·É° ·Éê·É¶·Éì·Éí·Éî·Éú·Éò·É° ·É¨·Éî·É†·Éò·Éö·Éò ·Éí·Éê·Éò·Éí·Éñ·Éê·Éï·Éú·Éê ‚úÖ",
      loginOK:"OK",
      created:"Created!"
    }
  };

  function tr(path){
    const parts = path.split(".");
    let obj = i18n[lang] || i18n.ru;
    for(const p of parts){
      obj = (obj && obj[p] != null) ? obj[p] : null;
    }
    if(obj == null){
      obj = i18n.ru;
      for(const p of parts){ obj = (obj && obj[p] != null) ? obj[p] : null; }
    }
    return obj == null ? path : obj;
  }

  function applyLang(){
    document.title = tr("title");
    $("t_title").textContent = tr("title");
    $("t_sub").textContent = tr("sub");
    $("t_user").textContent = tr("user");
    $("t_status").textContent = tr("status");
    $("t_main").textContent = tr("main");
    $("hintTop").textContent = tr("hintTop");

    $("t_authTitle").textContent = tr("authTitle");
    $("t_authDesc").textContent = tr("authDesc");
    $("t_login").textContent = tr("login");
    $("t_register").textContent = tr("register");
    $("t_logout").textContent = tr("logout");

    $("t_nickLabel").textContent = tr("nickLabel");
    $("t_dateLabel").textContent = tr("dateLabel");
    $("t_duration").textContent = tr("duration");
    $("t_noteLabel").textContent = tr("noteLabel");
    $("t_pickpc").textContent = tr("pickpc");

    $("t_timeTitle").textContent = tr("timeTitle");
    $("t_nextFree").textContent = tr("nextFree");
    $("t_refresh").textContent = tr("refresh");

    $("t_bookNow").textContent = tr("bookNow");
    $("t_my").textContent = tr("my");
    $("t_today").textContent = tr("today");
    $("t_close").textContent = tr("close");
    $("t_close2").textContent = tr("close");

    $("t_colDate").textContent = tr("colDay");
    $("t_colTime").textContent = tr("colTime");
    $("t_colPc").textContent = tr("colPc");
    $("t_colNote").textContent = tr("colNote");
    $("t_colAct").textContent = tr("colAct");

    $("t_esc").textContent = tr("esc");
    $("t_adminBtn").textContent = tr("adminBtn");

    $("t_adminTitle").textContent = tr("adminTitle");
    $("t_adminDesc").textContent = tr("adminDesc");
    $("t_adminDateLabel").textContent = tr("adminDateLabel");
    $("t_adminSearchLabel").textContent = tr("adminSearchLabel");
    $("t_refresh2").textContent = tr("refresh");
    $("t_closeAdmin").textContent = tr("closeAdmin");

    $("t_a_day").textContent = tr("tableA.day");
    $("t_a_time").textContent = tr("tableA.time");
    $("t_a_pc").textContent = tr("tableA.pc");
    $("t_a_nick").textContent = tr("tableA.nick");
    $("t_a_user").textContent = tr("tableA.user");
    $("t_a_action").textContent = tr("tableA.action");

    $("t_authModal").textContent = tr("modalTitle");
    $("t_authModal2").textContent = tr("modalSub");
    $("t_email").textContent = tr("email");
    $("t_pass").textContent = tr("pass");
    $("t_forgot").textContent = tr("forgot");
    $("t_login2").textContent = tr("login2");
    $("t_register2").textContent = tr("register2");

    $("t_succMy").textContent = tr("succ.my");
    $("t_succAgain").textContent = tr("succ.again");
    $("succTitle").textContent = tr("succ.title");

    $("t_side").textContent = tr("s_title");
    $("t_side2").textContent = (lang==="en" ? "quick steps" : lang==="ka" ? "·É°·É¨·É†·Éê·É§·Éò ·Éú·Éê·Éë·Éò·ÉØ·Éî·Éë·Éò" : "–±—ã—Å—Ç—Ä—ã–µ —à–∞–≥–∏");

    $("s_title").textContent = tr("s_title");
    $("s0_h").textContent = tr("s0.h"); $("s0_p").textContent = tr("s0.p");
    $("s0_l1").innerHTML = tr("s0.l1"); $("s0_l2").innerHTML = tr("s0.l2");

    $("s1_h").textContent = tr("s1.h"); $("s1_p").textContent = tr("s1.p");
    $("s1_l1").innerHTML = tr("s1.l1"); $("s1_l2").innerHTML = tr("s1.l2");

    $("s2_h").textContent = tr("s2.h"); $("s2_p").textContent = tr("s2.p");
    $("s2_l1").innerHTML = tr("s2.l1"); $("s2_l2").innerHTML = tr("s2.l2");

    $("s3_h").textContent = tr("s3.h"); $("s3_p").textContent = tr("s3.p");
    $("s3_l1").innerHTML = tr("s3.l1"); $("s3_l2").innerHTML = tr("s3.l2");

    $("lang_ru").classList.toggle("active", lang==="ru");
    $("lang_en").classList.toggle("active", lang==="en");
    $("lang_ka").classList.toggle("active", lang==="ka");

    updateTimeHint();
  }

  // =========================
  // UI helpers
  // =========================
  function setCloud(text, ok=true){
    $("cloudPill").textContent = text;
    const dot = $("cloudDot");
    dot.classList.remove("ok","err");
    dot.classList.add(ok ? "ok" : "err");
  }

  function setToast(text, kind="info"){
    const el = $("msgBox");
    el.classList.remove("toastIn"); void el.offsetWidth; el.classList.add("toastIn");
    el.textContent = text;

    el.style.borderColor =
      kind==="good" ? "rgba(52,211,153,.45)" :
      kind==="bad"  ? "rgba(251,113,133,.55)" :
      kind==="warn" ? "rgba(251,191,36,.55)" :
      "rgba(110,231,255,.35)";

    el.style.background =
      kind==="good" ? "rgba(52,211,153,.08)" :
      kind==="bad"  ? "rgba(251,113,133,.08)" :
      kind==="warn" ? "rgba(251,191,36,.08)" :
      "rgba(110,231,255,.06)";
  }

  function show(el){ el.classList.remove("hide"); }
  function hide(el){ el.classList.add("hide"); }
  function openModal(){ $("authBackdrop").classList.add("show"); }
  function closeModal(){ $("authBackdrop").classList.remove("show"); }

  // =========================
  // time logic (night shift)
  // =========================
  function isCrossMidnight(){
    if(!WORKING_HOURS_ENABLED) return false;
    const ws = minutesFromHHMM(WORK_START);
    const we = minutesFromHHMM(WORK_END);
    return we <= ws;
  }

  function slotStartAbs(dateKey, startMin){
    const base = parseISODate(dateKey);
    let d = new Date(base.getFullYear(), base.getMonth(), base.getDate(), Math.floor(startMin/60), startMin%60, 0, 0);
    if(isCrossMidnight()){
      const ws = minutesFromHHMM(WORK_START);
      if(startMin < ws) d = addDays(d, 1);
    }
    return d;
  }
  function slotEndAbs(dateKey, endMin){
    const base = parseISODate(dateKey);
    let d = new Date(base.getFullYear(), base.getMonth(), base.getDate(), Math.floor(endMin/60), endMin%60, 0, 0);
    if(isCrossMidnight()){
      const ws = minutesFromHHMM(WORK_START);
      if(endMin <= ws) d = addDays(d, 1);
    }
    return d;
  }

  function overlapsAbs(aStart, aEnd, bStart, bEnd){
    return Math.max(aStart, bStart) < Math.min(aEnd, bEnd);
  }

  function workingWindowSegments(){
    const ws = minutesFromHHMM(WORK_START);
    const we = minutesFromHHMM(WORK_END);
    if(!WORKING_HOURS_ENABLED) return [{a:0,b:1440, night:false}];
    if(we > ws) return [{a:ws,b:we, night:false}];
    return [
      {a:ws,b:1440, night:false},
      {a:0,b:we, night:true}
    ];
  }

  // =========================
  // FIREBASE INIT
  // =========================
  let app, auth, db;
  let currentUser = null;
  let isAdmin = false;

  try{
    app = firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
    setCloud("OK", true);
  }catch(e){
    console.error(e);
    setCloud("ERROR", false);
    setToast("Firebase init error. Open Console (F12).", "bad");
    return;
  }

  // =========================
  // STATE
  // =========================
  let selectedPCs = new Set();
  let selectedStart = null; // {startMin,endMin,startAtMs,endAtMs,label,night}
  let cachedBookings = [];
  let unsubDateRealtime = null;
  let unsubAdminRealtime = null;

  // =========================
  // FIRESTORE error handling
  // =========================
  function detectBlockedByClient(err){
    const msg = String(err && (err.message || err.code || err) || "");
    // "Failed to fetch" —á–∞—Å—Ç–æ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ, –∞ –≤ Network –≤–∏–¥–Ω–æ ERR_BLOCKED_BY_CLIENT
    return msg.includes("Failed to fetch") || msg.toLowerCase().includes("blocked") || msg.toLowerCase().includes("network");
  }

  function handleFirestoreErr(err){
    console.error(err);
    const msg = String(err && (err.message||err.code||err) || "");
    if(msg.toLowerCase().includes("permission") || msg.includes("PERMISSION_DENIED")){
      setCloud("RULES", false);
      setToast(tr("msg.rulesDenied"), "bad");
      return;
    }
    if(detectBlockedByClient(err)){
      setCloud("BLOCK", false);
      setToast(tr("msg.blockedByClient"), "bad");
      return;
    }
    setCloud("ERR", false);
    setToast(tr("msg.fsError"), "bad");
  }

  // =========================
  // PC grid
  // =========================
  function renderPCGrid(){
    const grid = $("pcGrid");
    grid.innerHTML = "";
    for(const pc of PCs){
      const div = document.createElement("div");
      div.className = "pc" + (selectedPCs.has(pc) ? " selected" : "");
      div.innerHTML = `
        <div class="check">‚úì</div>
        <div class="name">${pc}</div>
        <div class="meta">${selectedPCs.has(pc) ? "Selected" : "Tap to select"}</div>
      `;
      div.addEventListener("click", ()=>{
        if(selectedPCs.has(pc)) selectedPCs.delete(pc);
        else selectedPCs.add(pc);
        renderPCGrid();
        rebuildTimeList();
        sliderGo(1);
      });
      grid.appendChild(div);
    }
  }

  // =========================
  // REALTIME loading (date + prev day)
  // =========================
  async function startRealtimeForDate(dateKey){
    if(unsubDateRealtime) { try{unsubDateRealtime();}catch(e){} unsubDateRealtime=null; }
    if(!dateKey) return;

    const prevKey = toISODate(addDays(parseISODate(dateKey), -1));
    const col = db.collection("bookings");

    const q1 = col.where("dateKey","==",dateKey);
    const q2 = col.where("dateKey","==",prevKey);

    let list1 = [], list2 = [];

    const apply = ()=>{
      cachedBookings = [...list1, ...list2].map(b=>({
        ...b,
        startAtMs: Number(b.startAtMs||0),
        endAtMs: Number(b.endAtMs||0),
        pc: String(b.pc||"")
      }));
      rebuildTimeList();
    };

    const u1 = q1.onSnapshot((snap)=>{
      list1 = snap.docs.map(d=>({id:d.id, ...d.data()}));
      apply();
      setCloud("LIVE", true);
    }, handleFirestoreErr);

    const u2 = q2.onSnapshot((snap)=>{
      list2 = snap.docs.map(d=>({id:d.id, ...d.data()}));
      apply();
      setCloud("LIVE", true);
    }, handleFirestoreErr);

    unsubDateRealtime = ()=>{ try{u1();}catch(e){} try{u2();}catch(e){} };
  }

  // =========================
  // TIME PICKER
  // =========================
  function isBusyForPCs(slot){
    for(const b of cachedBookings){
      if(!selectedPCs.has(b.pc)) continue;
      if(overlapsAbs(slot.startAtMs, slot.endAtMs, b.startAtMs, b.endAtMs)) return true;
    }
    return false;
  }

  function labelShort(sl){
    const start = hhmmFromMinutes(sl.startMin);
    return sl.night ? `${start} üåô` : start;
  }

  function updateTimeHint(){
    const dateKey = $("date").value;
    const dur = Number($("duration").value||60);
    if(!dateKey || selectedPCs.size===0 || !dur) $("timeHint").textContent = tr("timeHintIdle");
    else $("timeHint").textContent = tr("timeHintPick");
  }

  function rebuildTimeList(){
    const listEl = $("timeList");
    listEl.innerHTML = "";
    selectedStart = null;

    const dateKey = $("date").value;
    const dur = Number($("duration").value||60);

    $("pickedSummary").innerHTML = `<b>‚Äî</b>`;
    $("createBtn").disabled = true;

    if(!dateKey || selectedPCs.size===0){
      updateTimeHint();
      return;
    }

    const segs = workingWindowSegments();
    const slots = [];

    for(const seg of segs){
      for(let s = seg.a; s + dur <= seg.b; s += SLOT_STEP_MIN){
        const e = s + dur;
        const startAt = slotStartAbs(dateKey, s).getTime();
        const endAt = slotEndAbs(dateKey, e).getTime();
        const label = seg.night
          ? `${hhmmFromMinutes(s)} ‚Üí ${hhmmFromMinutes(e)}  üåô(+1)`
          : `${hhmmFromMinutes(s)} ‚Üí ${hhmmFromMinutes(e)}`;
        slots.push({startMin:s,endMin:e,startAtMs:startAt,endAtMs:endAt,label,night:!!seg.night});
      }
    }

    const now = Date.now();
    for(const sl of slots){
      const busy = isBusyForPCs(sl);
      const past = sl.startAtMs < now;

      const div = document.createElement("div");
      div.className = "tbtn" + (busy || past ? " busy" : "");
      div.textContent = busy ? `‚õî ${labelShort(sl)}` : past ? `‚Äî ${labelShort(sl)}` : `‚úÖ ${labelShort(sl)}`;

      div.addEventListener("click", ()=>{
        if(busy || past) return;
        selectedStart = sl;

        [...listEl.children].forEach(x=>x.classList.remove("active"));
        div.classList.add("active");

        $("pickedSummary").innerHTML = `<b>${escapeHtml(sl.label)}</b> ‚Ä¢ ${lang==="en" ? "PCs" : lang==="ka" ? "PC-·Éî·Éë·Éò" : "–ü–ö"}: <b>${escapeHtml(Array.from(selectedPCs).join(", "))}</b>`;
        $("createBtn").disabled = false;

        sliderGo(2);
        setToast(tr("msg.selected") + sl.label, "info");
      });

      listEl.appendChild(div);
    }

    updateTimeHint();
  }

  function pickNextFree(){
    const btns = [...$("timeList").querySelectorAll(".tbtn")];
    const first = btns.find(b=>!b.classList.contains("busy"));
    if(first){ first.click(); return true; }
    return false;
  }

  // =========================
  // PROFILE (NO serverTimestamp)
  // =========================
  async function upsertProfileNick(uid, nick){
    const safeNick = (nick || "").trim().slice(0, 32);
    if(!safeNick) return;
    await db.collection("users").doc(String(uid)).set({
      nick: safeNick,
      updatedAtMs: Date.now()
    }, { merge:true });
  }

  async function loadProfileNick(uid){
    const doc = await db.collection("users").doc(String(uid)).get();
    return doc.exists ? (doc.data().nick || "") : "";
  }

  function updateAuthUI(){
    $("logoutBtn").classList.toggle("hide", !currentUser);
    $("openAuthBtn").classList.toggle("hide", !!currentUser);
    $("userPill").textContent = currentUser ? (currentUser.email || currentUser.uid.slice(0,6)) : "‚Äî";

    isAdmin = !!(currentUser && ADMIN_EMAILS.includes(String(currentUser.email||"").toLowerCase()));
    if(!isAdmin) {
      hide($("adminBox"));
      if(unsubAdminRealtime){ try{unsubAdminRealtime();}catch(e){} unsubAdminRealtime=null; }
    }
  }

  // =========================
  // SUCCESS UI
  // =========================
  function showSuccess(detailsHtml){
    $("succInfo").innerHTML = detailsHtml;
    $("successBackdrop").classList.add("show");
    makeConfetti();
  }
  function closeSuccess(){
    $("successBackdrop").classList.remove("show");
    $("confetti").innerHTML = "";
  }
  function makeConfetti(){
    const wrap = $("confetti");
    wrap.innerHTML = "";
    const colors = [
      "rgba(110,231,255,.95)",
      "rgba(167,139,250,.95)",
      "rgba(52,211,153,.95)",
      "rgba(251,191,36,.95)"
    ];
    const count = 28;
    for(let i=0;i<count;i++){
      const el = document.createElement("i");
      const left = Math.random()*100;
      const delay = Math.random()*180;
      const dur = 750 + Math.random()*550;
      const w = 8 + Math.random()*10;
      const h = 10 + Math.random()*18;
      el.style.left = left+"%";
      el.style.top = (-10 - Math.random()*30) + "px";
      el.style.width = w + "px";
      el.style.height = h + "px";
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      el.style.animationDelay = delay + "ms";
      el.style.animationDuration = dur + "ms";
      wrap.appendChild(el);
    }
    setTimeout(()=>{ wrap.innerHTML=""; }, 1400);
  }

  // =========================
  // BOOKING CREATE (FIXED: no locks, no transactions, primitives + batch)
  // =========================
  async function loadBookingsForDateKey(dateKey){
    const prevKey = toISODate(addDays(parseISODate(dateKey), -1));
    const col = db.collection("bookings");

    const [s1, s2] = await Promise.all([
      col.where("dateKey", "==", dateKey).get(),
      col.where("dateKey", "==", prevKey).get()
    ]);

    return [...s1.docs, ...s2.docs].map(d => {
      const b = d.data() || {};
      return {
        id: d.id,
        ...b,
        startAtMs: Number(b.startAtMs || 0),
        endAtMs: Number(b.endAtMs || 0),
        pc: String(b.pc || "")
      };
    });
  }

  async function createBooking(){
    if(!currentUser){
      setToast(tr("msg.loginFirst"), "bad");
      sliderGo(0);
      return;
    }

    const nick = ($("nick").value||"").trim();
    const dateKey = $("date").value;
    const note = ($("note").value||"").trim();

    if(!nick){ setToast(tr("msg.enterNick"), "bad"); return; }
    if(!dateKey){ setToast(tr("msg.pickDate"), "bad"); return; }
    if(selectedPCs.size===0){ setToast(tr("msg.pickPc"), "bad"); sliderGo(1); return; }
    if(!selectedStart){ setToast(tr("msg.pickTime"), "bad"); sliderGo(2); return; }
    if(selectedStart.startAtMs < Date.now()){
      setToast(tr("msg.past"), "bad");
      return;
    }

    const pcs = Array.from(selectedPCs);
    $("createBtn").disabled = true;
    setToast(tr("msg.creating"), "info");

    try{
      await upsertProfileNick(currentUser.uid, nick);

      // Check overlaps on server data (day + prev day)
      const dayBookings = await loadBookingsForDateKey(dateKey);
      for(const pc of pcs){
        for(const b of dayBookings){
          if(b.pc !== pc) continue;
          if(overlapsAbs(selectedStart.startAtMs, selectedStart.endAtMs, b.startAtMs, b.endAtMs)){
            throw new Error("OVERLAP");
          }
        }
      }

      // Create via batch
      const batch = db.batch();
      const nowMs = Date.now();

      for(const pc of pcs){
        const ref = db.collection("bookings").doc();
        batch.set(ref, {
          uid: String(currentUser.uid),
          userEmail: String(currentUser.email || ""),
          nick: String(nick),
          pc: String(pc),
          dateKey: String(dateKey),
          startMin: Number(selectedStart.startMin),
          endMin: Number(selectedStart.endMin),
          startAtMs: Number(selectedStart.startAtMs),
          endAtMs: Number(selectedStart.endAtMs),
          note: String(note || ""),
          createdAtMs: Number(nowMs)
        });
      }

      await batch.commit();

      const start = new Date(selectedStart.startAtMs);
      const end = new Date(selectedStart.endAtMs);
      const timeStr = `${pad2(start.getHours())}:${pad2(start.getMinutes())} ‚Üí ${pad2(end.getHours())}:${pad2(end.getMinutes())}`;

      const pcsLabel = (lang==="en" ? "PCs" : lang==="ka" ? "PC-·Éî·Éë·Éò" : "–ü–ö");
      const dayLabel = (lang==="en" ? "Day" : lang==="ka" ? "·Éì·É¶·Éî" : "–î–µ–Ω—å");
      const timeLabel = (lang==="en" ? "Time" : lang==="ka" ? "·Éì·É†·Éù" : "–í—Ä–µ–º—è");
      const nickLabel = (lang==="en" ? "Nick" : lang==="ka" ? "·Éú·Éò·Éô·Éò" : "–ù–∏–∫");
      const noteLabel = (lang==="en" ? "Note" : lang==="ka" ? "·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê" : "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π");

      const details = `
        <div><b>${nickLabel}:</b> ${escapeHtml(nick)}</div>
        <div><b>${pcsLabel}:</b> ${escapeHtml(pcs.join(", "))}</div>
        <div><b>${dayLabel}:</b> ${escapeHtml(dateKey)} ${selectedStart.night ? " <span style='color:rgba(251,191,36,.9)'>üåô(+1)</span>" : ""}</div>
        <div><b>${timeLabel}:</b> ${escapeHtml(timeStr)} ${selectedStart.night ? " <span style='color:rgba(251,191,36,.9)'>üåô</span>" : ""}</div>
        <div><b>${noteLabel}:</b> ${escapeHtml(note || "‚Äî")}</div>
        <div style="margin-top:8px; color:rgba(154,164,191,.95)">${escapeHtml(tr("succ.hintAdmin"))}</div>
      `;

      setToast(tr("msg.ok"), "good");
      sliderGo(3);
      showSuccess(details);

      selectedStart = null;
      $("pickedSummary").innerHTML = `<b>‚Äî</b>`;
      $("createBtn").disabled = true;

    }catch(e){
      if(String(e.message||"")==="OVERLAP"){
        setToast(lang==="en" ? "‚õî Slot was taken. Pick another time."
          : lang==="ka" ? "‚õî ·Éì·É†·Éù ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê. ·Éê·Éò·É†·É©·Éò·Éî ·É°·ÉÆ·Éï·Éê."
          : "‚õî –≠—Ç–æ—Ç —Å–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è–ª–∏. –í—ã–±–µ—Ä–∏ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è.", "bad");
      }else{
        handleFirestoreErr(e);
      }
      $("createBtn").disabled = false;
    }
  }

  // =========================
  // MY BOOKINGS
  // =========================
  async function loadMyBookings(){
    if(!currentUser) return [];
    const snap = await db.collection("bookings").where("uid","==", String(currentUser.uid)).get();
    return snap.docs.map(d => ({ id:d.id, ...d.data() }))
      .map(b=>({ ...b, startAtMs:Number(b.startAtMs||0), endAtMs:Number(b.endAtMs||0) }))
      .sort((a,b)=> (a.startAtMs - b.startAtMs) || String(a.pc).localeCompare(String(b.pc)));
  }

  async function deleteBookingDoc(b){
    await db.collection("bookings").doc(String(b.id)).delete();
  }

  async function renderMyBookings(){
    const tbody = $("myTable");
    tbody.innerHTML = "";
    if(!currentUser){
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted)">${lang==="en"?"Login first":lang==="ka"?"·ÉØ·Éî·É† ·É®·Éî·Éì·Éò":"–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏"}</td></tr>`;
      return;
    }
    let list = [];
    try{
      list = await loadMyBookings();
    }catch(e){
      handleFirestoreErr(e);
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted)">‚Äî</td></tr>`;
      return;
    }
    if(!list.length){
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted)">‚Äî</td></tr>`;
      return;
    }

    for(const b of list){
      const start = new Date(b.startAtMs);
      const end = new Date(b.endAtMs);
      const timeStr = `${pad2(start.getHours())}:${pad2(start.getMinutes())} ‚Üí ${pad2(end.getHours())}:${pad2(end.getMinutes())}`;
      const trEl = document.createElement("tr");
      trEl.innerHTML = `
        <td>${escapeHtml(b.dateKey || "")}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(String(b.pc||""))}</b></td>
        <td style="color:var(--muted)">${escapeHtml(String(b.note||""))}</td>
        <td><button class="mini danger" type="button">${lang==="en"?"Cancel":lang==="ka"?"·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê":"Cancel"}</button></td>
      `;
      tbody.appendChild(trEl);

      trEl.querySelector("button").addEventListener("click", async ()=>{
        if(!confirm(tr("cancelConfirm"))) return;
        try{
          await deleteBookingDoc(b);
          setToast(tr("msg.cancelOk"), "good");
        }catch(e){
          handleFirestoreErr(e);
        }
      });
    }
  }

  // =========================
  // TODAY
  // =========================
  async function renderToday(){
    const tbody = $("todayTable");
    tbody.innerHTML = "";

    const now = new Date();
    const dayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0,0,0,0).getTime();
    const dayEnd = dayStart + 24*60*60*1000;

    try{
      const todayKey = toISODate(now);
      const yKey = toISODate(addDays(now, -1));

      const [s1, s2] = await Promise.all([
        db.collection("bookings").where("dateKey","==", todayKey).get(),
        db.collection("bookings").where("dateKey","==", yKey).get(),
      ]);

      let list = [
        ...s1.docs.map(d=>({id:d.id, ...d.data()})),
        ...s2.docs.map(d=>({id:d.id, ...d.data()})),
      ].map(b=>({ ...b, startAtMs:Number(b.startAtMs||0), endAtMs:Number(b.endAtMs||0) }))
       .filter(b => overlapsAbs(b.startAtMs, b.endAtMs, dayStart, dayEnd))
       .sort((a,b)=> (a.startAtMs - b.startAtMs) || String(a.pc).localeCompare(String(b.pc)));

      if(!list.length){
        tbody.innerHTML = `<tr><td colspan="4" style="color:var(--muted)">‚Äî</td></tr>`;
        return;
      }

      for(const b of list){
        const start = new Date(b.startAtMs);
        const end = new Date(b.endAtMs);
        const timeStr = `${pad2(start.getHours())}:${pad2(start.getMinutes())} ‚Üí ${pad2(end.getHours())}:${pad2(end.getMinutes())}`;
        const trEl = document.createElement("tr");
        trEl.innerHTML = `
          <td>${escapeHtml(timeStr)}</td>
          <td><b>${escapeHtml(String(b.pc||""))}</b></td>
          <td>${escapeHtml(String(b.nick||""))}</td>
          <td style="color:var(--muted)">${escapeHtml(String(b.note||""))}</td>
        `;
        tbody.appendChild(trEl);
      }
    }catch(e){
      handleFirestoreErr(e);
      tbody.innerHTML = `<tr><td colspan="4" style="color:var(--muted)">Firestore error</td></tr>`;
    }
  }

  // =========================
  // ADMIN realtime
  // =========================
  function stopAdminRealtime(){
    if(unsubAdminRealtime){ try{unsubAdminRealtime();}catch(e){} unsubAdminRealtime=null; }
  }

  function startAdminRealtime(){
    stopAdminRealtime();
    const dateKey = $("adminDate").value;
    if(!dateKey) return;

    unsubAdminRealtime = db.collection("bookings").where("dateKey","==", String(dateKey))
      .onSnapshot((snap)=>{
        const list = snap.docs.map(d=>({ id:d.id, ...d.data() }))
          .map(b=>({ ...b, startAtMs:Number(b.startAtMs||0), endAtMs:Number(b.endAtMs||0) }))
          .sort((a,b)=> (a.startAtMs - b.startAtMs) || String(a.pc).localeCompare(String(b.pc)));
        renderAdminTable(list);
        setCloud("LIVE", true);
      }, handleFirestoreErr);
  }

  function renderAdminTable(list){
    const q = ($("adminSearch").value||"").trim().toLowerCase();
    let filtered = list;
    if(q){
      filtered = list.filter(b =>
        String(b.nick||"").toLowerCase().includes(q) ||
        String(b.pc||"").toLowerCase().includes(q) ||
        String(b.userEmail||"").toLowerCase().includes(q)
      );
    }

    const tbody = $("adminTable");
    tbody.innerHTML = "";
    if(!filtered.length){
      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted)">‚Äî</td></tr>`;
      return;
    }

    for(const b of filtered){
      const start = new Date(b.startAtMs);
      const end = new Date(b.endAtMs);
      const timeStr = `${pad2(start.getHours())}:${pad2(start.getMinutes())} ‚Üí ${pad2(end.getHours())}:${pad2(end.getMinutes())}`;

      const trEl = document.createElement("tr");
      trEl.innerHTML = `
        <td>${escapeHtml(String(b.dateKey||""))}</td>
        <td>${escapeHtml(timeStr)}</td>
        <td><b>${escapeHtml(String(b.pc||""))}</b></td>
        <td>${escapeHtml(String(b.nick||""))}</td>
        <td style="color:var(--muted)">${escapeHtml(String(b.userEmail||""))}</td>
        <td><button class="mini danger" type="button">${lang==="en"?"Delete":lang==="ka"?"·É¨·Éê·É®·Éö·Éê":"Delete"}</button></td>
      `;
      tbody.appendChild(trEl);

      trEl.querySelector("button").addEventListener("click", async ()=>{
        if(!confirm(tr("deleteConfirm"))) return;
        try{
          await deleteBookingDoc(b);
          setToast(tr("msg.delOk"), "good");
        }catch(e){
          handleFirestoreErr(e);
        }
      });
    }
  }

  // =========================
  // Slider
  // =========================
  let slideIndex = 0;
  let slideTimer = null;

  function sliderInit(){
    const dots = $("sdots");
    dots.innerHTML = "";
    const slides = document.querySelectorAll(".slide");
    slides.forEach((_, i)=>{
      const d = document.createElement("div");
      d.className = "sdot" + (i===0 ? " on" : "");
      d.addEventListener("click", ()=> sliderGo(i));
      dots.appendChild(d);
    });

    $("prevSlide").addEventListener("click", ()=> sliderGo(slideIndex-1));
    $("nextSlide").addEventListener("click", ()=> sliderGo(slideIndex+1));

    slideTimer = setInterval(()=> sliderGo(slideIndex+1), 6500);

    $("onboard").addEventListener("mouseenter", ()=>{ if(slideTimer){ clearInterval(slideTimer); slideTimer=null; }});
    $("onboard").addEventListener("mouseleave", ()=>{ if(!slideTimer) slideTimer=setInterval(()=> sliderGo(slideIndex+1), 6500); });

    sliderGo(0);
  }

  function sliderGo(i){
    const slides = document.querySelectorAll(".slide");
    const n = slides.length;
    slideIndex = (i % n + n) % n;
    slides.forEach(s=>s.classList.remove("active"));
    slides[slideIndex].classList.add("active");
    [...$("sdots").children].forEach((d, idx)=> d.classList.toggle("on", idx===slideIndex));
    $("s_step").textContent =
      (lang==="en" ? `Step ${slideIndex+1}/${n}` : lang==="ka" ? `·Éú·Éê·Éë·Éò·ÉØ·Éò ${slideIndex+1}/${n}` : `–®–∞–≥ ${slideIndex+1}/${n}`);
  }

  // =========================
  // EVENTS
  // =========================
  function bindEvents(){
    $("lang_ru").onclick = ()=>{ lang="ru"; localStorage.setItem(LANG_KEY,lang); applyLang(); };
    $("lang_en").onclick = ()=>{ lang="en"; localStorage.setItem(LANG_KEY,lang); applyLang(); };
    $("lang_ka").onclick = ()=>{ lang="ka"; localStorage.setItem(LANG_KEY,lang); applyLang(); };

    $("openAuthBtn").onclick = ()=>{ openModal(); sliderGo(0); };
    $("authCloseBtn").onclick = closeModal;
    $("authBackdrop").onclick = (e)=>{ if(e.target === $("authBackdrop")) closeModal(); };

    $("doLoginBtn").onclick = async ()=>{
      const email = ($("authEmail").value||"").trim();
      const pass = ($("authPass").value||"").trim();
      if(!email || !pass){ $("authModalMsg").textContent = tr("loginErr"); return; }
      try{
        await auth.signInWithEmailAndPassword(email, pass);
        $("authModalMsg").textContent = tr("loginOK");
        closeModal();
      }catch(e){
        console.error(e);
        $("authModalMsg").textContent = e.message || "Login error";
      }
    };

    $("doRegisterBtn").onclick = async ()=>{
      const email = ($("authEmail").value||"").trim();
      const pass = ($("authPass").value||"").trim();
      if(!email || !pass){ $("authModalMsg").textContent = tr("loginErr"); return; }
      try{
        await auth.createUserWithEmailAndPassword(email, pass);
        $("authModalMsg").textContent = tr("created");
        closeModal();
      }catch(e){
        console.error(e);
        $("authModalMsg").textContent = e.message || "Register error";
      }
    };

    $("forgotBtn").onclick = async ()=>{
      const email = ($("authEmail").value||"").trim();
      if(!email){ $("authModalMsg").textContent = tr("email"); return; }
      try{
        await auth.sendPasswordResetEmail(email);
        $("authModalMsg").textContent = tr("resetSent");
      }catch(e){
        console.error(e);
        $("authModalMsg").textContent = e.message || "Reset error";
      }
    };

    $("logoutBtn").onclick = async ()=>{ try{ await auth.signOut(); }catch(e){} };

    $("date").addEventListener("change", async ()=>{
      const dateKey = $("date").value;
      await startRealtimeForDate(dateKey);
      rebuildTimeList();
      sliderGo(2);
    });

    $("duration").addEventListener("change", ()=>{ rebuildTimeList(); sliderGo(2); });

    $("refreshBtn").onclick = async ()=>{
      const dateKey = $("date").value;
      await startRealtimeForDate(dateKey);
      rebuildTimeList();
      setToast(tr("msg.refreshed"), "good");
    };

    $("nextFreeBtn").onclick = ()=>{
      if(!pickNextFree()) setToast(tr("msg.nextFreeNone"), "warn");
    };

    $("createBtn").onclick = createBooking;

    $("myBtn").onclick = async ()=>{
      show($("myBox")); hide($("todayBox")); hide($("adminBox"));
      await renderMyBookings();
      $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("closeMyBtn").onclick = ()=> hide($("myBox"));

    $("todayBtn").onclick = async ()=>{
      hide($("myBox")); show($("todayBox")); hide($("adminBox"));
      await renderToday();
      $("todayBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("closeTodayBtn").onclick = ()=> hide($("todayBox"));

    $("openAdminBtn").onclick = async ()=>{
      if(!currentUser){ setToast(tr("msg.loginFirst"), "bad"); return; }
      if(!isAdmin){ setToast(tr("msg.notAdmin"), "bad"); return; }
      hide($("myBox")); hide($("todayBox"));
      show($("adminBox"));
      $("adminDate").value = $("adminDate").value || $("date").value;
      startAdminRealtime();
      $("adminBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("adminCloseBtn").onclick = ()=>{
      hide($("adminBox"));
      stopAdminRealtime();
    };
    $("refreshAdminBtn").onclick = ()=> startAdminRealtime();
    $("adminDate").addEventListener("change", ()=> startAdminRealtime());
    $("adminSearch").addEventListener("input", ()=> startAdminRealtime());

    $("succClose").onclick = closeSuccess;
    $("successBackdrop").onclick = (e)=>{ if(e.target === $("successBackdrop")) closeSuccess(); };
    $("succMy").onclick = async ()=>{
      closeSuccess();
      show($("myBox")); hide($("todayBox")); hide($("adminBox"));
      await renderMyBookings();
      $("myBox").scrollIntoView({behavior:"smooth", block:"start"});
    };
    $("succAgain").onclick = ()=>{
      closeSuccess();
      selectedStart = null;
      $("pickedSummary").innerHTML = `<b>‚Äî</b>`;
      rebuildTimeList();
      setToast(lang==="en" ? "Pick a new time." : lang==="ka" ? "·Éê·Éò·É†·É©·Éò·Éî ·Éê·ÉÆ·Éê·Éö·Éò ·Éì·É†·Éù." : "–í—ã–±–µ—Ä–∏ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è.", "info");
      sliderGo(2);
      $("timeList").scrollIntoView({behavior:"smooth", block:"center"});
    };

    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape"){
        hide($("myBox")); hide($("todayBox")); hide($("adminBox"));
        closeModal();
        closeSuccess();
      }
    });
  }

  // =========================
  // BOOT
  // =========================
  async function boot(){
    const now = new Date();
    $("date").value = toISODate(now);
    $("adminDate").value = toISODate(now);

    if(!i18n[lang]) lang="ru";
    applyLang();
    renderPCGrid();
    sliderInit();
    bindEvents();

    const savedNick = localStorage.getItem("sg_nick") || "";
    if(savedNick) $("nick").value = savedNick;
    $("nick").addEventListener("input", ()=> localStorage.setItem("sg_nick", ($("nick").value||"").trim()));

    setToast(tr("msg.welcome"), "info");

    // Quick connectivity probe (helps when Firestore is blocked by client)
    try{
      await db.collection("bookings").limit(1).get();
      setCloud("OK", true);
    }catch(e){
      handleFirestoreErr(e);
    }

    auth.onAuthStateChanged(async (u)=>{
      currentUser = u || null;
      updateAuthUI();

      if(currentUser){
        $("authMsg").textContent = `‚úÖ Logged in: ${currentUser.email || currentUser.uid.slice(0,6)}`;
        sliderGo(1);

        if(!($("nick").value||"").trim()){
          try{
            const pn = await loadProfileNick(currentUser.uid);
            if(pn) $("nick").value = pn;
          }catch(e){}
        }

        await startRealtimeForDate($("date").value);
        rebuildTimeList();
      }else{
        $("authMsg").textContent = "‚Äî";
        setToast(tr("msg.loginFirst"), "info");
        sliderGo(0);
        if(unsubDateRealtime){ try{unsubDateRealtime();}catch(e){} unsubDateRealtime=null; }
        stopAdminRealtime();
      }
    });
  }

  boot();

  // =========================
  // Firestore Rules reminder:
  // If you see PERMISSION_DENIED, update Rules in Firebase Console.
  // You need at least:
  // - read bookings for all
  // - create bookings for signed in
  // - delete own bookings (or admin)
  // =========================
})();
</script>
</body>
</html>
